<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>5m10v3&#39;s blog</title>
  
  
  <link href="https://5m10v3.top/atom.xml" rel="self"/>
  
  <link href="https://5m10v3.top/"/>
  <updated>2024-07-14T13:10:12.078Z</updated>
  <id>https://5m10v3.top/</id>
  
  <author>
    <name>5m10v3</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>周报(二)</title>
    <link href="https://5m10v3.top/2024/07/14/%E5%91%A8%E6%8A%A5(%E4%BA%8C)/"/>
    <id>https://5m10v3.top/2024/07/14/%E5%91%A8%E6%8A%A5(%E4%BA%8C)/</id>
    <published>2024-07-13T16:00:00.000Z</published>
    <updated>2024-07-14T13:10:12.078Z</updated>
    
    <content type="html"><![CDATA[<h2 id="STL练习题"><a href="#STL练习题" class="headerlink" title="STL练习题"></a>STL练习题</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v6; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v9; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  __int64 v12; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> *v14; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  __int64 v15; <span class="comment">// [rsp+28h] [rbp-58h]</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">48</span>]; <span class="comment">// [rsp+30h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">32</span>]; <span class="comment">// [rsp+60h] [rbp-20h] BYREF</span></span><br><span class="line">  _BYTE v18[<span class="number">32</span>]; <span class="comment">// [rsp+80h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v19[<span class="number">32</span>]; <span class="comment">// [rsp+A0h] [rbp+20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v20[<span class="number">11</span>]; <span class="comment">// [rsp+C0h] [rbp+40h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v21; <span class="comment">// [rsp+EFh] [rbp+6Fh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v22[<span class="number">518</span>]; <span class="comment">// [rsp+F0h] [rbp+70h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v23; <span class="comment">// [rsp+2F6h] [rbp+276h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v24; <span class="comment">// [rsp+2F7h] [rbp+277h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v25; <span class="comment">// [rsp+2F8h] [rbp+278h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v26; <span class="comment">// [rsp+2F9h] [rbp+279h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v27; <span class="comment">// [rsp+2FAh] [rbp+27Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> v28; <span class="comment">// [rsp+2FBh] [rbp+27Bh] BYREF</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [rsp+2FCh] [rbp+27Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v30[<span class="number">32</span>]; <span class="comment">// [rsp+300h] [rbp+280h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v31[<span class="number">40</span>]; <span class="comment">// [rsp+320h] [rbp+2A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v32; <span class="comment">// [rsp+348h] [rbp+2C8h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v33; <span class="comment">// [rsp+349h] [rbp+2C9h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v34; <span class="comment">// [rsp+34Ah] [rbp+2CAh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v35; <span class="comment">// [rsp+34Bh] [rbp+2CBh]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+34Ch] [rbp+2CCh]</span></span><br><span class="line"></span><br><span class="line">  _main(argc, argv, envp);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v19);</span><br><span class="line">  std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">vector</span>(v18);</span><br><span class="line">  v20[<span class="number">0</span>] = <span class="number">0xA73A7464</span>;</span><br><span class="line">  v20[<span class="number">1</span>] = <span class="number">0xDE9FB57E</span>;</span><br><span class="line">  v20[<span class="number">2</span>] = <span class="number">0xF33AAA74</span>;</span><br><span class="line">  v20[<span class="number">3</span>] = <span class="number">0x9FF3DE88</span>;</span><br><span class="line">  v20[<span class="number">4</span>] = <span class="number">0x887EF388</span>;</span><br><span class="line">  v20[<span class="number">5</span>] = <span class="number">0x887E7EF3</span>;</span><br><span class="line">  v20[<span class="number">6</span>] = <span class="number">0xDE4EB5DE</span>;</span><br><span class="line">  v20[<span class="number">7</span>] = <span class="number">0x74748864</span>;</span><br><span class="line">  v20[<span class="number">8</span>] = <span class="number">0xDEA7A764</span>;</span><br><span class="line">  std::allocator&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">allocator</span>(&amp;v21);</span><br><span class="line">  v14 = v20;</span><br><span class="line">  v15 = <span class="number">9</span>i64;</span><br><span class="line">  std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">vector</span>(v17, &amp;v14, &amp;v21);</span><br><span class="line">  std::allocator&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::~<span class="built_in">allocator</span>(&amp;v21);</span><br><span class="line">  <span class="built_in">memcpy</span>(v22, &amp;unk_407020, <span class="number">0x200</span>ui64);</span><br><span class="line">  std::allocator&lt;std::pair&lt;<span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;&gt;::<span class="built_in">allocator</span>(&amp;v24);</span><br><span class="line">  v14 = (<span class="type">int</span> *)v22;</span><br><span class="line">  v15 = <span class="number">256</span>i64;</span><br><span class="line">  ((<span class="built_in">void</span> (__fastcall *)(<span class="type">char</span> *, <span class="type">int</span> **, <span class="type">char</span> *, <span class="type">char</span> *))std::map&lt;<span class="type">unsigned</span> <span class="type">char</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;::map)(</span><br><span class="line">    v16,</span><br><span class="line">    &amp;v14,</span><br><span class="line">    &amp;v23,</span><br><span class="line">    &amp;v24);</span><br><span class="line">  std::allocator&lt;std::pair&lt;<span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;&gt;::~<span class="built_in">allocator</span>(&amp;v24);</span><br><span class="line">  std::<span class="keyword">operator</span>&gt;&gt;&lt;<span class="type">char</span>&gt;(refptr__ZSt3cin, v19);</span><br><span class="line">  <span class="keyword">if</span> ( std::string::<span class="built_in">length</span>(v19) != <span class="number">36</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; i += <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = i;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt;= std::string::<span class="built_in">length</span>(v19) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v4 = (<span class="type">unsigned</span> __int8 *)std::string::<span class="keyword">operator</span>[](v19, i);</span><br><span class="line">    v25 = <span class="built_in">bits_change</span>(*v4);</span><br><span class="line">    v35 = *(_BYTE *)std::map&lt;<span class="type">unsigned</span> <span class="type">char</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;::<span class="keyword">operator</span>[](v16, &amp;v25);</span><br><span class="line">    v5 = (<span class="type">unsigned</span> __int8 *)std::string::<span class="keyword">operator</span>[](v19, i + <span class="number">1</span>);</span><br><span class="line">    v26 = <span class="built_in">bits_change</span>(*v5);</span><br><span class="line">    v34 = *(_BYTE *)std::map&lt;<span class="type">unsigned</span> <span class="type">char</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;::<span class="keyword">operator</span>[](v16, &amp;v26);</span><br><span class="line">    v6 = (<span class="type">unsigned</span> __int8 *)std::string::<span class="keyword">operator</span>[](v19, i + <span class="number">2</span>);</span><br><span class="line">    v27 = <span class="built_in">bits_change</span>(*v6);</span><br><span class="line">    v33 = *(_BYTE *)std::map&lt;<span class="type">unsigned</span> <span class="type">char</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;::<span class="keyword">operator</span>[](v16, &amp;v27);</span><br><span class="line">    v7 = (<span class="type">unsigned</span> __int8 *)std::string::<span class="keyword">operator</span>[](v19, i + <span class="number">3</span>);</span><br><span class="line">    v28 = <span class="built_in">bits_change</span>(*v7);</span><br><span class="line">    v32 = *(_BYTE *)std::map&lt;<span class="type">unsigned</span> <span class="type">char</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;::<span class="keyword">operator</span>[](v16, &amp;v28);</span><br><span class="line">    v29 = (v33 &lt;&lt; <span class="number">8</span>) | (v34 &lt;&lt; <span class="number">16</span>) | (v35 &lt;&lt; <span class="number">24</span>) | v32;</span><br><span class="line">    std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">push_back</span>(v18, &amp;v29);</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">begin</span>(v17);</span><br><span class="line">  v9 = std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">end</span>(v18);</span><br><span class="line">  v10 = std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::<span class="built_in">begin</span>(v18);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)std::equal&lt;__gnu_cxx::__normal_iterator&lt;<span class="type">unsigned</span> <span class="type">int</span> *,std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;&gt;,__gnu_cxx::__normal_iterator&lt;<span class="type">unsigned</span> <span class="type">int</span> *,std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;&gt;&gt;(</span><br><span class="line">                          v10,</span><br><span class="line">                          v9,</span><br><span class="line">                          v8) )</span><br><span class="line">  &#123;</span><br><span class="line">    std::<span class="keyword">operator</span>+&lt;<span class="type">char</span>&gt;(v31, <span class="string">&quot;you find it, flag is flag&#123;&quot;</span>, v19);</span><br><span class="line">    std::<span class="keyword">operator</span>+&lt;<span class="type">char</span>&gt;(v30, v31, <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    v11 = std::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="type">char</span>&gt;(refptr__ZSt4cout, v30);</span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v11, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);</span><br><span class="line">    std::string::~<span class="built_in">string</span>(v30);</span><br><span class="line">    std::string::~<span class="built_in">string</span>(v31);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v12 = std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="string">&quot;try again&quot;</span>);</span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v12, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);</span><br><span class="line">  &#125;</span><br><span class="line">  std::map&lt;<span class="type">unsigned</span> <span class="type">char</span>,<span class="type">unsigned</span> <span class="type">char</span>&gt;::~<span class="built_in">map</span>(v16);</span><br><span class="line">  std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::~<span class="built_in">vector</span>(v17);</span><br><span class="line">  std::vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;::~<span class="built_in">vector</span>(v18);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v19);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前面是STL的初始化，vector里面的值是v20里面的值</p><p><img src="https://s2.loli.net/2024/07/14/FTiCS8HzEeQ9aMG.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/FTiCS8HzEeQ9aMG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>第一步先进行了map操作</p><p><img src="https://s2.loli.net/2024/07/14/KmrOwfl18J53uWp.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/KmrOwfl18J53uWp.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/14/htnGVAQBPUz98ux.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/htnGVAQBPUz98ux.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里就是对经过map操作后vector容器里面的值取出来进行操作，其实就是高低位变换然后取反</p><p><img src="https://s2.loli.net/2024/07/14/a25C9jfOoKSFhMt.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/a25C9jfOoKSFhMt.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/14/modNrGcEFDKkBMP.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/modNrGcEFDKkBMP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>最后就是比较，取v17这个容器和v18进行比较</p><p><img src="https://s2.loli.net/2024/07/14/VEI2auRkcpPwJys.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/VEI2auRkcpPwJys.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>思路梳理完了接下来就是写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">change_bytes</span>(<span class="params">tmp</span>):</span><br><span class="line">    <span class="keyword">return</span> ~((tmp)&lt;&lt;<span class="number">4</span>|(tmp)&gt;&gt;<span class="number">4</span>)&amp;<span class="number">0xff</span></span><br><span class="line">enc=[<span class="number">0x64</span>, <span class="number">0x74</span>, <span class="number">0x3A</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0xB5</span>, <span class="number">0x9F</span>, <span class="number">0xDE</span>, <span class="number">0x74</span>, <span class="number">0xAA</span>, <span class="number">0x3A</span>, <span class="number">0xF3</span>, <span class="number">0x88</span>, <span class="number">0xDE</span>, <span class="number">0xF3</span>, <span class="number">0x9F</span>, <span class="number">0x88</span>, <span class="number">0xF3</span>, <span class="number">0x7E</span>, <span class="number">0x88</span>, <span class="number">0xF3</span>, <span class="number">0x7E</span>, <span class="number">0x7E</span>, <span class="number">0x88</span>, <span class="number">0xDE</span>, <span class="number">0xB5</span>, <span class="number">0x4E</span>, <span class="number">0xDE</span>, <span class="number">0x64</span>, <span class="number">0x88</span>, <span class="number">0x74</span>, <span class="number">0x74</span>, <span class="number">0x64</span>, <span class="number">0xA7</span>, <span class="number">0xA7</span>, <span class="number">0xDE</span>]</span><br><span class="line">dic=&#123;&#125;</span><br><span class="line">data=[<span class="number">0x00</span>, <span class="number">0x2E</span>, <span class="number">0x01</span>, <span class="number">0x7D</span>, <span class="number">0x02</span>, <span class="number">0xC5</span>, <span class="number">0x03</span>, <span class="number">0x1D</span>, <span class="number">0x04</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0xBA</span>, <span class="number">0x06</span>, <span class="number">0x4A</span>, <span class="number">0x07</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>, <span class="number">0x11</span>, <span class="number">0x09</span>, <span class="number">0xB3</span>, <span class="number">0x0A</span>, <span class="number">0x21</span>, <span class="number">0x0B</span>, <span class="number">0xE6</span>, <span class="number">0x0C</span>, <span class="number">0x6E</span>, <span class="number">0x0D</span>, <span class="number">0xBB</span>, <span class="number">0x0E</span>, <span class="number">0x1B</span>, <span class="number">0x0F</span>, <span class="number">0xCD</span>, <span class="number">0x10</span>, <span class="number">0xCB</span>, <span class="number">0x11</span>, <span class="number">0x34</span>, <span class="number">0x12</span>, <span class="number">0xDD</span>, <span class="number">0x13</span>, <span class="number">0x66</span>, <span class="number">0x14</span>, <span class="number">0xB7</span>, <span class="number">0x15</span>, <span class="number">0x5B</span>, <span class="number">0x16</span>, <span class="number">0x94</span>, <span class="number">0x17</span>, <span class="number">0x41</span>, <span class="number">0x18</span>, <span class="number">0x5A</span>, <span class="number">0x19</span>, <span class="number">0x36</span>, <span class="number">0x1A</span>, <span class="number">0x89</span>, <span class="number">0x1B</span>, <span class="number">0x7A</span>, <span class="number">0x1C</span>, <span class="number">0xE9</span>, <span class="number">0x1D</span>, <span class="number">0x60</span>, <span class="number">0x1E</span>, <span class="number">0x46</span>, <span class="number">0x1F</span>, <span class="number">0xFB</span>, <span class="number">0x20</span>, <span class="number">0x13</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0x22</span>, <span class="number">0x86</span>, <span class="number">0x23</span>, <span class="number">0xDC</span>, <span class="number">0x24</span>, <span class="number">0xBF</span>, <span class="number">0x25</span>, <span class="number">0x72</span>, <span class="number">0x26</span>, <span class="number">0x5F</span>, <span class="number">0x27</span>, <span class="number">0x18</span>, <span class="number">0x28</span>, <span class="number">0x07</span>, <span class="number">0x29</span>, <span class="number">0xED</span>, <span class="number">0x2A</span>, <span class="number">0xD8</span>, <span class="number">0x2B</span>, <span class="number">0xA2</span>, <span class="number">0x2C</span>, <span class="number">0xA4</span>, <span class="number">0x2D</span>, <span class="number">0xF3</span>, <span class="number">0x2E</span>, <span class="number">0x19</span>, <span class="number">0x2F</span>, <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="number">0xF2</span>, <span class="number">0x31</span>, <span class="number">0xA9</span>, <span class="number">0x32</span>, <span class="number">0x26</span>, <span class="number">0x33</span>, <span class="number">0x48</span>, <span class="number">0x34</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x6B</span>, <span class="number">0x36</span>, <span class="number">0x65</span>, <span class="number">0x37</span>, <span class="number">0x54</span>, <span class="number">0x38</span>, <span class="number">0xEA</span>, <span class="number">0x39</span>, <span class="number">0xD4</span>, <span class="number">0x3A</span>, <span class="number">0xE1</span>, <span class="number">0x3B</span>, <span class="number">0x05</span>, <span class="number">0x3C</span>, <span class="number">0x0C</span>, <span class="number">0x3D</span>, <span class="number">0x2B</span>, <span class="number">0x3E</span>, <span class="number">0x0E</span>, <span class="number">0x3F</span>, <span class="number">0xB0</span>, <span class="number">0x40</span>, <span class="number">0x2F</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x42</span>, <span class="number">0x30</span>, <span class="number">0x43</span>, <span class="number">0xC7</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x45</span>, <span class="number">0xD2</span>, <span class="number">0x46</span>, <span class="number">0x85</span>, <span class="number">0x47</span>, <span class="number">0x52</span>, <span class="number">0x48</span>, <span class="number">0xD6</span>, <span class="number">0x49</span>, <span class="number">0xE4</span>, <span class="number">0x4A</span>, <span class="number">0x9C</span>, <span class="number">0x4B</span>, <span class="number">0x8B</span>, <span class="number">0x4C</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x17</span>, <span class="number">0x4E</span>, <span class="number">0x91</span>, <span class="number">0x4F</span>, <span class="number">0x28</span>, <span class="number">0x50</span>, <span class="number">0xC6</span>, <span class="number">0x51</span>, <span class="number">0xB2</span>, <span class="number">0x52</span>, <span class="number">0x32</span>, <span class="number">0x53</span>, <span class="number">0x4F</span>, <span class="number">0x54</span>, <span class="number">0x67</span>, <span class="number">0x55</span>, <span class="number">0x6A</span>, <span class="number">0x56</span>, <span class="number">0x33</span>, <span class="number">0x57</span>, <span class="number">0x02</span>, <span class="number">0x58</span>, <span class="number">0x2D</span>, <span class="number">0x59</span>, <span class="number">0x4B</span>, <span class="number">0x5A</span>, <span class="number">0xD7</span>, <span class="number">0x5B</span>, <span class="number">0xEE</span>, <span class="number">0x5C</span>, <span class="number">0x9A</span>, <span class="number">0x5D</span>, <span class="number">0xB8</span>, <span class="number">0x5E</span>, <span class="number">0xE2</span>, <span class="number">0x5F</span>, <span class="number">0xAD</span>, <span class="number">0x60</span>, <span class="number">0xD0</span>, <span class="number">0x61</span>, <span class="number">0xD3</span>, <span class="number">0x62</span>, <span class="number">0x49</span>, <span class="number">0x63</span>, <span class="number">0x87</span>, <span class="number">0x64</span>, <span class="number">0x06</span>, <span class="number">0x65</span>, <span class="number">0x24</span>, <span class="number">0x66</span>, <span class="number">0xC0</span>, <span class="number">0x67</span>, <span class="number">0xA1</span>, <span class="number">0x68</span>, <span class="number">0x0F</span>, <span class="number">0x69</span>, <span class="number">0xC2</span>, <span class="number">0x6A</span>, <span class="number">0x5C</span>, <span class="number">0x6B</span>, <span class="number">0x0A</span>, <span class="number">0x6C</span>, <span class="number">0xAA</span>, <span class="number">0x6D</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x38</span>, <span class="number">0x6F</span>, <span class="number">0xF9</span>, <span class="number">0x70</span>, <span class="number">0xDF</span>, <span class="number">0x71</span>, <span class="number">0x8A</span>, <span class="number">0x72</span>, <span class="number">0x09</span>, <span class="number">0x73</span>, <span class="number">0x84</span>, <span class="number">0x74</span>, <span class="number">0x92</span>, <span class="number">0x75</span>, <span class="number">0x3F</span>, <span class="number">0x76</span>, <span class="number">0x5E</span>, <span class="number">0x77</span>, <span class="number">0x43</span>, <span class="number">0x78</span>, <span class="number">0x9B</span>, <span class="number">0x79</span>, <span class="number">0x44</span>, <span class="number">0x7A</span>, <span class="number">0x3E</span>, <span class="number">0x7B</span>, <span class="number">0x03</span>, <span class="number">0x7C</span>, <span class="number">0xB5</span>, <span class="number">0x7D</span>, <span class="number">0x29</span>, <span class="number">0x7E</span>, <span class="number">0xBE</span>, <span class="number">0x7F</span>, <span class="number">0x1A</span>, <span class="number">0x80</span>, <span class="number">0x97</span>, <span class="number">0x81</span>, <span class="number">0x0D</span>, <span class="number">0x82</span>, <span class="number">0x76</span>, <span class="number">0x83</span>, <span class="number">0xBC</span>, <span class="number">0x84</span>, <span class="number">0xCF</span>, <span class="number">0x85</span>, <span class="number">0x69</span>, <span class="number">0x86</span>, <span class="number">0xBD</span>, <span class="number">0x87</span>, <span class="number">0x3C</span>, <span class="number">0x88</span>, <span class="number">0x50</span>, <span class="number">0x89</span>, <span class="number">0xA3</span>, <span class="number">0x8A</span>, <span class="number">0x58</span>, <span class="number">0x8B</span>, <span class="number">0x04</span>, <span class="number">0x8C</span>, <span class="number">0x12</span>, <span class="number">0x8D</span>, <span class="number">0xD1</span>, <span class="number">0x8E</span>, <span class="number">0xF4</span>, <span class="number">0x8F</span>, <span class="number">0x22</span>, <span class="number">0x90</span>, <span class="number">0xFD</span>, <span class="number">0x91</span>, <span class="number">0x31</span>, <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0x93</span>, <span class="number">0xB6</span>, <span class="number">0x94</span>, <span class="number">0x7B</span>, <span class="number">0x95</span>, <span class="number">0x3D</span>, <span class="number">0x96</span>, <span class="number">0x14</span>, <span class="number">0x97</span>, <span class="number">0x16</span>, <span class="number">0x98</span>, <span class="number">0x9D</span>, <span class="number">0x99</span>, <span class="number">0x8D</span>, <span class="number">0x9A</span>, <span class="number">0xCC</span>, <span class="number">0x9B</span>, <span class="number">0x40</span>, <span class="number">0x9C</span>, <span class="number">0x9F</span>, <span class="number">0x9D</span>, <span class="number">0x1C</span>, <span class="number">0x9E</span>, <span class="number">0x98</span>, <span class="number">0x9F</span>, <span class="number">0x9E</span>, <span class="number">0xA0</span>, <span class="number">0x62</span>, <span class="number">0xA1</span>, <span class="number">0x59</span>, <span class="number">0xA2</span>, <span class="number">0x7C</span>, <span class="number">0xA3</span>, <span class="number">0xEF</span>, <span class="number">0xA4</span>, <span class="number">0xA8</span>, <span class="number">0xA5</span>, <span class="number">0xE7</span>, <span class="number">0xA6</span>, <span class="number">0xFF</span>, <span class="number">0xA7</span>, <span class="number">0x83</span>, <span class="number">0xA8</span>, <span class="number">0xE3</span>, <span class="number">0xA9</span>, <span class="number">0x39</span>, <span class="number">0xAA</span>, <span class="number">0x56</span>, <span class="number">0xAB</span>, <span class="number">0xF7</span>, <span class="number">0xAC</span>, <span class="number">0x64</span>, <span class="number">0xAD</span>, <span class="number">0xF8</span>, <span class="number">0xAE</span>, <span class="number">0x6D</span>, <span class="number">0xAF</span>, <span class="number">0xAC</span>, <span class="number">0xB0</span>, <span class="number">0xA5</span>, <span class="number">0xB1</span>, <span class="number">0xF6</span>, <span class="number">0xB2</span>, <span class="number">0xF1</span>, <span class="number">0xB3</span>, <span class="number">0x79</span>, <span class="number">0xB4</span>, <span class="number">0x53</span>, <span class="number">0xB5</span>, <span class="number">0xDA</span>, <span class="number">0xB6</span>, <span class="number">0xB1</span>, <span class="number">0xB7</span>, <span class="number">0x5D</span>, <span class="number">0xB8</span>, <span class="number">0x70</span>, <span class="number">0xB9</span>, <span class="number">0x88</span>, <span class="number">0xBA</span>, <span class="number">0x90</span>, <span class="number">0xBB</span>, <span class="number">0xEC</span>, <span class="number">0xBC</span>, <span class="number">0x7E</span>, <span class="number">0xBD</span>, <span class="number">0xB4</span>, <span class="number">0xBE</span>, <span class="number">0x8E</span>, <span class="number">0xBF</span>, <span class="number">0x25</span>, <span class="number">0xC0</span>, <span class="number">0xC3</span>, <span class="number">0xC1</span>, <span class="number">0xE0</span>, <span class="number">0xC2</span>, <span class="number">0xA0</span>, <span class="number">0xC3</span>, <span class="number">0x3B</span>, <span class="number">0xC4</span>, <span class="number">0x8F</span>, <span class="number">0xC5</span>, <span class="number">0xB9</span>, <span class="number">0xC6</span>, <span class="number">0xC4</span>, <span class="number">0xC7</span>, <span class="number">0x71</span>, <span class="number">0xC8</span>, <span class="number">0x78</span>, <span class="number">0xC9</span>, <span class="number">0xA7</span>, <span class="number">0xCA</span>, <span class="number">0x23</span>, <span class="number">0xCB</span>, <span class="number">0xEB</span>, <span class="number">0xCC</span>, <span class="number">0x73</span>, <span class="number">0xCD</span>, <span class="number">0x42</span>, <span class="number">0xCE</span>, <span class="number">0x6C</span>, <span class="number">0xCF</span>, <span class="number">0xE5</span>, <span class="number">0xD0</span>, <span class="number">0xF5</span>, <span class="number">0xD1</span>, <span class="number">0x01</span>, <span class="number">0xD2</span>, <span class="number">0x35</span>, <span class="number">0xD3</span>, <span class="number">0x75</span>, <span class="number">0xD4</span>, <span class="number">0xAB</span>, <span class="number">0xD5</span>, <span class="number">0xA6</span>, <span class="number">0xD6</span>, <span class="number">0x27</span>, <span class="number">0xD7</span>, <span class="number">0xFA</span>, <span class="number">0xD8</span>, <span class="number">0x51</span>, <span class="number">0xD9</span>, <span class="number">0x4E</span>, <span class="number">0xDA</span>, <span class="number">0x8C</span>, <span class="number">0xDB</span>, <span class="number">0x82</span>, <span class="number">0xDC</span>, <span class="number">0x68</span>, <span class="number">0xDD</span>, <span class="number">0x1F</span>, <span class="number">0xDE</span>, <span class="number">0x45</span>, <span class="number">0xDF</span>, <span class="number">0xD9</span>, <span class="number">0xE0</span>, <span class="number">0xAF</span>, <span class="number">0xE1</span>, <span class="number">0xC1</span>, <span class="number">0xE2</span>, <span class="number">0x0B</span>, <span class="number">0xE3</span>, <span class="number">0x80</span>, <span class="number">0xE4</span>, <span class="number">0x4D</span>, <span class="number">0xE5</span>, <span class="number">0x99</span>, <span class="number">0xE6</span>, <span class="number">0xFE</span>, <span class="number">0xE7</span>, <span class="number">0x2A</span>, <span class="number">0xE8</span>, <span class="number">0x95</span>, <span class="number">0xE9</span>, <span class="number">0x3A</span>, <span class="number">0xEA</span>, <span class="number">0x37</span>, <span class="number">0xEB</span>, <span class="number">0x77</span>, <span class="number">0xEC</span>, <span class="number">0x74</span>, <span class="number">0xED</span>, <span class="number">0xC8</span>, <span class="number">0xEE</span>, <span class="number">0x81</span>, <span class="number">0xEF</span>, <span class="number">0xF0</span>, <span class="number">0xF0</span>, <span class="number">0x4C</span>, <span class="number">0xF1</span>, <span class="number">0xDB</span>, <span class="number">0xF2</span>, <span class="number">0xC9</span>, <span class="number">0xF3</span>, <span class="number">0x08</span>, <span class="number">0xF4</span>, <span class="number">0xCA</span>, <span class="number">0xF5</span>, <span class="number">0x15</span>, <span class="number">0xF6</span>, <span class="number">0xCE</span>, <span class="number">0xF7</span>, <span class="number">0x57</span>, <span class="number">0xF8</span>, <span class="number">0x1E</span>, <span class="number">0xF9</span>, <span class="number">0x7F</span>, <span class="number">0xFA</span>, <span class="number">0xD5</span>, <span class="number">0xFB</span>, <span class="number">0x2C</span>, <span class="number">0xFC</span>, <span class="number">0xDE</span>, <span class="number">0xFD</span>, <span class="number">0xE8</span>, <span class="number">0xFE</span>, <span class="number">0xFC</span>, <span class="number">0xFF</span>, <span class="number">0x47</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(data),<span class="number">2</span>):</span><br><span class="line">    dic[data[i+<span class="number">1</span>]]=data[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i] = dic[enc[i]]</span><br><span class="line">    enc[i]=change_bytes(enc[i])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(enc),<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(enc[i+<span class="number">3</span>-j]),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>在学习面向对象的时候其实最大迷惑的地方就是虚函数的地方</p><h2 id="Capstone引擎的学习"><a href="#Capstone引擎的学习" class="headerlink" title="Capstone引擎的学习"></a>Capstone引擎的学习</h2><p>这里拿一道最近刚做的DownUnderCTF 2024作为学习</p><p>首先capstone是一个反汇编引擎</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cs = Cs(CS_ARCH_X86, CS_MODE_64)  <span class="comment"># 使用类 Cs 初始化 Capstone 的 Python 类。我们需要给这个类两个参数：硬件架构和硬件模式。在此示例中，我们要反汇编 X86 架构的 64 位代码。</span></span><br><span class="line">cs.detail = <span class="literal">True</span></span><br><span class="line">code = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;F30F1EFA554889E548C7057D5F0000FFFFFFFF905DC3&#x27;</span>)  <span class="comment"># 转换为字节对象</span></span><br><span class="line">discode = cs.disasm(code, <span class="number">0x3080</span>)  <span class="comment"># 用我们上面创建的类 Cs 类实例的方法 disasm() 反汇编二进制代码。 disasm 的第二个参数是第一条指令的地址，在本例中为 0x3080。</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> discode:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> % (i.address, i.mnemonic, i.op_str))</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/09/KUyVJMptYR1rTDF.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/KUyVJMptYR1rTDF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我这里随便找了一段代码，它主要实现的是反汇编</p><h3 id="DownUnderCTF-2024-jmp-flag"><a href="#DownUnderCTF-2024-jmp-flag" class="headerlink" title="DownUnderCTF 2024-jmp_flag"></a>DownUnderCTF 2024-jmp_flag</h3><p><img src="https://s2.loli.net/2024/07/09/SPkFYiLhlXaVusI.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/SPkFYiLhlXaVusI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们看最后的判断，sub_1200的返回值要为真</p><p><img src="https://s2.loli.net/2024/07/09/edsEZg2FypTu6an.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/edsEZg2FypTu6an.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>qword_9010的值要为0</p><p><img src="https://s2.loli.net/2024/07/09/8qwctUEBSVglnkD.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/8qwctUEBSVglnkD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其实就是将你传入的值作为参数，(your_input[i])*128)+0x60,然后将基址+(处理的值)赋值为rax，然后跳转rax的值，有很多个函数就是对qword_9010内存处的值进行处理</p><p><img src="https://s2.loli.net/2024/07/09/iY6htXRLmV5uabC.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/iY6htXRLmV5uabC.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>有好多函数都是对qword_9010内存处的值赋值为-1，我们要做的是让qword_9010处的值不要为-1</p><p><img src="https://s2.loli.net/2024/07/09/f6jwcnpbAeq7T5N.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/f6jwcnpbAeq7T5N.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是函数太多了，而且这里的函数都是我手动修复，我们不可能手动把值都复制出来</p><p>首先我们要获取的东西是啥，我们要获取的是&amp;操作的值，capstone的好处就是可以遍历所有函数，同时我们还可以提取里面的值，最后进行一个爆破操作</p><p><img src="https://s2.loli.net/2024/07/14/NVvMqsi26Gr1aId.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/NVvMqsi26Gr1aId.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> capstone</span><br><span class="line"></span><br><span class="line">FUNCS_START = <span class="number">0x1300</span></span><br><span class="line"></span><br><span class="line">cs = capstone.Cs(capstone.CS_ARCH_X86, capstone.CS_MODE_64)</span><br><span class="line"></span><br><span class="line">BIN = <span class="built_in">open</span>(<span class="string">&#x27;./jmp_flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">funcs = [<span class="number">0</span>] * <span class="number">128</span></span><br><span class="line">offset = FUNCS_START</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    ins = <span class="built_in">list</span>(cs.disasm(BIN[offset:offset+<span class="number">128</span>], <span class="number">0</span>))</span><br><span class="line">    offset += <span class="number">128</span></span><br><span class="line">    <span class="keyword">if</span> ins[<span class="number">6</span>].mnemonic == <span class="string">&#x27;ret&#x27;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> instruction <span class="keyword">in</span> ins:</span><br><span class="line">        <span class="keyword">if</span> instruction.mnemonic <span class="keyword">in</span> [<span class="string">&#x27;and&#x27;</span>]:</span><br><span class="line">            mask = <span class="built_in">int</span>(instruction.op_str.split()[-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">            funcs[i] = mask</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;weird&#x27;</span>, <span class="built_in">chr</span>(i))</span><br><span class="line"><span class="built_in">print</span>(funcs)</span><br><span class="line">funcs[<span class="built_in">ord</span>(<span class="string">&#x27;t&#x27;</span>)] = <span class="number">0</span></span><br><span class="line">flag = [<span class="string">&#x27;0&#x27;</span>] * <span class="number">64</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    <span class="keyword">if</span> funcs[i] == -<span class="number">1</span>: <span class="keyword">continue</span> </span><br><span class="line">    flag[<span class="built_in">bin</span>(funcs[i]).count(<span class="string">&#x27;1&#x27;</span>)]=<span class="built_in">chr</span>(i)  <span class="comment">#这里是统计二进制中1的数量，其实在复现的过程中没有想到这个，看了其它师傅的博客才注意到这个</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br></pre></td></tr></table></figure><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>其实一直想用idapython实现自动化，那天看杭电的一个师傅的博客，说他们队里面有个idapython大师，到时候取试一下这个思路</p><h2 id="学习进度"><a href="#学习进度" class="headerlink" title="学习进度"></a>学习进度</h2><p>这周主要学习了C++的面向对象和STL，C++反汇编的体现，以及capstone引擎</p><p>C++的学习进度: 学了面向对象和STL，目前只学了一些常见的STL，例如string，vector，list，map,C++的内存管理、对象模型还没有去了解</p><p>关于STL的运用，其实自己也找了一道题作为自己的检验,但是这道题明显是STL最基础的用法</p><p>同时也参考这个师傅的文章进行了学习</p><p><a href="https://bbs.kanxue.com/thread-270547.htm#msg_header_h2_1">https://bbs.kanxue.com/thread-270547.htm#msg_header_h2_1</a></p><p>同时也学习了如何用<strong>idapython  dump</strong>STL容器的内存</p><h3 id="std-string内存布局"><a href="#std-string内存布局" class="headerlink" title="std::string内存布局"></a>std::string内存布局</h3><p><img src="/../image/572.png" class="lazyload" data-srcset="/../image/572.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="572"></p><h3 id="IDA-dump脚本"><a href="#IDA-dump脚本" class="headerlink" title="IDA dump脚本"></a>IDA dump脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dbg_read_cppstr_64</span>(<span class="params">objectAddr</span>):</span><br><span class="line">    strPtr = idc.read_dbg_qword(objectAddr)</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        onebyte = idc.read_dbg_byte(strPtr+i)</span><br><span class="line">        <span class="keyword">if</span> onebyte == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result += <span class="built_in">chr</span>(onebyte)</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">     <span class="keyword">return</span> result       </span><br></pre></td></tr></table></figure><h3 id="std-map内存布局"><a href="#std-map内存布局" class="headerlink" title="std::map内存布局"></a>std::map内存布局</h3><img src="/2024/07/14/周报(二)/image" class="lazyload" data-srcset="/2024/07/14/周报(二)/image" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="  alt="578" style="zoom:150%;" /><h3 id="IDA-dump脚本-1"><a href="#IDA-dump脚本-1" class="headerlink" title="IDA dump脚本"></a>IDA dump脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parse gnu C++ stlmap</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_gnu_map_header</span>(<span class="params">address</span>):</span><br><span class="line">    root = idc.read_dbg_qword(address+<span class="number">0x10</span>)</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_gnu_map_node</span>(<span class="params">address</span>):</span><br><span class="line">    left = idc.read_dbg_qword(address+<span class="number">0x10</span>)</span><br><span class="line">    right = idc.read_dbg_qword(address+<span class="number">0x18</span>)</span><br><span class="line">    data = address+<span class="number">0x20</span></span><br><span class="line">    <span class="keyword">return</span> left,right,data</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_gnu_map_traval</span>(<span class="params">address</span>):</span><br><span class="line">    <span class="comment"># address  &lt;- std::map struct address</span></span><br><span class="line">    result = []</span><br><span class="line">    worklist = [parse_gnu_map_header(address)]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(worklist) &gt; <span class="number">0</span>:</span><br><span class="line">        addr = worklist.pop()</span><br><span class="line">        (left ,right,data)=parse_gnu_map_node(addr)</span><br><span class="line">        <span class="keyword">if</span> left &gt;<span class="number">0</span> : worklist.append(left)</span><br><span class="line">        <span class="keyword">if</span> right &gt;<span class="number">0</span>: worklist.append(right)</span><br><span class="line">        result.append(data)</span><br><span class="line">     <span class="keyword">return</span> result        </span><br></pre></td></tr></table></figure><h3 id="std-vector内存布局"><a href="#std-vector内存布局" class="headerlink" title="std::vector内存布局"></a>std::vector内存布局</h3><p><img src="/../image/575.png" class="lazyload" data-srcset="/../image/575.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="575"></p><h3 id="IDA-dump脚本-2"><a href="#IDA-dump脚本-2" class="headerlink" title="IDA dump脚本"></a>IDA dump脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dump_vector</span>(<span class="params">addr</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Dump a vector of type stf::vector&lt;type&gt; GNU C++  x64&quot;&quot;&quot;</span></span><br><span class="line">    ELEMENT_SIZE = <span class="number">8</span></span><br><span class="line">    data_addr = []</span><br><span class="line">    vector_base = idc.read_dbg_qword(addr+<span class="number">0x0</span>)</span><br><span class="line">    vector_end = idc.read_dbg_qword(addr+<span class="number">0x8</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(vector_base,vector_end,ELEMENT_SIZE):</span><br><span class="line">        data_addr.append(i)</span><br><span class="line">    <span class="keyword">return</span> data_addr    </span><br></pre></td></tr></table></figure><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="C-面向对象"><a href="#C-面向对象" class="headerlink" title="C++面向对象"></a>C++面向对象</h3><p>其实C++面向对象里面我觉得刚开始接触最难懂的地方是虚函数，就是不太懂它的运行机制，我觉得自己可能还是需要从堆栈的角度去理解一下</p><h3 id="做题遇到的问题"><a href="#做题遇到的问题" class="headerlink" title="做题遇到的问题"></a>做题遇到的问题</h3><p>就是这两天做的HITCONCTF 2024，里面有一道叫做antivirus的题目</p><p><img src="https://s2.loli.net/2024/07/14/OCY5uIRKFsiADto.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/OCY5uIRKFsiADto.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>里面给了两个文件 <strong>print_flag.cbc</strong> 和<strong>run.sh</strong>,  print_flag.cbc为反病毒的签名</p><p>run.sh里面的内容起到的作用是就是扫描这个exe是否符合这个签名</p><p><img src="https://s2.loli.net/2024/07/14/EGq4YwAvMbHZ1nU.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/EGq4YwAvMbHZ1nU.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们找到clamav</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clambc --printsrc print_flag.cbc</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/14/AiTPFYEL348zsh1.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/14/AiTPFYEL348zsh1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这个字节码有1000多行，我们肯定不能纯逆</p><p>找到一个师傅博客里面是SECCONCTF2022 一道题的考法跟这个一模一样，但是那个师傅写了个解释器，我们把它的那个解释器拿过来改一下</p><p><a href="https://tan.hatenadiary.jp/entry/2022/11/13/214219#reversing-Devil-Hunter-168-solves-31-points">https://tan.hatenadiary.jp/entry/2022/11/13/214219#reversing-Devil-Hunter-168-solves-31-points</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">name_global_file_var = <span class="string">&quot;g_fileInput&quot;</span></span><br><span class="line">def <span class="built_in">name_label</span>(id): <span class="keyword">return</span> f<span class="string">&quot;label&#123;id&#125;&quot;</span></span><br><span class="line">def <span class="built_in">name_variable</span>(id): <span class="keyword">return</span> f<span class="string">&quot;var&#123;id&#125;&quot;</span></span><br><span class="line">def <span class="built_in">name_constant</span>(id): <span class="keyword">return</span> f<span class="string">&quot;const&#123;id&#125;&quot;</span></span><br><span class="line">def <span class="built_in">name_function</span>(id): <span class="keyword">return</span> f<span class="string">&quot;Func&#123;id&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="built_in">write</span>(line):</span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">write_file_header</span>():</span><br><span class="line">    <span class="built_in">write</span>(<span class="string">&quot;&quot;</span><span class="string">&quot;// this file is genereted by script</span></span><br><span class="line"><span class="string">#include &lt;cstdio&gt;</span></span><br><span class="line"><span class="string">#include &lt;cstring&gt;</span></span><br><span class="line"><span class="string">#include &lt;stdexcept&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bool g_succeeded = false;</span></span><br><span class="line"><span class="string">signed char g_input[256];</span></span><br><span class="line"><span class="string">int g_inputLength = 0;</span></span><br><span class="line"><span class="string">int g_currentIndex = 0;</span></span><br><span class="line"><span class="string">int my_setvirusname(...)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    g_succeeded = true;</span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">int my_read(signed char*p, int length)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    // 今回のlengthは1のみ</span></span><br><span class="line"><span class="string">    if (g_currentIndex &lt; g_inputLength)</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        *p = g_input[g_currentIndex];</span></span><br><span class="line"><span class="string">        g_currentIndex += 1;</span></span><br><span class="line"><span class="string">        return 1;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        return 0;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">int my_seek(int position, int type)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    // 今回はtypeは0(=big)のみ</span></span><br><span class="line"><span class="string">    g_currentIndex = position;</span></span><br><span class="line"><span class="string">    return 0; // 特段使わなさそう</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int Func0();</span></span><br><span class="line"><span class="string">bool Func1();</span></span><br><span class="line"><span class="string">int Func2(int);</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">write_file_footer</span>():</span><br><span class="line">    <span class="built_in">write</span>(<span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int main() &#123;</span></span><br><span class="line"><span class="string">    g_inputLength = scanf(&quot;</span>%s<span class="string">&quot;, g_input);</span></span><br><span class="line"><span class="string">    Func0();</span></span><br><span class="line"><span class="string">    puts(g_succeeded ? &quot;</span>Congratulations!<span class="string">&quot; : &quot;</span>Wrong...<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">write_function_header</span>(function_id):</span><br><span class="line">    # 今回はこれでいい</span><br><span class="line">    function_id = <span class="built_in">int</span>(function_id)</span><br><span class="line">    return_type = <span class="string">&quot;bool&quot;</span> <span class="keyword">if</span> function_id == <span class="number">1</span> <span class="keyword">else</span> <span class="string">&quot;int&quot;</span></span><br><span class="line">    argument_list = f<span class="string">&quot;(int &#123;name_variable(0)&#125;)&quot;</span> <span class="keyword">if</span> function_id == <span class="number">2</span> <span class="keyword">else</span> <span class="string">&quot;()&quot;</span></span><br><span class="line">    <span class="built_in">write</span>(f<span class="string">&quot;&#123;return_type&#125; &#123;name_function(function_id)&#125;&#123;argument_list&#125; &#123;&#123;&quot;</span>)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">write_function_footer</span>():</span><br><span class="line">    <span class="built_in">write</span>(<span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">throw std::logic_error(&quot;</span>Must <span class="keyword">not</span> reach here<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">write_local_variable_line</span>(line):</span><br><span class="line">    m = re.<span class="built_in">match</span>(r<span class="string">&quot;\s*\d+\s*\[\s*(\d+)\]:\s*(.*)&quot;</span>, line)</span><br><span class="line">    assert m</span><br><span class="line">    variable_id = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">    variable_type = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">    array_part = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> variable_type == <span class="string">&quot;i32 argument&quot;</span>: <span class="keyword">return</span> # 関数ヘッダーで無理やり扱っている</span><br><span class="line">    elif variable_type == <span class="string">&quot;i1&quot;</span>: c_type = <span class="string">&quot;bool&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;i8&quot;</span>: c_type = <span class="string">&quot;signed char&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;i32&quot;</span>: c_type = <span class="string">&quot;int&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;i64&quot;</span>: c_type = <span class="string">&quot;long long&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;alloc i8&quot;</span>: c_type = <span class="string">&quot;signed char&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;alloc i64&quot;</span>: c_type = <span class="string">&quot;long long&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;i8*&quot;</span>: c_type = <span class="string">&quot;signed char*&quot;</span></span><br><span class="line">    elif variable_type == <span class="string">&quot;alloc [36 x i8]&quot;</span>: c_type = <span class="string">&quot;signed char&quot;</span>; array_part = <span class="string">&quot;[36]&quot;</span></span><br><span class="line">    <span class="keyword">else</span>: raise <span class="built_in">Exception</span>(f<span class="string">&quot;Unknown variable type: &#123;variable_type&#125;&quot;</span>)</span><br><span class="line">    <span class="built_in">write</span>(f<span class="string">&quot;&#123;c_type&#125; &#123;name_variable(variable_id)&#125;&#123;array_part&#125; = &#123;&#123;&#125;&#125;;&quot;</span>)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">write_constant_variable_line</span>(line):</span><br><span class="line">    m = re.<span class="built_in">match</span>(r<span class="string">&quot;\s*\d+\s*\[\s*(\d+)\]:\s*(\d+)\(0x[a-f0-9]+\)&quot;</span>, line)</span><br><span class="line">    assert m</span><br><span class="line">    constant_id = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">    value = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">    hexed_value = f<span class="string">&quot;0x&#123;int(value):08X&#125;&quot;</span></span><br><span class="line">    <span class="built_in">write</span>(f<span class="string">&quot;constexpr auto &#123;name_constant(constant_id)&#125; = &#123;hexed_value&#125;;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># パース結果の現在のBBを返す。</span><br><span class="line">def <span class="built_in">write_function_body_line</span>(line, variable_count, lastBbIndex):</span><br><span class="line"></span><br><span class="line">    def <span class="built_in">parse_symbol</span>(var_or_const_id):</span><br><span class="line">        assert re.<span class="built_in">match</span>(<span class="string">&quot;\d+&quot;</span>, var_or_const_id)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">name_variable</span>(var_or_const_id) <span class="keyword">if</span> (<span class="built_in">int</span>(var_or_const_id) &lt; variable_count) <span class="keyword">else</span> <span class="built_in">name_constant</span>(var_or_const_id)</span><br><span class="line">    def <span class="built_in">parse_direct_or_indirect_expression</span>(ex):</span><br><span class="line">        <span class="keyword">if</span> re.<span class="built_in">match</span>(<span class="string">&quot;\d+&quot;</span>, ex): <span class="keyword">return</span> <span class="built_in">parse_symbol</span>(ex)</span><br><span class="line">        m = re.<span class="built_in">match</span>(<span class="string">&quot;p\.(\d+)&quot;</span>, ex)</span><br><span class="line">        assert m</span><br><span class="line">        indirect_variable_id = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> f<span class="string">&quot;&#123;parse_symbol(indirect_variable_id)&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    m1 = re.<span class="built_in">match</span>(r<span class="string">&quot;\s*(\d+)\s+\d+\s*([A-Z0-9_]+)\s+\[[^]]+\]\s+(.+)&quot;</span>, line)</span><br><span class="line">    assert m1</span><br><span class="line">    BB = m1.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">    opcode = m1.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">    inst = m1.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> BB != lastBbIndex:</span><br><span class="line">        <span class="built_in">write</span>(f<span class="string">&quot;\n&#123;name_label(BB)&#125;:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> opcode == <span class="string">&quot;OP_BC_ADD&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) \+ (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; + &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_SUB&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_MUL&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) \* (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; * &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_UDIV&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_SDIV&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_UREM&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_SREM&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_SHL&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) &lt;&lt; (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; &lt;&lt; &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_LSHR&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) &gt;&gt; (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (long long)((unsigned long long)(long long)&#123;parse_symbol(lhv_var)&#125; &gt;&gt; &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ASHR&quot;</span>:</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) &gt;&gt; (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = ((long long)&#123;parse_symbol(lhv_var)&#125; &gt;&gt; &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_AND&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) &amp; (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; &amp; &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_OR&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) \| (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; | &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_XOR&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) \^ (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; ^ &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_TRUNC&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) trunc ffffffffffffffff&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; &amp; 0xffffffffffffffff);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_SEXT&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = (\d+) sext (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            var2 = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            var3 = m.<span class="built_in">group</span>(<span class="number">3</span>) # とりあえず大きめにキャストしておけばいいのでは→いや、そのbitに切り捨てが必要かもしれない</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (long long)&#123;parse_symbol(var2)&#125; &amp; 0x&#123;(1&lt;&lt;int(var3))-1:08X&#125;;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ZEXT&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_BRANCH&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;br (\d+) \? bb.(\d+) : bb.(\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            condition_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            true_branch = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            false_branch = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;if (&#123;parse_symbol(condition_var)&#125; &amp; 1) &#123;&#123;goto &#123;name_label(true_branch)&#125;;&#125;&#125; else &#123;&#123;goto &#123;name_label(false_branch)&#125;;&#125;&#125;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_JMP&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;jmp bb\.(\d)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            branch = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;goto &#123;name_label(branch)&#125;;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_RET&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;ret (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;return &#123;parse_symbol(var)&#125;;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_RET_VOID&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_EQ&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = \((\d+) == (\d+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; == &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_NE&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_UGT&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_UGE&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_ULT&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = \((\d+) &lt; (\d+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = ((unsigned long long)(long long)&#123;parse_symbol(lhv_var)&#125; &lt; (unsigned long long)(long long)&#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_ULE&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_SGT&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = \((\d+) &gt; (\d+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = ((long long)&#123;parse_symbol(lhv_var)&#125; &gt; (long long)&#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_SGE&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_SLE&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ICMP_SLT&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = \((\d+) &lt; (\d+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_symbol(lhv_var)&#125; &lt; &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_SELECT&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_CALL_DIRECT&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = call F.(\d) \((\d*)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            function_id = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            argument_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = &#123;name_function(function_id)&#125;(&#123;&#x27;&#x27;if len(argument_var)==0 else parse_symbol(argument_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_CALL_API&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            # 今回のはすべて<span class="number">2</span>引数</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = ([a-z]+)\[\d\] \(([a-z0-9.-]+), ([a-z0-9.-]+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            api_name = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            arg1_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            arg2_var = m.<span class="built_in">group</span>(<span class="number">4</span>)</span><br><span class="line">            <span class="meta"># setvirusnameの第1引数は文字列らしく、負の数が突っ込まれている。意味不明なので無視</span></span><br><span class="line">            # Func1のvar3がalloc i8なのにreadの第<span class="number">1</span>引数に渡されている。そこ以外は妥当なのでここで特別扱い</span><br><span class="line">            corrected_var1 = <span class="number">0</span> <span class="keyword">if</span> api_name == <span class="string">&quot;setvirusname&quot;</span> <span class="built_in">else</span> (<span class="string">&quot;&amp;&quot;</span> <span class="keyword">if</span> arg1_var == <span class="string">&quot;p.3&quot;</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span>) + <span class="built_in">parse_direct_or_indirect_expression</span>(arg1_var)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = my_&#123;api_name&#125;(&#123;corrected_var1&#125;, &#123;parse_direct_or_indirect_expression(arg2_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_COPY&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;cp (\d+) -&gt; (\d+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            src = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            dst = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(dst)&#125; = &#123;parse_symbol(src)&#125;;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_GEP1&quot;</span>: # <span class="number">1</span>段階の間接参照らしい</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = gep1 ([a-z0-9.]+) \+ \((\d+) \* (\d+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            var1 = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            var2 = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            var3 = m.<span class="built_in">group</span>(<span class="number">4</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_direct_or_indirect_expression(var1)&#125; + (&#123;parse_symbol(var2)&#125; * &#123;parse_symbol(var3)&#125;));&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_GEPZ&quot;</span>: # <span class="number">2</span>段階の間接参照らしい。なぜ<span class="number">2</span>でなくZなのか。</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;(\d+) = gepz ([a-z0-9.]+) \+ \((\d+)\)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            result_var = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            lhv_var = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            rhv_var = m.<span class="built_in">group</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(result_var)&#125; = (&#123;parse_direct_or_indirect_expression(lhv_var)&#125; + &#123;parse_symbol(rhv_var)&#125;);&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_GEPN&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_STORE&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;store (\d+) -&gt; ([p.\d]+)&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">            src = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            dst = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;*&#123;parse_direct_or_indirect_expression(dst)&#125; = &#123;parse_symbol(src)&#125;;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_LOAD&quot;</span>:</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;load\s+(\d+) &lt;- ([p.\d]+)&quot;</span>, inst) <span class="meta"># loadの後だけスペースが2つある,storeと文字数を合わせる都合かもしれない</span></span><br><span class="line">            assert m</span><br><span class="line">            dst = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            src = m.<span class="built_in">group</span>(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">write</span>(f<span class="string">&quot;&#123;parse_symbol(dst)&#125; = *&#123;parse_direct_or_indirect_expression(src)&#125;;&quot;</span>)</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_MEMSET&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_MEMCPY&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_MEMMOVE&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_MEMCMP&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ISBIGENDIAN&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_ABORT&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_BSWAP16&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_BSWAP32&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_BSWAP64&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_PTRDIFF32&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    elif opcode == <span class="string">&quot;OP_BC_PTRTOINT64&quot;</span>:</span><br><span class="line">        raise <span class="built_in">Exception</span>(f<span class="string">&quot;Not Implemnted: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">        def <span class="built_in">core</span>():</span><br><span class="line">            m = re.<span class="built_in">match</span>(r<span class="string">&quot;&quot;</span>, inst)</span><br><span class="line">            assert m</span><br><span class="line">        <span class="built_in">core</span>()</span><br><span class="line">    <span class="keyword">else</span>: raise <span class="built_in">Exception</span>(f<span class="string">&quot;Unknown OPCODE: &#123;opcode&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">def <span class="built_in">test</span>(line):</span><br><span class="line">    <span class="built_in">write_function_body_line</span>(None, line, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with <span class="built_in">open</span>(<span class="string">&quot;clambc_printbcir.txt.original&quot;</span>) as f:</span><br><span class="line">    lines = <span class="built_in">list</span>(f)</span><br><span class="line"></span><br><span class="line">SEPARETOR = <span class="string">&quot;------------------------------------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">write_file_header</span>()</span><br><span class="line">it = <span class="built_in">iter</span>(lines)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">        m = re.<span class="built_in">search</span>(r<span class="string">&quot;^####################### Function id   (\d)&quot;</span>, line)</span><br><span class="line">        <span class="keyword">if</span> m is <span class="keyword">not</span> None:</span><br><span class="line">            function_id = m.<span class="built_in">group</span>(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">write_function_header</span>(function_id)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">                <span class="keyword">if</span> line == <span class="string">&quot;VID  ID    VALUE&quot;</span>:<span class="keyword">break</span></span><br><span class="line">            assert <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>() == SEPARETOR</span><br><span class="line">            variable_count = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">                <span class="keyword">if</span> line == SEPARETOR: <span class="keyword">break</span></span><br><span class="line">                <span class="built_in">write_local_variable_line</span>(line)</span><br><span class="line">                variable_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">                <span class="keyword">if</span> line == <span class="string">&quot;CID  ID    VALUE&quot;</span>:<span class="keyword">break</span></span><br><span class="line">            assert <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>() == SEPARETOR</span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">                <span class="keyword">if</span> line == SEPARETOR: <span class="keyword">break</span></span><br><span class="line">                <span class="built_in">write_constant_variable_line</span>(line)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">                <span class="keyword">if</span> line == <span class="string">&quot;BB   IDX  OPCODE              [ID /IID/MOD]  INST&quot;</span>:<span class="keyword">break</span></span><br><span class="line">            assert <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>() == SEPARETOR</span><br><span class="line"></span><br><span class="line">            lastBbIndex = <span class="number">-1</span></span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                line = <span class="built_in">next</span>(it).<span class="built_in">rstrip</span>()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> line == SEPARETOR: <span class="keyword">break</span></span><br><span class="line">                lastBbIndex = <span class="built_in">write_function_body_line</span>(line, variable_count, lastBbIndex)</span><br><span class="line">            <span class="built_in">write_function_footer</span>()</span><br><span class="line">    <span class="built_in">except</span>(StopIteration): <span class="keyword">break</span></span><br><span class="line"><span class="built_in">write_file_footer</span>()</span><br></pre></td></tr></table></figure><p>后面主要遇到的问题是解析出了LLVM的代码，然后不知道如何下手了</p><p>其实也想系统的去了解一下LLVM，但是一直不知道从哪开始下手，现在遇到LLVM的题要不就是用插件，要不就是傻傻的动调</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;STL练习题&quot;&gt;&lt;a href=&quot;#STL练习题&quot; class=&quot;headerlink&quot; title=&quot;STL练习题&quot;&gt;&lt;/a&gt;STL练习题&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutte</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>日记(27)</title>
    <link href="https://5m10v3.top/2024/07/11/%E6%97%A5%E8%AE%B0(28)/"/>
    <id>https://5m10v3.top/2024/07/11/%E6%97%A5%E8%AE%B0(28)/</id>
    <published>2024-07-10T16:00:00.000Z</published>
    <updated>2024-07-12T11:59:41.826Z</updated>
    
    <content type="html"><![CDATA[<p>今天就上午学了一点C++，实在是身体太难受了，回去量了一下体温果然发烧了🤮🤮🤮，先停更一天！！！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今天就上午学了一点C++，实在是身体太难受了，回去量了一下体温果然发烧了🤮🤮🤮，先停更一天！！！&lt;/p&gt;
</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>C/C++逆向学习(二)</title>
    <link href="https://5m10v3.top/2024/07/10/C%20orC++%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0(%E4%BA%8C)/"/>
    <id>https://5m10v3.top/2024/07/10/C%20orC++%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0(%E4%BA%8C)/</id>
    <published>2024-07-09T16:00:00.000Z</published>
    <updated>2024-07-14T12:55:33.346Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Class-面向对象"><a href="#Class-面向对象" class="headerlink" title="Class-面向对象"></a>Class-面向对象</h2><h3 id="thiscall调用约定"><a href="#thiscall调用约定" class="headerlink" title="thiscall调用约定"></a>thiscall调用约定</h3><p>thiscall是唯一一个不能明确指明的函数修饰, 因为thiscall不是关键字. 它是C++类成员函数缺省的调用约定. 由于成员函数调用还有一个this指针, 因此必须特殊处理, thiscall意味着:</p><ul><li>参数从右向左入栈</li><li>如果参数个数确定, this指针通过ecx传递给被调用者, 如果参数个数不确定, this指针在所有参数压栈后被压入堆栈</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetHP</span><span class="params">(<span class="type">int</span> hp)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        HP=hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetMP</span><span class="params">(<span class="type">int</span> mp)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MP=mp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> HP;</span><br><span class="line">    <span class="type">int</span> MP;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    User u1;</span><br><span class="line">    u1.<span class="built_in">SetHP</span>(<span class="number">1</span>);</span><br><span class="line">    u1.<span class="built_in">SetMP</span>(<span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    User u2;</span><br><span class="line">    u2.<span class="built_in">SetHP</span>(<span class="number">1</span>);</span><br><span class="line">    u2.<span class="built_in">SetMP</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里我们先复习一下this指针</p><p>this指针存在于类的成员函数中,指向被调用函数所在的类实例的地址。</p><p><img src="https://s2.loli.net/2024/07/12/ARx7IFoOTitWQ4Z.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/ARx7IFoOTitWQ4Z.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们先在这里下断点，然后看反汇编</p><p><img src="https://s2.loli.net/2024/07/12/tjNpHzUv8V6ZSc3.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/tjNpHzUv8V6ZSc3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们在内存这里查看我们自己定义的u1的地址，很显然是0x0019FF18</p><p><img src="https://s2.loli.net/2024/07/12/lygPzEJcABtx2HV.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/lygPzEJcABtx2HV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>ebp-0x10的值为0x0019FF18,将u1的地址赋值给了ecx</p><p><img src="https://s2.loli.net/2024/07/12/FK4VEjdkIWeCl9B.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/FK4VEjdkIWeCl9B.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这是第一个函数的内部</p><p><img src="https://s2.loli.net/2024/07/12/hTbMNz3UiAlv5Qj.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/hTbMNz3UiAlv5Qj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们注意到它最后是自己清理堆栈的，而不是调用者，我们显示一下符号名，可以看到它pop出ecx后，将ecx存的地址赋值给了this指针</p><p><img src="https://s2.loli.net/2024/07/12/gIAy7ZComp9ufcD.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/gIAy7ZComp9ufcD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="构造函数执行机制"><a href="#构造函数执行机制" class="headerlink" title="构造函数执行机制"></a>构造函数执行机制</h3><h4 id="局部对象"><a href="#局部对象" class="headerlink" title="局部对象"></a>局部对象</h4><p>代码示例:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">rk</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">rk</span>();</span><br><span class="line">~<span class="built_in">rk</span>();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line">rk::<span class="built_in">rk</span>()</span><br><span class="line">&#123;</span><br><span class="line">age = <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line">rk::~<span class="built_in">rk</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//局部对象 无参构造函数</span></span><br><span class="line">rk mk;</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/12/qCXSQh7lPcFBZIL.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/qCXSQh7lPcFBZIL.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>ecx里面存储的是mk的地址</p><p><img src="https://s2.loli.net/2024/07/12/CZvneU2TLVkKfGB.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/CZvneU2TLVkKfGB.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们首先运行的就是构造函数</p><p><img src="https://s2.loli.net/2024/07/12/TKN4XswIAOvdD1k.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/TKN4XswIAOvdD1k.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们把ecx取出来然后将ecx存的的地址给this</p><p><img src="https://s2.loli.net/2024/07/12/sNnKoi3Qzr47RHI.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/sNnKoi3Qzr47RHI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>笔者在这里没有隐藏符号名，方便可以快速浏览出是什么意思</p><p>下图是笔者选择隐藏了符号名</p><p><img src="https://s2.loli.net/2024/07/12/c8ygRNplZEJOL3S.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/c8ygRNplZEJOL3S.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="堆对象"><a href="#堆对象" class="headerlink" title="堆对象"></a>堆对象</h4><p>示例代码</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">rk</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">rk</span>();</span><br><span class="line">    ~<span class="built_in">rk</span>();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line">rk::<span class="built_in">rk</span>()</span><br><span class="line">&#123;</span><br><span class="line">    age = <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line">rk::~<span class="built_in">rk</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//堆对象</span></span><br><span class="line">    rk *p = <span class="keyword">new</span> <span class="built_in">rk</span>();</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/12/E97nSIpAcFiLkQX.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/E97nSIpAcFiLkQX.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>构造函数</p><p><img src="https://s2.loli.net/2024/07/12/v87sFw1ZNfKHIoe.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/v87sFw1ZNfKHIoe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h3><p>与上面构造函数分析相似，这里不做过多展示</p><h3 id="虚函数"><a href="#虚函数" class="headerlink" title="虚函数"></a>虚函数</h3><h4 id="有虚函数情况下的构造函数"><a href="#有虚函数情况下的构造函数" class="headerlink" title="有虚函数情况下的构造函数"></a>有虚函数情况下的构造函数</h4><p>示例代码:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">setAge</span><span class="params">(<span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">Person person;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造函数</p><p><img src="https://s2.loli.net/2024/07/12/UO9wvbca4yCel6D.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/UO9wvbca4yCel6D.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="虚函数调用"><a href="#虚函数调用" class="headerlink" title="虚函数调用"></a>虚函数调用</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">virtual <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line">virtual <span class="type">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">this-&gt;age = age;</span><br><span class="line">&#125;</span><br><span class="line">private:</span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line">Person person;</span><br><span class="line">person.setAge(<span class="number">20</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, person.getAge());</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/12/I5rDjU476WxQ3TV.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/I5rDjU476WxQ3TV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>构造函数，thiscall调用</p><p>setAge函数：把参数赋值给成员变量，这里要注意，对象地址的第一个位置是vftable，第一个成员变量的位置在4个字节后</p><p><img src="https://s2.loli.net/2024/07/12/EqUmygSvCQirFhM.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/EqUmygSvCQirFhM.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="有虚函数情况下的虚构函数"><a href="#有虚函数情况下的虚构函数" class="headerlink" title="有虚函数情况下的虚构函数"></a>有虚函数情况下的虚构函数</h4><p>示例代码:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">~<span class="built_in">Person</span>() &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;~Person()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">setAge</span><span class="params">(<span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">Person person;</span><br><span class="line">person.<span class="built_in">setAge</span>(<span class="number">20</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, person.<span class="built_in">getAge</span>());</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/12/Cr2wpAYc5xLiqWV.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/Cr2wpAYc5xLiqWV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>析构函数：这里把虚表拿出来，是为继承关系做准备，没继承关系则无事发生，有继承关系，需要把虚表指针指向对应的子类或父类</p><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><h4 id="单继承"><a href="#单继承" class="headerlink" title="单继承"></a>单继承</h4><p>示例代码:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;<span class="comment">//基类定义</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Base</span>() &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Base\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">~<span class="built_in">Base</span>() &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;~Base\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setNumber</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">base = n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span>base;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive</span> : <span class="keyword">public</span> Base &#123;  <span class="comment">//派生类定义</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showNumber</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="built_in">setNumber</span>(n);</span><br><span class="line">derive = n + <span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">getNumber</span>());</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, derive);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> derive;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">Derive derive;</span><br><span class="line">derive.<span class="built_in">showNumber</span>(argc);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：主函数主要就两个地方，一个是构造函数，一个是成员函数的调用</p><p><img src="https://s2.loli.net/2024/07/12/2DQNasJUjiwdgm6.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/2DQNasJUjiwdgm6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>构造函数：因为子类没有构造函数，所以这里就只调用了父类的构造函数</p><p><img src="https://s2.loli.net/2024/07/12/BU7jvbac1F4NZKo.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/BU7jvbac1F4NZKo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>成员函数：调用父类函数，父类函数内部给对象第一个成员赋值，后面给子类成员变量赋值则是给对象地址第二个成员赋值，说明对象地址里按顺序依次存放的是父类成员，然后子类成员</p><h4 id="派生多子类"><a href="#派生多子类" class="headerlink" title="派生多子类"></a>派生多子类</h4><p>示例代码</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;<span class="comment">// 基类—&quot; 人 &quot; 类</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Person</span>() &#123;&#125;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Person</span>() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">showSpeak</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 纯虚函数，后面会讲解</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chinese</span> : <span class="keyword">public</span> Person &#123;<span class="comment">// 中国人：继承自人类</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Chinese</span>() &#123;&#125;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Chinese</span>() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">showSpeak</span><span class="params">()</span> </span>&#123;<span class="comment">// 覆盖基类虚函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Speak Chinese\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">American</span> : <span class="keyword">public</span> Person &#123; <span class="comment">//美国人：继承自人类</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">American</span>() &#123;&#125;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">American</span>() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">showSpeak</span><span class="params">()</span> </span>&#123; <span class="comment">//覆盖基类虚函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Speak American\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">German</span> : <span class="keyword">public</span> Person &#123; <span class="comment">//德国人：继承自人类</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">German</span>() &#123;&#125;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">German</span>() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">showSpeak</span><span class="params">()</span> </span>&#123; <span class="comment">//覆盖基类虚函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Speak German\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">speak</span><span class="params">(Person* person)</span> </span>&#123; <span class="comment">//根据虚表信息获取虚函数首地址并调用</span></span><br><span class="line">person-&gt;<span class="built_in">showSpeak</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">Chinese chinese;</span><br><span class="line">American american;</span><br><span class="line">German german;</span><br><span class="line"><span class="built_in">speak</span>(&amp;chinese);</span><br><span class="line"><span class="built_in">speak</span>(&amp;american);</span><br><span class="line"><span class="built_in">speak</span>(&amp;german);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析：</p><p>主函数：连续三个构造函数，然后连续三个speak函数调用，分别传入这三个对象的首地址</p><p><img src="https://s2.loli.net/2024/07/12/nUFxpW4oSEHDkZf.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/nUFxpW4oSEHDkZf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>对象1的构造函数：取出对象首地址，调用父类构造函数，因为父类有虚函数，所以这里父类构造函数会给虚表赋值，因为子类重写父类虚函数，所以子类虚表覆盖对象首地址父类虚表</p><p><img src="https://s2.loli.net/2024/07/12/3M6Jc7lHm5RiYpI.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/3M6Jc7lHm5RiYpI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>speak函数：从虚表里找到第二个函数，然后拿来调用，为什么是第二个函数呢，看源代码可以发现，子类成员方法有两个是虚方法，当前调用的这个是第二个声明的</p><p><img src="https://s2.loli.net/2024/07/12/yjPD7McaTpRVzSX.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/yjPD7McaTpRVzSX.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="多重继承"><a href="#多重继承" class="headerlink" title="多重继承"></a>多重继承</h4><p>示例代码:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sofa</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Sofa</span>() &#123;</span><br><span class="line">color = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Sofa</span>() &#123;<span class="comment">// 沙发类虚析构函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;virtual ~Sofa()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;<span class="comment">// 获取沙发颜色</span></span><br><span class="line"><span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sitDown</span><span class="params">()</span> </span>&#123;<span class="comment">// 沙发可以坐下休息</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Sit down and rest your legs\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> color;<span class="comment">// 沙发类成员变量</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义床类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bed</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Bed</span>() &#123;</span><br><span class="line">length = <span class="number">4</span>;</span><br><span class="line">width = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Bed</span>() &#123;  <span class="comment">//床类虚析构函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;virtual ~Bed()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123; <span class="comment">//获取床面积</span></span><br><span class="line"><span class="keyword">return</span> length * width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;  <span class="comment">//床可以用来睡觉</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;go to sleep\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> length;<span class="comment">//床类成员变量</span></span><br><span class="line"><span class="type">int</span> width;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类沙发床定义，派生自 Sofa 类和 Bed 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SofaBed</span> : <span class="keyword">public</span> Sofa, <span class="keyword">public</span> Bed &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">SofaBed</span>() &#123;</span><br><span class="line">height = <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">SofaBed</span>() &#123;<span class="comment">//沙发床类的虚析构函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;virtual ~SofaBed()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sitDown</span><span class="params">()</span> </span>&#123;<span class="comment">//沙发可以坐下休息</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Sit down on the sofa bed\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;<span class="comment">//床可以用来睡觉</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;go to sleep on the sofa bed\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> height;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">SofaBed sofabed;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/12/zMTuJSeWfqO4dYB.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/zMTuJSeWfqO4dYB.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>构造和析构的流程是相反的，这里的流程包括了执行顺序和对虚表的操作</strong>：</p><ul><li>构造：先父类构造，再子类构造，然后把虚表全部覆盖成当前子类的</li><li>析构：先把虚表全部替换成当前子类的，然后子类析构，再父类析构</li></ul><h4 id="子类对象转父类指针"><a href="#子类对象转父类指针" class="headerlink" title="子类对象转父类指针"></a>子类对象转父类指针</h4><p>示例代码:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sofa</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Sofa</span>() &#123;</span><br><span class="line">color = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Sofa</span>() &#123;<span class="comment">// 沙发类虚析构函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;virtual ~Sofa()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;<span class="comment">// 获取沙发颜色</span></span><br><span class="line"><span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sitDown</span><span class="params">()</span> </span>&#123;<span class="comment">// 沙发可以坐下休息</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Sit down and rest your legs\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> color;<span class="comment">// 沙发类成员变量</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义床类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bed</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Bed</span>() &#123;</span><br><span class="line">length = <span class="number">4</span>;</span><br><span class="line">width = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Bed</span>() &#123;  <span class="comment">//床类虚析构函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;virtual ~Bed()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123; <span class="comment">//获取床面积</span></span><br><span class="line"><span class="keyword">return</span> length * width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;  <span class="comment">//床可以用来睡觉</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;go to sleep\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> length;<span class="comment">//床类成员变量</span></span><br><span class="line"><span class="type">int</span> width;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类沙发床定义，派生自 Sofa 类和 Bed 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SofaBed</span> : <span class="keyword">public</span> Sofa, <span class="keyword">public</span> Bed &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">SofaBed</span>() &#123;</span><br><span class="line">height = <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">SofaBed</span>() &#123;<span class="comment">//沙发床类的虚析构函数</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;virtual ~SofaBed()\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sitDown</span><span class="params">()</span> </span>&#123;<span class="comment">//沙发可以坐下休息</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Sit down on the sofa bed\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;<span class="comment">//床可以用来睡觉</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;go to sleep on the sofa bed\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> height;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">SofaBed sofabed;</span><br><span class="line">Sofa *sofa = &amp;sofabed;</span><br><span class="line">Bed *bed = &amp;sofabed;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/12/1tGJB6iuxLMqN8v.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/12/1tGJB6iuxLMqN8v.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>有虚函数的情况下，对象地址里首地址存储虚表指针</p><p>派生类的情况下，子类会依次调用父类的构造函数进行构造，然后再进行子类构造，如果父类有虚函数，则构造里会出现父类的虚函数</p><p>派生类的对象地址里会依次存放定义顺序父类成员最后才是当前派生类成员，里面会出现多个虚表，但都会被派生类的虚表覆盖</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Class-面向对象&quot;&gt;&lt;a href=&quot;#Class-面向对象&quot; class=&quot;headerlink&quot; title=&quot;Class-面向对象&quot;&gt;&lt;/a&gt;Class-面向对象&lt;/h2&gt;&lt;h3 id=&quot;thiscall调用约定&quot;&gt;&lt;a href=&quot;#thiscall调</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>Python-Capstone反汇编学习</title>
    <link href="https://5m10v3.top/2024/07/09/Python-Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0/"/>
    <id>https://5m10v3.top/2024/07/09/Python-Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0/</id>
    <published>2024-07-08T16:00:00.000Z</published>
    <updated>2024-07-14T07:14:22.398Z</updated>
    
    <content type="html"><![CDATA[<p>在复现DownUnderCTF2024发现wp中作者使用的是capstone来解的那道题,觉得是个好用的方法现在来学一下</p><p><strong>capstone官网</strong></p><p><a href="http://www.capstone-engine.org/">The Ultimate Disassembly Framework</a></p><p><strong>官方教程（python）</strong></p><p><a href="http://www.capstone-engine.org/lang_python.html">Programming with Python language</a></p><p>官方教程（C）</p><p><a href="http://www.capstone-engine.org/lang_c.html">Programming with C language</a></p><p>官方教程（Java）</p><p><a href="http://www.capstone-engine.org/lang_java.html">Programming with Java language</a></p><h3 id="基本样本"><a href="#基本样本" class="headerlink" title="基本样本"></a>基本样本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cs = Cs(CS_ARCH_X86, CS_MODE_64)  <span class="comment"># 使用类 Cs 初始化 Capstone 的 Python 类。我们需要给这个类两个参数：硬件架构和硬件模式。在此示例中，我们要反汇编 X86 架构的 64 位代码。</span></span><br><span class="line">cs.detail = <span class="literal">True</span></span><br><span class="line">code = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;F30F1EFA554889E548C7057D5F0000FFFFFFFF905DC3&#x27;</span>)  <span class="comment"># 转换为字节对象</span></span><br><span class="line">discode = cs.disasm(code, <span class="number">0x3080</span>)  <span class="comment"># 用我们上面创建的类 Cs 类实例的方法 disasm() 反汇编二进制代码。 disasm 的第二个参数是第一条指令的地址，在本例中为 0x3080。</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> discode:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> % (i.address, i.mnemonic, i.op_str))</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/09/KUyVJMptYR1rTDF.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/KUyVJMptYR1rTDF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>效果就是上图所示</p><p>上述效果图显示的的成员</p><table><thead><tr><th>成员名</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>汇编指令的id</td></tr><tr><td>address</td><td>代码地址</td></tr><tr><td>mnemonic</td><td>汇编指令</td></tr><tr><td>op_str</td><td>操作对象字符串</td></tr><tr><td>size</td><td>汇编指令的大小</td></tr><tr><td>bytes</td><td>返回对应汇编指令的机器码</td></tr><tr><td>operands</td><td>操作对象（后面介绍）</td></tr></tbody></table><h3 id="更快更简单的基本信息API"><a href="#更快更简单的基本信息API" class="headerlink" title="更快更简单的基本信息API"></a>更快更简单的基本信息API</h3><p>从版本 2.1 开始，Python 绑定在 Cs 类中提供了这个新方法 disasm_lite()。与 disasm() 不同，disasm_lite() 仅返回 (address, size, mnemonic, op_str) 的元组。基准测试显示，这种轻量级 API 比同类 API 快 30%。</p><p>此示例来自<a href="https://www.capstone-engine.org/lang_python.html">官方文档</a></p><p>下面是 disasm_lite() 的示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">CODE = <span class="string">b&quot;\x55\x48\x8b\x05\xb8\x13\x00\x00&quot;</span></span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line"><span class="keyword">for</span> (address, size, mnemonic, op_str) <span class="keyword">in</span> md.disasm_lite(CODE, <span class="number">0x1000</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> %(address, mnemonic, op_str))</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/09/L416JTQvuEkRhHU.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/L416JTQvuEkRhHU.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="架构与模式"><a href="#架构与模式" class="headerlink" title="架构与模式"></a>架构与模式</h3><p><img src="https://s2.loli.net/2024/07/09/cmTHjE5LXVAWhn7.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/cmTHjE5LXVAWhn7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/09/nZLMyNx9Eq68uGV.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/nZLMyNx9Eq68uGV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果需要在运行时动态的更换其解析模式，可以使用如下写法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">md = Cs(CS_ARCH_ARM, CS_MODE_ARM) <span class="comment"># 使用arm模式</span></span><br><span class="line"><span class="comment"># ....</span></span><br><span class="line"></span><br><span class="line">md.mode = CS_MODE_THUMB <span class="comment"># 切换到Thumb模式</span></span><br><span class="line"><span class="comment"># ....</span></span><br><span class="line"></span><br><span class="line">md.mode = CS_MODE_ARM <span class="comment"># 切换回Arm模式</span></span><br><span class="line"><span class="comment"># ....</span></span><br></pre></td></tr></table></figure><p>将额外模式与基本模式结合起来的方法是使用操作数 <code>+</code></p><p>下面的示例仍然来自<a href="https://www.capstone-engine.org/lang_python.html">官方文档</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">CODE = <span class="string">b&quot;\x56\x34\x21\x34\xc2\x17\x01\x00&quot;</span></span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_MIPS, CS_MODE_MIPS64 + CS_MODE_LITTLE_ENDIAN)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> md.disasm(CODE, <span class="number">0x1000</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%x:\t%s\t%s&quot;</span> %(i.address, i.mnemonic, i.op_str))</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/09/i9oc2rMIxeLwVJv.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/i9oc2rMIxeLwVJv.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="更多与架构无关的反汇编指令数据"><a href="#更多与架构无关的反汇编指令数据" class="headerlink" title="更多与架构无关的反汇编指令数据"></a>更多与架构无关的反汇编指令数据</h3><p>Capstone 不会生成反汇编指令的详细信息。如果我们想要隐式寄存器读&#x2F;写或该指令所属的语义组等信息，我们需要显式打开此选项，如下面的示例代码所示。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_32)</span><br><span class="line">md.detail = True</span><br></pre></td></tr></table></figure><h3 id="operands尝试"><a href="#operands尝试" class="headerlink" title="operands尝试"></a>operands尝试</h3><p>下面的示例展示了如何提取 ARM64 代码的指令操作数的详细信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone.arm64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">CODE = <span class="string">b&quot;\xe1\x0b\x40\xb9\x20\x04\x81\xda\x20\x08\x02\x8b&quot;</span></span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_ARM64, CS_MODE_ARM)</span><br><span class="line">md.detail = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> insn <span class="keyword">in</span> md.disasm(CODE, <span class="number">0x38</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> %(insn.address, insn.mnemonic, insn.op_str))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(insn.operands) &gt; <span class="number">0</span>:<span class="comment">#检查该指令是否有要打印的操作数。</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\tNumber of operands: %u&quot;</span> %<span class="built_in">len</span>(insn.operands)) <span class="comment">#打印操作数</span></span><br><span class="line">        c = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> insn.operands:<span class="comment">#遍历每一个指令的操作数</span></span><br><span class="line">            c += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i.<span class="built_in">type</span> == ARM64_OP_REG:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t\toperands[%u].type: REG = %s&quot;</span> %(c, insn.reg_name(i.value.reg)))<span class="comment">#reg寄存器的名称</span></span><br><span class="line">            <span class="keyword">if</span> i.<span class="built_in">type</span> == ARM64_OP_IMM:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t\toperands[%u].type: IMM = 0x%x&quot;</span> %(c, i.value.imm))<span class="comment">#IMM寄存器的值</span></span><br><span class="line">            <span class="keyword">if</span> i.<span class="built_in">type</span> == ARM64_OP_CIMM:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t\toperands[%u].type: C-IMM = %u&quot;</span> %(c, i.value.imm))<span class="comment">#CIMM寄存器的值</span></span><br><span class="line">            <span class="keyword">if</span> i.<span class="built_in">type</span> == ARM64_OP_FP:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t\toperands[%u].type: FP = %f&quot;</span> %(c, i.value.fp))<span class="comment">#FP寄存器的值</span></span><br><span class="line">            <span class="keyword">if</span> i.<span class="built_in">type</span> == ARM64_OP_MEM:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\t\toperands[%u].type: MEM&quot;</span> %c)</span><br><span class="line">                <span class="keyword">if</span> i.value.mem.base != <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;\t\t\toperands[%u].mem.base: REG = %s&quot;</span> \</span><br><span class="line">                        %(c, insn.reg_name(i.value.mem.base)))  <span class="comment">#基址寄存器的名称</span></span><br><span class="line">                <span class="keyword">if</span> i.value.mem.index != <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;\t\t\toperands[%u].mem.index: REG = %s&quot;</span> \</span><br><span class="line">                        %(c, insn.reg_name(i.value.mem.index)))<span class="comment">#获取第二个寄存器名称</span></span><br><span class="line">                <span class="keyword">if</span> i.value.mem.disp != <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;\t\t\toperands[%u].mem.disp: 0x%x&quot;</span> \</span><br><span class="line">                        %(c, i.value.mem.disp))  <span class="comment">#获取偏移量</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i.shift.<span class="built_in">type</span> != ARM64_SFT_INVALID <span class="keyword">and</span> i.shift.value:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\t\t\tShift: type = %u, value = %u&quot;</span> \</span><br><span class="line">                    %(i.shift.<span class="built_in">type</span>, i.shift.value))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i.ext != ARM64_EXT_INVALID:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\t\t\tExt: %u&quot;</span> %i.ext)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> insn.writeback:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\tWrite-back: True&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> insn.cc <span class="keyword">in</span> [ARM64_CC_AL, ARM64_CC_INVALID]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\tCode condition: %u&quot;</span> %insn.cc)</span><br><span class="line">    <span class="keyword">if</span> insn.update_flags:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\tUpdate-flags: True&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/09/E9vwyhJ6DrdnpWA.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/E9vwyhJ6DrdnpWA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在复现DownUnderCTF2024发现wp中作者使用的是capstone来解的那道题,觉得是个好用的方法现在来学一下&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;capstone官网&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.capstone-engin</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>DownUnderCTF2024复现学习及思考</title>
    <link href="https://5m10v3.top/2024/07/08/DownUnderCTF2024%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%80%9D%E8%80%83/"/>
    <id>https://5m10v3.top/2024/07/08/DownUnderCTF2024%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%80%9D%E8%80%83/</id>
    <published>2024-07-07T16:00:00.000Z</published>
    <updated>2024-07-14T12:28:49.595Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/beginner/number-mashing">number-mashing</a></p></li><li><p><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/rev/rusty-vault">rusty-vault</a></p></li><li><p><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/rev/jmp-flag">jmp-flag</a></p></li><li><p><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/rev/dungeon">dungeon</a></p></li><li><p><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/rev/pressing-buttons">pressing-buttons</a></p></li></ul><p>目前只学习复现了这几道题，主要是为了分享里面的一些比较好玩的做题思路，若有解释的不太好的地方，望师傅们指正🙏🏻🙏🏻🙏🏻</p><h2 id="number-mashing"><a href="#number-mashing" class="headerlink" title="number-mashing"></a>number-mashing</h2><p><img src="https://s2.loli.net/2024/07/08/LRaj7oMtd4ps2mZ.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/08/LRaj7oMtd4ps2mZ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>逻辑非常简单，输入两个整数，但是第一个判断那里其实在IDA显示的不对，看了题目出的源码才知道</p><p><img src="https://s2.loli.net/2024/07/08/5SvYBs8ZoQ9Le1N.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/08/5SvYBs8ZoQ9Le1N.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们其实可以把elf文件拖到ghidra里面</p><p>它的正常加密是</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Give me some numbers: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">    <span class="keyword">if</span>(x == <span class="number">0</span> || y == <span class="number">0</span> || y == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Nope!&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> z = x / y;</span><br><span class="line">    <span class="keyword">if</span>(z != x) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Nope!&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">0x100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    FILE* f = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fread(flag, <span class="number">1</span>, <span class="number">0x100</span>, f);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Correct! %s\n&quot;</span>, flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看完判断条件之后，我们可以发现如果从正常数学角度来说，其实是一个伪命题</p><p>那我们就从别的角度来想，它的type既然是int 类型，那我们就想一下整形溢出</p><p>int 类型的范围的是**-2147483648～2147483647**，那我们第一个数取-2147483648，第二个数取-1</p><p>(-2147483648)&#x2F;(-1)&#x3D;2147483648,整形溢出了 2147483648—&gt;-2147483648</p><p><img src="https://s2.loli.net/2024/07/08/83dYNuGPjm4BqTz.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/08/83dYNuGPjm4BqTz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="rusty-vault"><a href="#rusty-vault" class="headerlink" title="rusty-vault"></a>rusty-vault</h2><p>简单的rust逆向，AES加密-GCM模式</p><p>密文</p><p><img src="https://s2.loli.net/2024/07/09/fmo3DQBSUHMbIgC.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/fmo3DQBSUHMbIgC.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>key</p><p><img src="https://s2.loli.net/2024/07/09/D9z1WUNRauywO4l.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/D9z1WUNRauywO4l.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20240709215303.png"></p><p>nonce</p><p><img src="https://s2.loli.net/2024/07/09/DvI4sKz3wrLgh6R.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/DvI4sKz3wrLgh6R.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">nonce = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;FF 06 72 45 C6 AE 7B 9F C1 36 D4 8E&#x27;</span>) <span class="comment"># unk_4A068 passed into Aead..encrypt</span></span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;95 87 E8 E7 DE C0 3C 28 A2 8C A1 F7 35 27 23 81 6C 21 6E 10 71 4A 62 0B 9E 36 78 93 38 96 90 CF&#x27;</span>) <span class="comment"># unk_4A074 passed into Aes256Enc...KeyInit</span></span><br><span class="line"><span class="comment"># then some calls to AesGcm and input is passed then compared against ct</span></span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;65E74F390F161629CD3071C33256A6FA&#x27;</span>)[::-<span class="number">1</span>] <span class="comment"># xmmword_4A000</span></span><br><span class="line">ct += <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;ADF63090ED7FF4C81247EACCDB05FA2E&#x27;</span>)[::-<span class="number">1</span>] <span class="comment"># xmmword_4A010</span></span><br><span class="line">ct += <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;8EA036FE9AB32E3BD1B5CFA2A750B1AB&#x27;</span>)[::-<span class="number">1</span>] <span class="comment"># xmmword_4A020</span></span><br><span class="line">ct += <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;6179CBE7049F1890&#x27;</span>)[::-<span class="number">1</span>]</span><br><span class="line">ct += <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;385BD95C&#x27;</span>)[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">aes = AES.new(key, mode=AES.MODE_GCM, nonce=nonce)</span><br><span class="line">flag = aes.decrypt(ct)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#DUCTF&#123;enCrypTi0n_I5_NoT_Th3_S@me_as_H@sh1ng&#125;</span></span><br></pre></td></tr></table></figure><h2 id="jmp-flag"><a href="#jmp-flag" class="headerlink" title="jmp-flag"></a>jmp-flag</h2><p><img src="https://s2.loli.net/2024/07/09/SPkFYiLhlXaVusI.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/SPkFYiLhlXaVusI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们看最后的判断，sub_1200的返回值要为真</p><p><img src="https://s2.loli.net/2024/07/09/edsEZg2FypTu6an.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/edsEZg2FypTu6an.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>qword_9010的值要为0</p><p><img src="https://s2.loli.net/2024/07/09/8qwctUEBSVglnkD.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/8qwctUEBSVglnkD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其实就是将你传入的值作为参数，(your_input[i])*128)+0x60,然后将基址+(处理的值)赋值为rax，然后跳转rax的值，有很多个函数就是对qword_9010内存处的值进行处理</p><p><img src="https://s2.loli.net/2024/07/09/iY6htXRLmV5uabC.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/iY6htXRLmV5uabC.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>有好多函数都是对qword_9010内存处的值赋值为0</p><p><img src="https://s2.loli.net/2024/07/09/f6jwcnpbAeq7T5N.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/f6jwcnpbAeq7T5N.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是函数太多了，我们不可能手动把值都复制出来，这里我觉得还是要有一些脑洞的,我们利用capstone这个反汇编引擎</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> capstone</span><br><span class="line"></span><br><span class="line">FUNCS_START = <span class="number">0x1300</span></span><br><span class="line"></span><br><span class="line">cs = capstone.Cs(capstone.CS_ARCH_X86, capstone.CS_MODE_64)</span><br><span class="line"></span><br><span class="line">BINARY = <span class="built_in">open</span>(<span class="string">&#x27;./jmp_flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">funcs = [-<span class="number">1</span>] * <span class="number">128</span></span><br><span class="line">offset = FUNCS_START</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    ins = <span class="built_in">list</span>(cs.disasm(BINARY[offset:offset+<span class="number">128</span>], <span class="number">0</span>))</span><br><span class="line">    offset += <span class="number">128</span></span><br><span class="line">    <span class="keyword">if</span> ins[<span class="number">6</span>].mnemonic == <span class="string">&#x27;ret&#x27;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> instruction <span class="keyword">in</span> ins:</span><br><span class="line">        <span class="keyword">if</span> instruction.mnemonic <span class="keyword">in</span> [<span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;movabs&#x27;</span>]:</span><br><span class="line">            mask = <span class="built_in">int</span>(instruction.op_str.split()[-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">            funcs[i] = mask</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;weird&#x27;</span>, <span class="built_in">chr</span>(i))</span><br><span class="line"><span class="built_in">print</span>(funcs)</span><br><span class="line">funcs[<span class="built_in">ord</span>(<span class="string">&#x27;t&#x27;</span>)] = <span class="number">0</span></span><br><span class="line">flag = [<span class="string">&#x27;~&#x27;</span>] * <span class="number">64</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    <span class="keyword">if</span> funcs[i] == -<span class="number">1</span>: <span class="keyword">continue</span> </span><br><span class="line">    flag[<span class="built_in">bin</span>(funcs[i]).count(<span class="string">&#x27;1&#x27;</span>)]=<span class="built_in">chr</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/09/XuT3m18Ozx64SMF.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/09/XuT3m18Ozx64SMF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="dungeon"><a href="#dungeon" class="headerlink" title="dungeon"></a>dungeon</h2><p>我觉得这个题比较好玩一点,动态迷宫问题</p>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/beginner/number-mashing&quot;&gt;number-mashing&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>周报(一)</title>
    <link href="https://5m10v3.top/2024/07/07/%E5%91%A8%E6%8A%A5(%E4%B8%80)/"/>
    <id>https://5m10v3.top/2024/07/07/%E5%91%A8%E6%8A%A5(%E4%B8%80)/</id>
    <published>2024-07-06T16:00:00.000Z</published>
    <updated>2024-07-13T07:32:36.948Z</updated>
    
    <content type="html"><![CDATA[<p>这一周完成的任务</p><ul><li><p>汇编知识的重新梳理</p></li><li><p>C语言在逆向中的体现</p></li><li><p>做了春秋联赛的夏季赛</p></li></ul><p><img src="https://s2.loli.net/2024/07/07/STU6rzX7AOkwaGW.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/STU6rzX7AOkwaGW.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>汇编的部分笔记，当时只记了一些比较重要的知识，写的不是那么全面，所以就没放到博客上面🙏🙏🙏</p><p>以上是简单概括，接下来讲一讲这周以来的得与失</p><h2 id="关于”得”"><a href="#关于”得”" class="headerlink" title="关于”得”"></a><strong>关于”得”</strong></h2><p>这一周的前四天都在梳理汇编与C，以及逆向中C的体现，之前太过于依赖IDA的F5，这次一直在使用DBG&#x2F;ollydbg在进行调试学习</p><p><img src="https://s2.loli.net/2024/07/07/c3v7gOWmLZAE9bs.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/c3v7gOWmLZAE9bs.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/07/wfy4VuWqr1RNJEj.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/wfy4VuWqr1RNJEj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>也自己画了好多堆栈图，自己画的时候我觉得是比较浪费时间的，但是它给我带来的效果确实比较好</p><p>例如今天刚看了国外的<a href="https://play.duc.tf/">DownUnderCTF 2024</a>比赛</p><p>里面有一道叫做<strong>jmp flag</strong>的题目</p><p><img src="https://s2.loli.net/2024/07/07/Af4mNSwHqy7jIo9.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/Af4mNSwHqy7jIo9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>从main来看逻辑非常的简单</p><p><img src="https://s2.loli.net/2024/07/07/xU6n9iRLGYu4dFH.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/xU6n9iRLGYu4dFH.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>从伪代码中看不出来什么，我们从汇编层面来看</p><p><img src="https://s2.loli.net/2024/07/07/DcN62oXKIdb9HsQ.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/DcN62oXKIdb9HsQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>之前的时候还需要一句一句来看，现在基本可以稍微快一点看出大致逻辑</p><p>其实就是将你传入的参数经过((your_input[i])&lt;&lt;7)+0x60的操作</p><p>然后有一个基址0x55BCDAEF02A4，把经过处理的值作为偏移值，每一个偏移值对应就是一个函数的地址</p><p>虽然分析的不是很快，但是已经比之前有进步了，还得加强训练</p><p>另外一件事就是周五打了春秋联赛-夏季赛，这次是AK了，比去年冬天只会做签到题有进步</p><p><img src="https://s2.loli.net/2024/07/07/mxqpuD6MhLUPTc1.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/mxqpuD6MhLUPTc1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="关于”失”"><a href="#关于”失”" class="headerlink" title="关于”失”"></a><strong>关于”失”</strong></h2><p>在学习和做题的过程中，有的时候总会遗漏一些很细小的点，比如做这个C++逆向的时候，它有一个检测debugger的点，自己下意识的给nop掉了，其实这个对后面的tea加密的密钥的修改有很重要的作用，导致卡了自己一段时间</p><p>还有就是做python逆向的时候，解包出来后它那个题有个自己导入的 import key ，所以你肯定要找到那个key，其实它就在PYZ-00.pyz_extracted文件里面，但是当时解包出来打开以后发现没有文件，当时也没有多想，其实是当时文件没有加载出来，后面的两道题做出来了，第一道题也还没做出来🤡,只能说是自己的小丑行为了</p><p>下一周待完成的任务</p><ul><li>C++学习与逆向</li><li>PE文件学习</li><li>WIN32学习</li></ul><p>如果学有余力就搞一些反调试和软件保护,既然是夯实自己的基础,就争取多在质量上下工夫,而不是数量</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一周完成的任务&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;汇编知识的重新梳理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;C语言在逆向中的体现&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;做了春秋联赛的夏季赛&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.n</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>2024春秋联赛-夏季赛</title>
    <link href="https://5m10v3.top/2024/07/06/2024%E6%98%A5%E7%A7%8B%E8%81%94%E8%B5%9B-%E5%A4%8F%E5%AD%A3%E8%B5%9B/"/>
    <id>https://5m10v3.top/2024/07/06/2024%E6%98%A5%E7%A7%8B%E8%81%94%E8%B5%9B-%E5%A4%8F%E5%AD%A3%E8%B5%9B/</id>
    <published>2024-07-05T16:00:00.000Z</published>
    <updated>2024-07-08T13:17:13.606Z</updated>
    
    <content type="html"><![CDATA[<p><strong>REVERSE</strong></p><ul><li><strong>snack</strong></li><li><strong>HardSignin</strong></li><li><strong>BEDTEA</strong></li></ul><p>附件在此，师傅们自取</p><p><a href="https://wwb.lanzout.com/iP5Fl23wywed">https://wwb.lanzout.com/iP5Fl23wywed</a></p><h2 id="Snake"><a href="#Snake" class="headerlink" title="Snake"></a>Snake</h2><p>python逆向</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python pyinstxtractor.py snake.exe</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/06/RYozmagP6KTcqUr.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/06/RYozmagP6KTcqUr.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>python3.8 直接选择在线pyc编译网站</p><p><a href="https://www.lddgo.net/string/pyc-compile-decompile">https://www.lddgo.net/string/pyc-compile-decompile</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Visit https://www.lddgo.net/string/pyc-compile-decompile for more information</span></span><br><span class="line"><span class="comment"># Version : Python 3.8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">key</span>):</span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % key_length]) % <span class="number">256</span></span><br><span class="line">        S[i] = S[j]</span><br><span class="line">        S[j] = S[i]</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key_stream</span>(<span class="params">S, length</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    key_stream = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i] = S[j]</span><br><span class="line">        S[j] = S[i]</span><br><span class="line">        key_stream.append(S[(S[i] + S[j]) % <span class="number">256</span>])</span><br><span class="line">    <span class="keyword">return</span> key_stream</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    S = initialize(key)</span><br><span class="line">    key_stream = generate_key_stream(S, <span class="built_in">len</span>(data))</span><br><span class="line">    decrypted_data = <span class="literal">None</span>((<span class="keyword">lambda</span> <span class="number">.0</span> = <span class="literal">None</span>: [ i ^ data[i] ^ key_stream[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">.0</span> ])(<span class="built_in">range</span>(<span class="built_in">len</span>(data))))</span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"></span><br><span class="line">pygame.init()</span><br><span class="line">WINDOW_WIDTH = <span class="number">800</span></span><br><span class="line">WINDOW_HEIGHT = <span class="number">600</span></span><br><span class="line">SNAKE_SIZE = <span class="number">20</span></span><br><span class="line">SNAKE_SPEED = <span class="number">20</span></span><br><span class="line">WHITE = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">BLACK = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">RED = (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">window = pygame.display.set_mode((WINDOW_WIDTH, WINDOW_HEIGHT))</span><br><span class="line">pygame.display.set_caption(<span class="string">&#x27;贪吃蛇&#x27;</span>)</span><br><span class="line">font = pygame.font.Font(<span class="literal">None</span>, <span class="number">36</span>)</span><br><span class="line">snake = [</span><br><span class="line">    (<span class="number">200</span>, <span class="number">200</span>),</span><br><span class="line">    (<span class="number">210</span>, <span class="number">200</span>),</span><br><span class="line">    (<span class="number">220</span>, <span class="number">200</span>)]</span><br><span class="line">snake_direction = (SNAKE_SPEED, <span class="number">0</span>)</span><br><span class="line">food = ((random.randint(<span class="number">0</span>, WINDOW_WIDTH - SNAKE_SIZE) // SNAKE_SIZE) * SNAKE_SIZE, (random.randint(<span class="number">0</span>, WINDOW_HEIGHT - SNAKE_SIZE) // SNAKE_SIZE) * SNAKE_SIZE)</span><br><span class="line">key_bytes = <span class="built_in">bytes</span>((<span class="keyword">lambda</span> <span class="number">.0</span>: [ <span class="built_in">ord</span>(char) <span class="keyword">for</span> char <span class="keyword">in</span> <span class="number">.0</span> ])(key.xor_key))</span><br><span class="line">data = [</span><br><span class="line">    <span class="number">101</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">39</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">218</span>,</span><br><span class="line">    <span class="number">172</span>,</span><br><span class="line">    <span class="number">205</span>,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    <span class="number">235</span>,</span><br><span class="line">    <span class="number">195</span>,</span><br><span class="line">    <span class="number">72</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">130</span>,</span><br><span class="line">    <span class="number">103</span>,</span><br><span class="line">    <span class="number">213</span>,</span><br><span class="line">    <span class="number">120</span>,</span><br><span class="line">    <span class="number">227</span>,</span><br><span class="line">    <span class="number">193</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">174</span>,</span><br><span class="line">    <span class="number">71</span>,</span><br><span class="line">    <span class="number">162</span>,</span><br><span class="line">    <span class="number">248</span>,</span><br><span class="line">    <span class="number">244</span>,</span><br><span class="line">    <span class="number">12</span>,</span><br><span class="line">    <span class="number">238</span>,</span><br><span class="line">    <span class="number">92</span>,</span><br><span class="line">    <span class="number">160</span>,</span><br><span class="line">    <span class="number">203</span>,</span><br><span class="line">    <span class="number">185</span>,</span><br><span class="line">    <span class="number">155</span>]</span><br><span class="line">decrypted_data = decrypt(<span class="built_in">bytes</span>(data), key_bytes)</span><br><span class="line">running = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> running:</span><br><span class="line">    window.fill(BLACK)</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">            running = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYDOWN <span class="keyword">or</span> event.key == pygame.K_UP:</span><br><span class="line">            snake_direction = (<span class="number">0</span>, -SNAKE_SPEED)</span><br><span class="line">        <span class="keyword">elif</span> event.key == pygame.K_DOWN:</span><br><span class="line">            snake_direction = (<span class="number">0</span>, SNAKE_SPEED)</span><br><span class="line">        <span class="keyword">elif</span> event.key == pygame.K_LEFT:</span><br><span class="line">            snake_direction = (-SNAKE_SPEED, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">elif</span> event.key == pygame.K_RIGHT:</span><br><span class="line">            snake_direction = (SNAKE_SPEED, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            snake_head = (snake[<span class="number">0</span>][<span class="number">0</span>] + snake_direction[<span class="number">0</span>], snake[<span class="number">0</span>][<span class="number">1</span>] + snake_direction[<span class="number">1</span>])</span><br><span class="line">            snake.insert(<span class="number">0</span>, snake_head)</span><br><span class="line">            snake.pop()</span><br><span class="line">            <span class="keyword">if</span> snake[<span class="number">0</span>] == food:</span><br><span class="line">                food = ((random.randint(<span class="number">0</span>, WINDOW_WIDTH - SNAKE_SIZE) // SNAKE_SIZE) * SNAKE_SIZE, (random.randint(<span class="number">0</span>, WINDOW_HEIGHT - SNAKE_SIZE) // SNAKE_SIZE) * SNAKE_SIZE)</span><br><span class="line">                snake.append(snake[-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> snake[<span class="number">0</span>][<span class="number">0</span>] &lt; <span class="number">0</span> <span class="keyword">and</span> snake[<span class="number">0</span>][<span class="number">0</span>] &gt;= WINDOW_WIDTH <span class="keyword">and</span> snake[<span class="number">0</span>][<span class="number">1</span>] &lt; <span class="number">0</span> <span class="keyword">and</span> snake[<span class="number">0</span>][<span class="number">1</span>] &gt;= WINDOW_HEIGHT <span class="keyword">or</span> snake[<span class="number">0</span>] <span class="keyword">in</span> snake[<span class="number">1</span>:]:</span><br><span class="line">        running = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> segment <span class="keyword">in</span> snake:</span><br><span class="line">        pygame.draw.rect(window, WHITE, (segment[<span class="number">0</span>], segment[<span class="number">1</span>], SNAKE_SIZE, SNAKE_SIZE))</span><br><span class="line">    pygame.draw.rect(window, RED, (food[<span class="number">0</span>], food[<span class="number">1</span>], SNAKE_SIZE, SNAKE_SIZE))</span><br><span class="line">    score_text = font.render(<span class="string">f&#x27;&#x27;&#x27;Score: <span class="subst">&#123;<span class="built_in">len</span>(snake)&#125;</span>&#x27;&#x27;&#x27;</span>, <span class="literal">True</span>, WHITE)</span><br><span class="line">    speed_text = font.render(<span class="string">f&#x27;&#x27;&#x27;Speed: <span class="subst">&#123;SNAKE_SPEED&#125;</span>&#x27;&#x27;&#x27;</span>, <span class="literal">True</span>, WHITE)</span><br><span class="line">    window.blit(score_text, (<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">    window.blit(speed_text, (<span class="number">10</span>, <span class="number">40</span>))</span><br><span class="line">    score = <span class="built_in">len</span>(snake)</span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">9999</span>:</span><br><span class="line">        flag_text = font.render(<span class="string">&#x27;Flag: &#x27;</span> + decrypted_data.decode(), <span class="literal">True</span>, WHITE)</span><br><span class="line">        window.blit(flag_text, (<span class="number">10</span>, <span class="number">70</span>))</span><br><span class="line">    pygame.display.update()</span><br><span class="line">    pygame.time.Clock().tick(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">pygame.quit()</span><br></pre></td></tr></table></figure><p>很明显是RC4加密，只需要找到key就行，key.pyc在PYZ-00.pyz_extracted里面也拖到在线编译网站</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xor_key = &#x27;V3rY_v3Ry_Ez&#x27;</span><br></pre></td></tr></table></figure><p>exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">def initialize(key):</span><br><span class="line">    key_length = len(key)</span><br><span class="line">    S = list(range(256))</span><br><span class="line">    j = 0</span><br><span class="line">    for i in range(256):</span><br><span class="line">        j = (j + S[i] + key[i % key_length]) % 256</span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    return S</span><br><span class="line">def generate_key_stream(S, length):</span><br><span class="line">    i = 0</span><br><span class="line">    j = 0</span><br><span class="line">    key_stream = []</span><br><span class="line">    for _ in range(length):</span><br><span class="line">        i = (i + 1) % 256</span><br><span class="line">        j = (j + S[i]) % 256</span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        key_stream.append(S[(S[i] + S[j]) % 256])</span><br><span class="line">    return key_stream</span><br><span class="line">def decrypt(data, key):</span><br><span class="line">    # Convert key to list of byte values</span><br><span class="line">    key = [ord(c) for c in key]</span><br><span class="line">    S = initialize(key)</span><br><span class="line">    key_stream = generate_key_stream(S, len(data))</span><br><span class="line">    # XOR the data with the keystream to get the decrypted data</span><br><span class="line">    decrypted_data = [i^data[i] ^ key_stream[i] for i in range(len(data))]</span><br><span class="line">    return decrypted_data</span><br><span class="line">data = [</span><br><span class="line">    101, 97, 39, 125, 218, 172, 205, 3, 235, 195, 72, 125, 89, 130, 103, 213,</span><br><span class="line">    120, 227, 193, 67, 174, 71, 162, 248, 244, 12, 238, 92, 160, 203, 185, 155</span><br><span class="line">]</span><br><span class="line">key_bytes = &quot;V3rY_v3Ry_Ez&quot;</span><br><span class="line">decrypted_data = decrypt(data, key_bytes)</span><br><span class="line">for i  in range(len(decrypted_data)):</span><br><span class="line">    print(chr(decrypted_data[i]),end=&#x27;&#x27;)</span><br><span class="line">#flag&#123;KMLTz3lT_MePUDa7A_P5LpzCBT&#125;</span><br></pre></td></tr></table></figure><h2 id="HardSignin"><a href="#HardSignin" class="headerlink" title="HardSignin"></a>HardSignin</h2><p><img src="https://s2.loli.net/2024/07/07/6SlFvRWqakiDeon.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/6SlFvRWqakiDeon.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>改特征值，UPX脱壳</p><p><img src="https://s2.loli.net/2024/07/07/WOPuBho1XTAew4J.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/WOPuBho1XTAew4J.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>TlsCallback_0</strong></p><p><img src="https://s2.loli.net/2024/07/07/THVt8lIPabNZ42y.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/THVt8lIPabNZ42y.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>TlsCallback0是SMC自修改</p><p><img src="https://s2.loli.net/2024/07/07/wR12UgKTfN7HDYe.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/wR12UgKTfN7HDYe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>TlsCallback_1</strong></p><p><img src="https://s2.loli.net/2024/07/07/qMlanTLVy2Wwi6s.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/qMlanTLVy2Wwi6s.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>顺便教大家一下这个花指令怎么恢复的最好</p><p>首先先不要去掉jz 和 jnz</p><p>我们先在下面标红的call指令那里按d</p><p><img src="https://s2.loli.net/2024/07/07/BG43osjUumhdZFq.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/BG43osjUumhdZFq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后在我光标的那里按c恢复</p><p><img src="https://s2.loli.net/2024/07/07/6RyglXtL3pTO8x4.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/6RyglXtL3pTO8x4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后恢复成这样，之后再把 hlt指令上面的全部nop掉，jz上面的不用</p><p><img src="https://s2.loli.net/2024/07/07/olH3cvT5yerzAIC.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/olH3cvT5yerzAIC.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们就可以按p生成函数了</p><p>把base64的table表魔改了</p><p><img src="https://s2.loli.net/2024/07/07/zswfOZUFJCMIjlB.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/zswfOZUFJCMIjlB.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>TlsCallback_2</strong></p><p><img src="C:/Users/sm1ov3/AppData/Roaming/Typora/typora-user-images/image-20240707090456001.png" class="lazyload" data-srcset="C:/Users/sm1ov3/AppData/Roaming/Typora/typora-user-images/image-20240707090456001.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240707090456001"></p><p><img src="https://s2.loli.net/2024/07/07/zQpWrXkDtGBgOfR.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/zQpWrXkDtGBgOfR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>byte_4045B0,byte_4045A0这两个变量，后面会查到</p><p>idapython脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x401890</span>,<span class="number">0x4019D1</span>):</span><br><span class="line">   patch_byte(i,get_wide_byte(i)^<span class="number">0x66</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;done!&quot;</span>)</span><br></pre></td></tr></table></figure><p>还原main函数</p><p><img src="https://s2.loli.net/2024/07/07/94MJeLRorw32N5X.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/94MJeLRorw32N5X.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/07/yZQbPqaosCA1pK4.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/yZQbPqaosCA1pK4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_init</span><span class="params">(<span class="type">uint8_t</span>* s, <span class="type">uint8_t</span>* key, <span class="type">unsigned</span> <span class="type">long</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint8_t</span> k[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i] = i;         </span><br><span class="line">        k[i] = key[i % len];   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        j = (j + s[i] + k[i]) % <span class="number">256</span>;    </span><br><span class="line">        temp = s[i];</span><br><span class="line">        s[i] = s[j];</span><br><span class="line">        s[j] = temp;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_crypt</span><span class="params">(<span class="type">uint8_t</span>* s, <span class="type">uint8_t</span>* data, <span class="type">unsigned</span> <span class="type">long</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint8_t</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint8_t</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; len; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span>;            </span><br><span class="line">        j = (j + s[i]) % <span class="number">256</span>;          </span><br><span class="line">        temp = s[i];</span><br><span class="line">        s[i] = s[j];</span><br><span class="line">        s[j] = temp;            </span><br><span class="line">        t = (s[i] + s[j]) % <span class="number">256</span>;      </span><br><span class="line">        data[k] ^= s[t];          </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span>  key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x61C88647</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span>  key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x61C88647</span>, sum = <span class="number">0xcdab8c44</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    srand(<span class="number">0x1919810</span>);</span><br><span class="line">    <span class="type">uint8_t</span> key[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span> key1[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        key[i] = rand() % <span class="number">0xff</span>;</span><br><span class="line">        key1[i] = rand() % <span class="number">0xff</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">uint8_t</span> enc[<span class="number">64</span>] = &#123; <span class="number">0x59</span>, <span class="number">0x1B</span>, <span class="number">0xFD</span>, <span class="number">0xB4</span>, <span class="number">0x6B</span>, <span class="number">0xB8</span>, <span class="number">0xBE</span>, <span class="number">0xD9</span>, <span class="number">0xB3</span>, <span class="number">0xD3</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0xF0</span>, <span class="number">0x65</span>, <span class="number">0x5F</span>, <span class="number">0x18</span>, <span class="number">0xA0</span>, <span class="number">0x9D</span>, <span class="number">0x3A</span>, <span class="number">0x53</span>, <span class="number">0x6D</span>, <span class="number">0x4A</span>, <span class="number">0x7B</span>, <span class="number">0x26</span>, <span class="number">0x74</span>, <span class="number">0x3A</span>, <span class="number">0x9C</span>, <span class="number">0x4E</span>, <span class="number">0x20</span>, <span class="number">0x43</span>, <span class="number">0x19</span>, <span class="number">0xD8</span>, <span class="number">0x72</span>, <span class="number">0xED</span>, <span class="number">0x95</span>, <span class="number">0xB5</span>, <span class="number">0x9C</span>, <span class="number">0x05</span>, <span class="number">0x22</span>, <span class="number">0x56</span>, <span class="number">0xCB</span>, <span class="number">0x7A</span>, <span class="number">0x11</span>, <span class="number">0x91</span>, <span class="number">0x9F</span>, <span class="number">0x7A</span>, <span class="number">0xBC</span>, <span class="number">0x0C</span>, <span class="number">0x4A</span>, <span class="number">0x69</span>, <span class="number">0x6D</span>, <span class="number">0xCE</span>, <span class="number">0x3D</span>, <span class="number">0xB4</span>, <span class="number">0xAB</span>, <span class="number">0x29</span>, <span class="number">0x61</span>, <span class="number">0xFA</span>, <span class="number">0x62</span>, <span class="number">0x32</span>, <span class="number">0xB4</span>, <span class="number">0xEC</span>, <span class="number">0x4C</span>, <span class="number">0xB6</span> &#125;;</span><br><span class="line">    <span class="type">uint8_t</span> s[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i += <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        decipher(<span class="number">100</span>,(<span class="type">uint32_t</span>*)(enc + i), (<span class="type">uint32_t</span>*)key1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rc4_init(s, key, <span class="number">16</span>);</span><br><span class="line">    rc4_crypt(s, enc, <span class="number">64</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, enc[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>换表base64解密之后得到flag</p><p>flag{C0ngr@tulat1on!Y0u_Re_suCces3fu1Ly_Signln!}</p><h2 id="BEDTEA"><a href="#BEDTEA" class="headerlink" title="BEDTEA"></a>BEDTEA</h2><p><img src="https://s2.loli.net/2024/07/07/vz9UR8PKZQ4Gf63.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/vz9UR8PKZQ4Gf63.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/07/lEMSb754WuYwyRe.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/lEMSb754WuYwyRe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/07/1VmtiX8B2GxE3Fv.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/1VmtiX8B2GxE3Fv.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这个题里面没有反调试，但是有一个检测是否被调试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byte_404010 = !IsDebuggerPresent() ? 3 : 1;</span><br></pre></td></tr></table></figure><p>这是一个三元运算符</p><p><img src="https://s2.loli.net/2024/07/07/CKpeLhXQmGiwUuy.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/CKpeLhXQmGiwUuy.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>一开始我们并不知道这个作用是什么，那么我们就看一下哪里引用了它发现它在tea加密里面有被用到，经过调试可知明文为24个字节，已经三次tea加密里面的密钥都不相等</p><p><img src="https://s2.loli.net/2024/07/07/AqurYk5mzvQoCf3.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/AqurYk5mzvQoCf3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是这个密钥生成的过程看着很繁琐，为了节约时间，我们要下断点得到密钥</p><p><img src="https://s2.loli.net/2024/07/07/HfWuctUkdDSmPhG.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/HfWuctUkdDSmPhG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>每次断在这里，然后查看byte_408040的内存</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::chrono::_V2::system_clock::now(v7) - v4 &lt;= 10000999</span><br></pre></td></tr></table></figure><p>这个其实就是算误差的但是程序运行和我们调试的时候误差是不一样的，在调试的时候我们走的是else，但是正常程序运行应该是走if那里，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_mm_load_si128 // 就是加载内存中128位的值，并且放到向量空间里面</span><br><span class="line">_mm_xor_si128（值，si128）//就是你的值和sil128 每个值进行异或</span><br></pre></td></tr></table></figure><p>然后我们回到一开始检测调试器那里，调试的时候那里的值是1，在里面改为3，然后就会生成不同的密钥exp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* <span class="built_in">array</span>)</span> &#123;</span><br><span class="line"><span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">sum -= <span class="number">0x61CBB648</span>;</span><br><span class="line">v0 += ((v1 &gt;&gt; <span class="number">4</span>) + <span class="built_in">array</span>[<span class="number">1</span>]) ^ (v1 + sum) ^ ((v1 &lt;&lt; <span class="number">5</span>) + <span class="built_in">array</span>[<span class="number">0</span>]);</span><br><span class="line">v1 += ((v0 &gt;&gt; <span class="number">4</span>) + <span class="built_in">array</span>[<span class="number">3</span>]) ^ (v0 + sum) ^ ((v0 &lt;&lt; <span class="number">5</span>) + <span class="built_in">array</span>[<span class="number">2</span>]);</span><br><span class="line">&#125; <span class="keyword">while</span> (sum != <span class="number">0x987E55D0</span>);</span><br><span class="line">v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* <span class="built_in">array</span>)</span> &#123;</span><br><span class="line"><span class="type">uint32_t</span> sum = <span class="number">0x987E55D0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v1 -= ((v0 &gt;&gt; <span class="number">4</span>) + <span class="built_in">array</span>[<span class="number">3</span>]) ^ (v0 + sum) ^ ((v0 &lt;&lt; <span class="number">5</span>) + <span class="built_in">array</span>[<span class="number">2</span>]);</span><br><span class="line">v0 -= ((v1 &gt;&gt; <span class="number">4</span>) + <span class="built_in">array</span>[<span class="number">1</span>]) ^ (v1 + sum) ^ ((v1 &lt;&lt; <span class="number">5</span>) + <span class="built_in">array</span>[<span class="number">0</span>]);</span><br><span class="line">sum += <span class="number">0x61CBB648</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (sum != <span class="number">0</span>);</span><br><span class="line">v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint32_t</span> key1[<span class="number">4</span>] = &#123; <span class="number">0x00000003</span>, <span class="number">0x00000005</span>, <span class="number">0x00000008</span>, <span class="number">0x0000000D</span> &#125;;</span><br><span class="line"><span class="type">uint32_t</span> key2[<span class="number">4</span>] = &#123; <span class="number">0x00000015</span>, <span class="number">0x00000022</span>, <span class="number">0x00000037</span>, <span class="number">0x00000059</span> &#125;;</span><br><span class="line"><span class="type">uint32_t</span> key3[<span class="number">4</span>] = &#123; <span class="number">0x00000090</span>, <span class="number">0x000000E9</span>, <span class="number">0x00000179</span>, <span class="number">0x00000262</span> &#125;;</span><br><span class="line"><span class="type">uint8_t</span> flag[<span class="number">24</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">uint8_t</span> enc[<span class="number">24</span>] = &#123; <span class="number">0x76</span>, <span class="number">0x71</span>, <span class="number">0x9D</span>, <span class="number">0xE7</span>, <span class="number">0x70</span>, <span class="number">0x77</span>, <span class="number">0x3F</span>, <span class="number">0xA3</span>, <span class="number">0x02</span>, <span class="number">0xF1</span>, <span class="number">0x8D</span>, <span class="number">0xC9</span>, <span class="number">0x02</span>, <span class="number">0xC6</span>, <span class="number">0xA2</span>, <span class="number">0x4B</span>, <span class="number">0xBA</span>, <span class="number">0x19</span>, <span class="number">0x56</span>, <span class="number">0x05</span>, <span class="number">0xF2</span>, <span class="number">0x89</span>, <span class="number">0x5E</span>, <span class="number">0xE0</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;<span class="number">24</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">enc[i] ^= <span class="number">0x33</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; ++i) &#123;</span><br><span class="line">flag[i] = enc[<span class="number">23</span>- i];</span><br><span class="line">&#125;</span><br><span class="line">decrypt((<span class="type">uint32_t</span>*)(flag + <span class="number">16</span>), key3);</span><br><span class="line">decrypt((<span class="type">uint32_t</span>*)(flag + <span class="number">8</span>), key2);</span><br><span class="line">decrypt((<span class="type">uint32_t</span>*)flag, key1);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, flag[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#flag&#123;y0u_reallyl1ke_te@&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;REVERSE&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;snack&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HardSignin&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BEDTEA&lt;/strong&gt;&lt;/li&gt;
&lt;</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="ctf学习" scheme="https://5m10v3.top/tags/ctf%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>C/C++逆向学习(一)</title>
    <link href="https://5m10v3.top/2024/07/02/C%20orC++%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0(%E4%B8%80)/"/>
    <id>https://5m10v3.top/2024/07/02/C%20orC++%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0(%E4%B8%80)/</id>
    <published>2024-07-01T16:00:00.000Z</published>
    <updated>2024-07-12T02:12:39.138Z</updated>
    
    <content type="html"><![CDATA[<p>为啥要开个这个专题，一方面是为了巩固自己在逆向基础的知识，另一方面是为了给以后的学弟指一条明路吧，以前的时候太依赖IDA的F5了，这次学习从另一个角度重新学习逆向</p><p><img src="https://s2.loli.net/2024/07/04/D5paeXbTPREqAQM.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/D5paeXbTPREqAQM.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="汇编眼中的函数"><a href="#汇编眼中的函数" class="headerlink" title="汇编眼中的函数"></a>汇编眼中的函数</h3><p>由于现在编译器的发展，使得我们的代码得到了极大的优化，这使我们编译出的代码并不是那么适合调试，因此笔者选择VC++ 6.0 进行编写</p><p><img src="https://s2.loli.net/2024/07/04/I4hKwn5Nlkqug2v.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/I4hKwn5Nlkqug2v.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/04/kIBGKZ5N1Jnfz4o.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/kIBGKZ5N1Jnfz4o.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后将生成的exe拖到x32dbg里面，定位到main函数 ，我们此时断在的这个点就是我们要调用的函数，这里我们选择堆栈图来进行描述</p><p>首先进行call test.401005</p><p>call 其实也是一种push的操作，相当于把下一个指令的地址压入栈中</p><p><img src="https://s2.loli.net/2024/07/04/F3OXlJPaUkD7NSw.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/F3OXlJPaUkD7NSw.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这个时候我们发现EIP的值发生了变化，eip的值就是下一个指令的地址</p><p>至于开头这个jmp，是编译器搞的，可以不用去理解这个</p><p><img src="C:/Users/sm1ov3/AppData/Roaming/Typora/typora-user-images/image-20240704161706224.png" class="lazyload" data-srcset="C:/Users/sm1ov3/AppData/Roaming/Typora/typora-user-images/image-20240704161706224.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240704161706224"></p><p>之后就是push操作，我们不再一步一步分析，直接画出堆栈图，然后再一一对比</p><p><img src="https://s2.loli.net/2024/07/04/ZVhnvmOclI24PEA.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/ZVhnvmOclI24PEA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/04/ZT1cp38dILStJ7i.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/ZT1cp38dILStJ7i.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们发现最后堆栈是平衡的。</p><h3 id="裸函数"><a href="#裸函数" class="headerlink" title="裸函数"></a>裸函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//裸函数的格式</span></span><br><span class="line">数据类型 _declspec(naked) 函数名称()</span><br><span class="line">&#123;</span><br><span class="line">    函数语句;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/07/04/zBMSqXdp9ZKtivR.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/zBMSqXdp9ZKtivR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们运行之后发现会报错,然后我们可以看一下反汇编</p><p>​<img src="https://s2.loli.net/2024/07/04/wXki1lGYSoEqzMu.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/wXki1lGYSoEqzMu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>之后就会发现这个跟我之前再x32dbg里面调的不一样，这个里面全都是int3 中断</p><p>那么如何让这个程序正常运行起来呢，我们可以采用内联汇编的方式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> _declspec(naked) Function()</span><br><span class="line">&#123;</span><br><span class="line">__asm </span><br><span class="line">&#123;</span><br><span class="line">PUSH EBP</span><br><span class="line">MOV EBP, ESP</span><br><span class="line">SUB ESP,<span class="number">0x40</span></span><br><span class="line"></span><br><span class="line">PUSH EBX</span><br><span class="line">PUSH ESI</span><br><span class="line">PUSH EDI</span><br><span class="line"></span><br><span class="line">LEA EDI, DWORD PTR DS:[EBP<span class="number">-0x40</span>]</span><br><span class="line"></span><br><span class="line">MOV EAX,<span class="number">0xCCCCCCCC</span></span><br><span class="line">MOV ECX, <span class="number">0x10</span></span><br><span class="line">REP STOSD</span><br><span class="line"></span><br><span class="line">POP EDI</span><br><span class="line">POP ESI</span><br><span class="line">POP EBX</span><br><span class="line"></span><br><span class="line">MOV ESP,EBP</span><br><span class="line">POP EBP</span><br><span class="line"></span><br><span class="line">RET</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Function();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="局部变量的体现"><a href="#局部变量的体现" class="headerlink" title="局部变量的体现"></a>局部变量的体现</h3><p><img src="https://s2.loli.net/2024/07/04/6KdB1klXmsh7aZt.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/6KdB1klXmsh7aZt.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/04/yikQs1MJLtmhqxe.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/yikQs1MJLtmhqxe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里就不像上一个有过多的文字描述了，看堆栈图即可</p><h3 id="裸函数-局部变量定义"><a href="#裸函数-局部变量定义" class="headerlink" title="裸函数(局部变量定义)"></a>裸函数(局部变量定义)</h3><p>我们要学会举一反三</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line">z</span><br><span class="line"><span class="type">void</span> _declspec(naked) Function()</span><br><span class="line">&#123;</span><br><span class="line">__asm </span><br><span class="line">&#123;</span><br><span class="line">PUSH EBP</span><br><span class="line"></span><br><span class="line">MOV EBP,ESP</span><br><span class="line">SUB ESP,<span class="number">0x4C</span></span><br><span class="line"></span><br><span class="line">PUSH EBX</span><br><span class="line">PUSH ESI</span><br><span class="line">PUSH EDI</span><br><span class="line"></span><br><span class="line">LEA EDI,DWORD PTR DS:[EBP - <span class="number">0x4C</span>]</span><br><span class="line">MOV EAX,<span class="number">0xCCCCCCCC</span></span><br><span class="line">MOV ECX,<span class="number">13</span></span><br><span class="line">REP STOSD</span><br><span class="line"></span><br><span class="line">MOV DWORD PTR DS:[EBP - <span class="number">0x4</span>],<span class="number">1</span></span><br><span class="line">MOV DWORD PTR DS:[EBP - <span class="number">0x8</span>],<span class="number">2</span></span><br><span class="line">        MOV EAX, DWORD PTR DS : [EBP - <span class="number">0x4</span>]</span><br><span class="line">ADD EAX, DWORD PTR DS : [EBP - <span class="number">0x8</span>]</span><br><span class="line">MOV DWORD PTR DS : [EBP - <span class="number">0xC</span>],EAX</span><br><span class="line"></span><br><span class="line">POP EDI</span><br><span class="line">POP ESI </span><br><span class="line">POP EBX</span><br><span class="line"></span><br><span class="line">MOV ESP, EBP</span><br><span class="line">POP EBP</span><br><span class="line">RET</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Function();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="返回值的传递"><a href="#返回值的传递" class="headerlink" title="返回值的传递"></a>返回值的传递</h3><p><img src="https://s2.loli.net/2024/07/04/53vjeRaOlEf7AXV.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/53vjeRaOlEf7AXV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们经过堆栈图的分析之后</p><p><img src="https://s2.loli.net/2024/07/04/yikQs1MJLtmhqxe.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/04/yikQs1MJLtmhqxe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>发现跟之前那个一模一样</p><p>call 完函数之后，eax是我们最后return的值，但是这里的[ebp - 4]是 恢复堆栈平衡之后的地址，这里其实是main函数里面的局部变量</p><h3 id="裸函数-返回值的传递"><a href="#裸函数-返回值的传递" class="headerlink" title="裸函数(返回值的传递)"></a>裸函数(返回值的传递)</h3><p>这里做个小练习</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fun</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> b=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> a^b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a= fun();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> _declspec(naked) function()</span><br><span class="line">&#123;</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        push ebp</span><br><span class="line">        mov ebp ,esp</span><br><span class="line">        sub esp,<span class="number">0x4c</span></span><br><span class="line"></span><br><span class="line">        push ebx</span><br><span class="line">        push esi</span><br><span class="line">        push edi</span><br><span class="line">        lea edi,dword ptr ds:[ebp - <span class="number">0x4c</span>]</span><br><span class="line">        mov ecx ,<span class="number">13</span></span><br><span class="line">        mov eax,<span class="number">0xcccccccc</span></span><br><span class="line">        rep stosd</span><br><span class="line"></span><br><span class="line">        mov dword ptr ds:[ebp - <span class="number">0x4</span>],<span class="number">1</span></span><br><span class="line">        mov dword ptr ds:[ebp - <span class="number">0x8</span>],<span class="number">2</span></span><br><span class="line">        mov eax, dword ptr ds : [ebp - <span class="number">0x4</span>]</span><br><span class="line">        xor eax, dword ptr ds : [ebp - <span class="number">0x8</span>]</span><br><span class="line">        mov eax ,ecx</span><br><span class="line">        pop edi</span><br><span class="line">        pop esi</span><br><span class="line">        pop ebx</span><br><span class="line"></span><br><span class="line">        mov esp,ebp</span><br><span class="line">        pop ebp</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a = function();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比之后发现是一模一样</p><h3 id="参数的传递"><a href="#参数的传递" class="headerlink" title="参数的传递"></a>参数的传递</h3><p>示例</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> c = a + b;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a = add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:/Users/sm1ov3/Desktop/堆栈图2.png" class="lazyload" data-srcset="C:/Users/sm1ov3/Desktop/堆栈图2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="堆栈图2"></p><h3 id="裸函数-参数的传递"><a href="#裸函数-参数的传递" class="headerlink" title="裸函数(参数的传递)"></a>裸函数(参数的传递)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> _declspec(naked)add(<span class="type">int</span> a, <span class="type">int</span> b)</span><br><span class="line">&#123;</span><br><span class="line">    __asm </span><br><span class="line">    &#123;</span><br><span class="line">        push ebp</span><br><span class="line">        mov ebp, esp</span><br><span class="line">        sub esp,<span class="number">0xcc</span></span><br><span class="line">        push ebx</span><br><span class="line">        push esi</span><br><span class="line">        push edi</span><br><span class="line">        lea edi,dword ptr ds:[ebp<span class="number">-0xc</span>]</span><br><span class="line">        mov eax,<span class="number">0xcccccccc</span></span><br><span class="line">        mov ecx,<span class="number">3</span></span><br><span class="line">        rep stosd</span><br><span class="line"></span><br><span class="line">        mov eax,dword ptr [ebp+<span class="number">0x8</span>]</span><br><span class="line">        add eax,dword ptr [ebp+<span class="number">0xc</span>]</span><br><span class="line">        mov dword ptr[ebp<span class="number">-0x8</span>],eax</span><br><span class="line">        mov eax, dword ptr[ebp - <span class="number">0x8</span>]</span><br><span class="line"></span><br><span class="line">        pop edi</span><br><span class="line">        pop esi</span><br><span class="line">        pop ebx</span><br><span class="line"></span><br><span class="line">        add esp,<span class="number">0xcc</span></span><br><span class="line">        pop ebp</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a = add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="嵌套调用分析"><a href="#嵌套调用分析" class="headerlink" title="嵌套调用分析"></a>嵌套调用分析</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fun1</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span> temp = a;</span><br><span class="line">   a=b;</span><br><span class="line">   b=temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">fun2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> b=<span class="number">20</span>;</span><br><span class="line">fun1(a,b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">fun2();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析堆栈图</p><p><img src="https://s2.loli.net/2024/07/07/8hby6FwCz5jsJI2.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/8hby6FwCz5jsJI2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这是第一层函数的内部，第一层函数的堆栈图如下</p><p><img src="https://s2.loli.net/2024/07/07/ljZLi2G1YsbdTMg.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/ljZLi2G1YsbdTMg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/07/ay4WYBsKiOXdhmz.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/07/ay4WYBsKiOXdhmz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://s2.loli.net/2024/07/08/DidObRIgzuqKVMN.png" class="lazyload" data-srcset="https://s2.loli.net/2024/07/08/DidObRIgzuqKVMN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="调用约定"><a href="#调用约定" class="headerlink" title="调用约定"></a>调用约定</h3><table><thead><tr><th>调用约定</th><th>参数压栈顺序</th><th>平衡堆栈</th></tr></thead><tbody><tr><td>__cdecl</td><td>从右至左入栈</td><td>调用者清理栈</td></tr><tr><td>__stdcall</td><td>从右至左入栈</td><td>自身清理堆栈</td></tr><tr><td>__fastcall</td><td>ECX&#x2F;EDX 传送前两个 剩下:从右至左入栈</td><td>自身清理堆栈</td></tr></tbody></table><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;为啥要开个这个专题，一方面是为了巩固自己在逆向基础的知识，另一方面是为了给以后的学弟指一条明路吧，以前的时候太依赖IDA的F5了，这次学习从另一个角度重新学习逆向&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/07/04/D5paeXb</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>日记(27)</title>
    <link href="https://5m10v3.top/2024/07/01/%E6%97%A5%E8%AE%B0(27)/"/>
    <id>https://5m10v3.top/2024/07/01/%E6%97%A5%E8%AE%B0(27)/</id>
    <published>2024-06-30T16:00:00.000Z</published>
    <updated>2024-07-07T06:28:42.790Z</updated>
    
    <content type="html"><![CDATA[<p>期末周终于过去了，自己的生活也调整过来了，这个暑假准备沉淀一下关于二进制安全的学习</p><p>从明天开始，一周多更！！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;期末周终于过去了，自己的生活也调整过来了，这个暑假准备沉淀一下关于二进制安全的学习&lt;/p&gt;
&lt;p&gt;从明天开始，一周多更！！&lt;/p&gt;
</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>日记(26)</title>
    <link href="https://5m10v3.top/2024/06/15/%E6%97%A5%E8%AE%B0(26)/"/>
    <id>https://5m10v3.top/2024/06/15/%E6%97%A5%E8%AE%B0(26)/</id>
    <published>2024-06-14T16:00:00.000Z</published>
    <updated>2024-07-07T06:26:10.388Z</updated>
    
    <content type="html"><![CDATA[<p>近来学习了白龙大佬的白盒密码学系列，感觉受益匪浅，有种高山流水觅知音的感觉，也认识了跟自己志同道合的伙伴，今日上午也去考了第一次四级考试（希望没有第二次哈哈哈哈哈哈）<br>在闲暇之余也观看了跟自己同为大一下的师傅们的文章<br>一句话总结：“一山更比一山高”<br>但是这也更让我提起兴趣了，因为可以挑战这么多强有力的对手，同时也激励自己继续学<br>在这里说一下暑假的安排吧</p><ul><li><p>学习一下《逆向工程核心原理》这本书里面的知识，给自己打下一个坚实的基础吧</p></li><li><p>同时也多做题（尽量用新学到的知识去做）</p></li><li><p>多弄一些安卓知识</p></li><li><p>学习游戏安全相关的知识</p><p>在最后想用小排球里面的这张图激励自己</p><p><img src="https://s2.loli.net/2024/06/15/KnvqJ6gZFX5AcGE.jpg" class="lazyload" data-srcset="https://s2.loli.net/2024/06/15/KnvqJ6gZFX5AcGE.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;近来学习了白龙大佬的白盒密码学系列，感觉受益匪浅，有种高山流水觅知音的感觉，也认识了跟自己志同道合的伙伴，今日上午也去考了第一次四级考试（希望没有第二次哈哈哈哈哈哈）&lt;br&gt;在闲暇之余也观看了跟自己同为大一下的师傅们的文章&lt;br&gt;一句话总结：“一山更比一山高”&lt;br&gt;但是这</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>第七届强网杯-dotdot复现及思考</title>
    <link href="https://5m10v3.top/2024/06/13/%E7%AC%AC%E4%B8%83%E5%B1%8A%E5%BC%BA%E7%BD%91%E6%9D%AF-dotdot%E5%A4%8D%E7%8E%B0%E5%8F%8A%E6%80%9D%E8%80%83/"/>
    <id>https://5m10v3.top/2024/06/13/%E7%AC%AC%E4%B8%83%E5%B1%8A%E5%BC%BA%E7%BD%91%E6%9D%AF-dotdot%E5%A4%8D%E7%8E%B0%E5%8F%8A%E6%80%9D%E8%80%83/</id>
    <published>2024-06-12T16:00:00.000Z</published>
    <updated>2024-06-14T11:08:28.072Z</updated>
    
    <content type="html"><![CDATA[<p>以下为题目链接，供各位师傅下载练习<br><a href="https://wwb.lanzout.com/iovY721r8pva">https://wwb.lanzout.com/iovY721r8pva</a></p><p>涉及考点: 白盒AES,.net程序的序列化模块，反序列化文件修复</p><p>工具使用：</p><p><a href="https://github.com/dnSpy/dnSpy/releases/tag/v6.1.8">dnspy</a></p><p><a href="https://github.com/icsharpcode/ILSpy/releases">ILSpy</a></p><p>我们将dotdot.exe拖到dnspy里面分析一下</p><p><img src="https://s2.loli.net/2024/06/14/tUzKegJhYIRHZsL.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/tUzKegJhYIRHZsL.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们对函数逐个分析</p><p>BBB函数是对字符串的检验，长度为16</p><p><img src="https://s2.loli.net/2024/06/14/2pm7MQVCTfx89hH.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/2pm7MQVCTfx89hH.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这个函数是基于查表法实现的AES，很明显他没有让你输入密钥的过程</p><p>那我们该如何对它进行分析呢，这个时候我们就要使用DFA 差分故障攻击的方法</p><p>什么是差分故障攻击呢，简单来说就是插入故障数据，然后导致最后生成密文改变，从而推导出最后一轮密钥</p><p>由于dnspy是可以直接在上面修改源码的，所以我们直接在上面修改源码，然后重新编译。</p><p><img src="https://s2.loli.net/2024/06/14/TUo8RFedYpXzMvy.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/TUo8RFedYpXzMvy.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>右键选择编辑方法，修改之后选择编辑，这个时候我们还不能调</p><p><img src="https://s2.loli.net/2024/06/14/kYwAGMIhj7lsf3F.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/kYwAGMIhj7lsf3F.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>需要保存模块，点击全部保存，它会将这些的修改全都保存在新的exe里面，默认是覆盖原文件，这里我选择默认</p><p><img src="https://s2.loli.net/2024/06/14/DfxmoPQK1rZgEi9.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/DfxmoPQK1rZgEi9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们首先先来测试一下，没有插入故障数据的时候，第十轮的密文是什么样的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试数据</span></span><br><span class="line">daolwoayxawdwadg</span><br><span class="line"><span class="comment">#正常密文</span></span><br><span class="line">A9F4EC008E731B715FFAE5EA2C4F3EEC</span><br></pre></td></tr></table></figure><p>我们在进行最后一轮之前插入一个字节的故障数据，然后看密文是什么样子</p><p><img src="https://s2.loli.net/2024/06/14/MgZyKl3o7Fb89xz.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/MgZyKl3o7Fb89xz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们发现有四个字节不一样，说明我们插入的地方是正确的，我们多记录几个数据aaa[index]&#x3D;x,index和x的值是要发生变化的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#故障密文</span></span><br><span class="line">A908B4918EE75DD85F4C82002C2AE133</span><br><span class="line">3BF4EC008E731B875FFA3EEA2C7A3EEC</span><br><span class="line">A9F4EC5C8E730F715FC0E5EA124F3EEC</span><br><span class="line">A9F4A2008E281B71C5FAE5EA2C4F3E0B</span><br><span class="line">A9DDEC0033731B715FFAE5932C4F99EC</span><br><span class="line">A9C9EC00A2731B715FFAE5B72C4F10EC </span><br><span class="line">05F4EC008E731B165FFAD1EA2C1F3EEC</span><br><span class="line">A9F4EC948E7357715F88E5EA574F3EEC</span><br><span class="line">A9F401008EEB1B7166FAE5EA2C4F3E29</span><br><span class="line">A9F4B6008E601B7124FAE5EA2C4F3E77</span><br><span class="line">A904EC00EC731B715FFAE5392C4F08EC</span><br><span class="line">98F4EC008E731B535FFA43EA2C5A3EEC</span><br><span class="line">A9F4ECF98E73F5715F1FE5EA124F3EEC</span><br><span class="line">A9F403008ECE1B710FFAE5EA2C4F3E65</span><br><span class="line">A956EC0020731B715FFAE5252C4F39EC</span><br><span class="line">0CF4EC008E731BAB5FFADEEA2CAB3EEC</span><br></pre></td></tr></table></figure><p>然后这里有个非常好用的库，phoenixAES,可以帮我们恢复最后一轮的密钥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> phoenixAES</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tracefile&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">    t.write(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">A9F4EC008E731B715FFAE5EA2C4F3EEC</span></span><br><span class="line"><span class="string">A908B4918EE75DD85F4C82002C2AE133</span></span><br><span class="line"><span class="string">3BF4EC008E731B875FFA3EEA2C7A3EEC</span></span><br><span class="line"><span class="string">A9F4EC5C8E730F715FC0E5EA124F3EEC</span></span><br><span class="line"><span class="string">A9F4A2008E281B71C5FAE5EA2C4F3E0B</span></span><br><span class="line"><span class="string">A9DDEC0033731B715FFAE5932C4F99EC</span></span><br><span class="line"><span class="string">A9C9EC00A2731B715FFAE5B72C4F10EC </span></span><br><span class="line"><span class="string">05F4EC008E731B165FFAD1EA2C1F3EEC</span></span><br><span class="line"><span class="string">A9F4EC948E7357715F88E5EA574F3EEC</span></span><br><span class="line"><span class="string">A9F401008EEB1B7166FAE5EA2C4F3E29</span></span><br><span class="line"><span class="string">A9F4B6008E601B7124FAE5EA2C4F3E77</span></span><br><span class="line"><span class="string">A904EC00EC731B715FFAE5392C4F08EC</span></span><br><span class="line"><span class="string">98F4EC008E731B535FFA43EA2C5A3EEC</span></span><br><span class="line"><span class="string">A9F4ECF98E73F5715F1FE5EA124F3EEC</span></span><br><span class="line"><span class="string">A9F403008ECE1B710FFAE5EA2C4F3E65</span></span><br><span class="line"><span class="string">A956EC0020731B715FFAE5252C4F39EC</span></span><br><span class="line"><span class="string">0CF4EC008E731BAB5FFADEEA2CAB3EEC</span></span><br><span class="line"><span class="string">     &quot;&quot;&quot;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">phoenixAES.crack_file(<span class="string">&#x27;tracefile&#x27;</span>,verbose=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/06/14/KJkRQ8d17HrwLUb.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/KJkRQ8d17HrwLUb.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们再用GitHub上面的stark<a href="https://github.com/SideChannelMarvels/Stark/blob/master/aes_keyschedule.c">https://github.com/SideChannelMarvels/Stark/blob/master/aes_keyschedule.c</a></p><p>自己生成exe</p><p><img src="https://s2.loli.net/2024/06/14/j6CY4XP9sJzva3V.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/j6CY4XP9sJzva3V.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们可以得到最初始的密钥</p><p><img src="https://s2.loli.net/2024/06/14/qnidhFJLwcj6oMI.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/qnidhFJLwcj6oMI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>得到密钥是<strong>QWB2023HappyGame</strong></p><p>然后我们解密AES</p><p><img src="https://s2.loli.net/2024/06/14/Jxh9sDmOHPfonFK.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/Jxh9sDmOHPfonFK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们往下面分析，我们发现它经过字符串对比之后还有RC4加密，但是RC4同时也可以解密，然后我们可以先把License.dat给解密一下</p><p><img src="https://s2.loli.net/2024/06/14/kvzrtJQWZXDSaL2.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/kvzrtJQWZXDSaL2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line">key = <span class="string">b&quot;WelcomeToQWB2023&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;License.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">rc4 = ARC4.new(key)</span><br><span class="line">data = rc4.decrypt(data)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;new.dat&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br></pre></td></tr></table></figure><p>我们把新生成的new.dat拖到010eidtor里面看一下</p><p><img src="https://s2.loli.net/2024/06/14/MfnR3e81oZh4zNI.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/MfnR3e81oZh4zNI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们发现他调用了FFF方法</p><p>我们回到dnspy看FFF方法</p><p>发现是tea加密，然后加密的密钥就是我们的输入</p><p><img src="https://s2.loli.net/2024/06/14/u4ktHbcm8DLBJIw.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/u4ktHbcm8DLBJIw.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们还发现后面有比较的地方，密文在v28里面</p><p><img src="https://s2.loli.net/2024/06/14/wQtgvLhMTlkm97F.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/wQtgvLhMTlkm97F.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是由于程序经过了优化，所以我们在dnspy中无法看到v28的变量</p><p>我们需要去到ILspy里面查看v28，这里注意一定要用原程序进行查看</p><p>进行tea解密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* <span class="built_in">array</span>)</span> &#123;</span><br><span class="line"><span class="type">uint32_t</span> num5 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">num5 += <span class="number">3735928559u</span>;</span><br><span class="line">&#125;</span><br><span class="line">num5 = num5 &amp; <span class="number">0xffffffff</span>;</span><br><span class="line"><span class="type">uint32_t</span> num3 = v[<span class="number">0</span>], num4 = v[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">32</span>; ++j)</span><br><span class="line">&#123;</span><br><span class="line">num4 -= ((num3 &lt;&lt; <span class="number">4</span>) + <span class="built_in">array</span>[<span class="number">2</span>]) ^ (num3 + num5) ^ ((num3 &gt;&gt; <span class="number">5</span>) + <span class="built_in">array</span>[<span class="number">3</span>]);</span><br><span class="line">num3 -= ((num4 &lt;&lt; <span class="number">4</span>) + <span class="built_in">array</span>[<span class="number">0</span>]) ^ (num4 + num5) ^ ((num4 &gt;&gt; <span class="number">5</span>) + <span class="built_in">array</span>[<span class="number">1</span>]);</span><br><span class="line">num5 -= <span class="number">3735928559u</span>;</span><br><span class="line">&#125;</span><br><span class="line">v[<span class="number">0</span>] = num3; v[<span class="number">1</span>] = num4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> key[<span class="number">17</span>] = <span class="string">&quot;WelcomeToQWB2023&quot;</span>;</span><br><span class="line"><span class="type">uint8_t</span> enc[<span class="number">24</span>] = &#123; <span class="number">69</span>, <span class="number">182</span>, <span class="number">171</span>, <span class="number">33</span>, <span class="number">121</span>, <span class="number">107</span>, <span class="number">254</span>, <span class="number">150</span>, <span class="number">92</span>, <span class="number">29</span>,</span><br><span class="line"><span class="number">4</span>, <span class="number">178</span>, <span class="number">138</span>, <span class="number">166</span>, <span class="number">184</span>, <span class="number">106</span>, <span class="number">53</span>, <span class="number">241</span>, <span class="number">42</span>, <span class="number">191</span>,</span><br><span class="line"><span class="number">23</span>, <span class="number">211</span>, <span class="number">3</span>, <span class="number">107</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i += <span class="number">8</span>)</span><br><span class="line">&#123;</span><br><span class="line">decrypt((<span class="type">uint32_t</span>*)(enc + i), (<span class="type">uint32_t</span>*)key);</span><br><span class="line">&#125;</span><br><span class="line">enc[<span class="number">21</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, enc);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/06/14/zGudTZk7vnjlh8V.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/zGudTZk7vnjlh8V.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们还要去改一下程序</p><p><img src="https://s2.loli.net/2024/06/14/t81fme4IphqaMnw.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/t81fme4IphqaMnw.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们开始调试</p><p><img src="https://s2.loli.net/2024/06/14/1TMAYPiKUVOyQuF.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/1TMAYPiKUVOyQuF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>发现有异常，是我们的dat文件出现了问题</p><p>这里贴一下出题人的样例代码</p><p><a href="https://bbs.kanxue.com/thread-279971.htm">https://bbs.kanxue.com/thread-279971.htm</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">TypeConfuseDelegate</span><span class="params">(Comparison&lt;<span class="built_in">string</span>&gt; comp)</span></span><br><span class="line">&#123;</span><br><span class="line">    FieldInfo fi = typeof(MulticastDelegate).GetField(<span class="string">&quot;_invocationList&quot;</span>,</span><br><span class="line">            BindingFlags.NonPublic | BindingFlags.Instance);</span><br><span class="line">    object[] invoke_list = comp.GetInvocationList();</span><br><span class="line">    <span class="comment">// Modify the invocation list to add Process::Start(string, string)</span></span><br><span class="line">    invoke_list[<span class="number">1</span>] = new Func&lt;<span class="built_in">string</span>, <span class="built_in">string</span>, <span class="type">int</span>&gt;(FFF);</span><br><span class="line">    fi.SetValue(comp, invoke_list);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Main</span><span class="params">(<span class="built_in">string</span>[] args)</span>&#123;</span><br><span class="line">    <span class="comment">// Create a simple multicast delegate.</span></span><br><span class="line">    Delegate d = new Comparison&lt;<span class="built_in">string</span>&gt;(String.Compare);</span><br><span class="line">    Comparison&lt;<span class="built_in">string</span>&gt; c = (Comparison&lt;<span class="built_in">string</span>&gt;)MulticastDelegate.Combine(d, d);</span><br><span class="line">    <span class="comment">// Create set with original comparer.</span></span><br><span class="line">    IComparer&lt;<span class="built_in">string</span>&gt; comp = Comparer&lt;<span class="built_in">string</span>&gt;.Create(c);</span><br><span class="line"> </span><br><span class="line">    SortedSet&lt;<span class="built_in">string</span>&gt; mysl = new SortedSet&lt;<span class="built_in">string</span>&gt;(comp);</span><br><span class="line">    mysl.Add(<span class="string">&quot;dotN3t_Is_1nt3r3sting&quot;</span>);</span><br><span class="line">    mysl.Add(<span class="string">&quot;WelcomeToQWB2023&quot;</span>)&#125;</span><br><span class="line">     </span><br><span class="line">    TypeConfuseDelegate(c);</span><br><span class="line"> </span><br><span class="line">    BinaryFormatter fmt = new BinaryFormatter();</span><br><span class="line">    BinaryFormatter fmt2 = new BinaryFormatter();</span><br><span class="line">    MemoryStream stm = new MemoryStream();</span><br><span class="line">    fmt.Serialize(stm, mysl);</span><br><span class="line"> </span><br><span class="line">    using (FileStream fs = new FileStream(<span class="string">&quot;License.dat&quot;</span>, FileMode.Create, FileAccess.Write))</span><br><span class="line">    &#123;</span><br><span class="line">        stm.Position = <span class="number">0</span>;</span><br><span class="line">        stm.CopyTo(fs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/06/14/zlnxoLtWwf68ZTE.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/zlnxoLtWwf68ZTE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后可以找到异常的位置</p><p><img src="https://s2.loli.net/2024/06/14/e7Y3JoD1BfpzTGS.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/e7Y3JoD1BfpzTGS.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后06，06 ， 06，07是len</p><p><img src="https://s2.loli.net/2024/06/14/IghFqA3ROmwG6tN.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/IghFqA3ROmwG6tN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其实FFF函数这里也有提示，FFF的两个参数是string类型的，然后我们就是把刚才的两个的string，填进去</p><p><img src="https://s2.loli.net/2024/06/14/Mw4AoQ6RjIVlLBk.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/Mw4AoQ6RjIVlLBk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们直接运行就行了</p><p><img src="https://s2.loli.net/2024/06/14/EtqmjZzBI1FUNoV.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/EtqmjZzBI1FUNoV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://bbs.kanxue.com/thread-279971.htm">https://bbs.kanxue.com/thread-279971.htm</a></p><p><a href="http://91fans.com.cn/post/ilikeaestwo/">http://91fans.com.cn/post/ilikeaestwo/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;以下为题目链接，供各位师傅下载练习&lt;br&gt;&lt;a href=&quot;https://wwb.lanzout.com/iovY721r8pva&quot;&gt;https://wwb.lanzout.com/iovY721r8pva&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;涉及考点: 白盒AES,.net程序的序列</summary>
      
    
    
    
    <category term="wp" scheme="https://5m10v3.top/categories/wp/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>白盒AES算法学习</title>
    <link href="https://5m10v3.top/2024/06/11/%E7%99%BD%E7%9B%92AES%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
    <id>https://5m10v3.top/2024/06/11/%E7%99%BD%E7%9B%92AES%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2024-06-10T16:00:00.000Z</published>
    <updated>2024-06-19T07:52:45.867Z</updated>
    
    <content type="html"><![CDATA[<p>首先在这里非常感谢白龙大佬的白盒密码系列，让我对于白盒AES有了更深刻的认识，在这里给白龙大佬宣传一波</p><p><img src="https://s2.loli.net/2024/06/14/CYim2DVxKAz5r8S.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/14/CYim2DVxKAz5r8S.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><a href="https://public.zsxq.com/groups/28855842512881.html">https://public.zsxq.com/groups/28855842512881.html</a></p><p>这里我先贴一张AES加密的流程图</p><p><img src="https://s2.loli.net/2024/06/19/r1GT5PypmdO7zZA.png" class="lazyload" data-srcset="https://s2.loli.net/2024/06/19/r1GT5PypmdO7zZA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;首先在这里非常感谢白龙大佬的白盒密码系列，让我对于白盒AES有了更深刻的认识，在这里给白龙大佬宣传一波&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/06/14/CYim2DVxKAz5r8S.png&quot; class=&quot;lazyload&quot;</summary>
      
    
    
    
    <category term="CTF" scheme="https://5m10v3.top/categories/CTF/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>RCTF-Noval_cpython复现及思考</title>
    <link href="https://5m10v3.top/2024/06/08/RCTF-Noval_cython%E5%A4%8D%E7%8E%B0%E5%8F%8A%E6%80%9D%E8%80%83/"/>
    <id>https://5m10v3.top/2024/06/08/RCTF-Noval_cython%E5%A4%8D%E7%8E%B0%E5%8F%8A%E6%80%9D%E8%80%83/</id>
    <published>2024-06-07T16:00:00.000Z</published>
    <updated>2024-06-10T01:57:04.204Z</updated>
    
    <content type="html"><![CDATA[<p>以下为附件链接，供各位师傅下载练习<br><a href="https://wwb.lanzout.com/i7mkm21aeegd">https://wwb.lanzout.com/i7mkm21aeegd</a></p><p>趁热打铁，前一阵子打国赛遇到了cpython的题，但是国赛那道cpython和这个相比简直就是”关公面前耍大刀“。</p><p>在此也非常感谢<strong>z221x</strong>师傅的博客</p><p><a href="http://z221x.cc/index.php/2024/05/29/rctf%e9%80%86%e5%90%91%e5%a4%8d%e7%8e%b0/">http://z221x.cc/index.php/2024/05/29/rctf%e9%80%86%e5%90%91%e5%a4%8d%e7%8e%b0/</a></p><p>为我提供了一些很好的思路</p><h2 id="Noval-cpython"><a href="#Noval-cpython" class="headerlink" title="Noval_cpython"></a>Noval_cpython</h2><p>我们可以先用help函数看一下有没有什么比较有用的信息</p><p>这里注意一下，它是用python3.10直接编译的，我调了很多遍，发现如果跟版本不一样的话会导致导入不了这个模块</p><p>接下来我们用help查看一下，可以得到很多有用的信息</p><p><img src="/../image/734.png" class="lazyload" data-srcset="/../image/734.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="734"></p><p>我们注意到了check和encrypt函数，在main.py中它使用的就是check()函数</p><p><img src="/../image/735.png" class="lazyload" data-srcset="/../image/735.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="735"></p><p>然后我们可以注意到DATA那里有很多可疑的数据，我们先继续进行分析</p><p>首先第一步还是找到模块处理的地方</p><p><img src="/../image/736.png" class="lazyload" data-srcset="/../image/736.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="736"></p><p>我们要从check_secret模块开始看</p><p><img src="/../image/737.png" class="lazyload" data-srcset="/../image/737.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="737"></p><p>我们发现里面有很多对象，这让我想到之前学习驱动的时候，“驱动之内一切皆对象”，其实cpython在创建模块也需要很多对象</p><p><img src="/../image/738.png" class="lazyload" data-srcset="/../image/738.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="738"></p><p><img src="/../image/739.png" class="lazyload" data-srcset="/../image/739.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="739"></p><p>我们发现这里创建了很多对象，这里的操作相当于</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>]</span><br></pre></td></tr></table></figure><p>这里是密文的初始化</p><p><img src="/../image/740.png" class="lazyload" data-srcset="/../image/740.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="740"></p><p>但是我们发现这个跟上面的help的情况不太一样，没有关系我们继续往下面看</p><p>这里重新打包了很多东西</p><p><img src="/../image/741.png" class="lazyload" data-srcset="/../image/741.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="741"></p><p>但是我们在伪代码层面看不出来它的逻辑</p><p>汇编层面:</p><p><img src="/../image/742.png" class="lazyload" data-srcset="/../image/742.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="742"></p><p>我们发现它是定义algorithm1，algorithm2，algorithm3…….这些函数</p><p><img src="/../image/743.png" class="lazyload" data-srcset="/../image/743.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="743"></p><p>然后最后的时候还有个加密函数，这个加密函数有七个参数，我们发现有一个delta的参数，在这里先猜测它可能是tea加密</p><p>继续往下面分析</p><p>这里为定义一个xixi变量</p><p><img src="/../image/744.png" class="lazyload" data-srcset="/../image/744.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="744"></p><p>这里我们发现定义了一个sbox变量</p><p><img src="/../image/745.png" class="lazyload" data-srcset="/../image/745.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="745"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#就是这样的作用</span></span><br><span class="line">s_box=[<span class="number">12</span>,<span class="number">17</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">27</span>,<span class="number">31</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">24</span>,<span class="number">1</span>,<span class="number">26</span>,<span class="number">22</span>,<span class="number">9</span>,<span class="number">16</span>,<span class="number">18</span>,<span class="number">25</span>,<span class="number">29</span>,<span class="number">19</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">30</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">2</span>,<span class="number">28</span>,<span class="number">20</span>]</span><br></pre></td></tr></table></figure><p>这里定义haha这个变量</p><p><img src="/../image/746.png" class="lazyload" data-srcset="/../image/746.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="746"></p><p>再往下面就是定义了打包的函数模块</p><p>这里就是真正定义密文的地方</p><p><img src="/../image/747.png" class="lazyload" data-srcset="/../image/747.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="747"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enc=[<span class="number">1386864498</span>,<span class="number">2877138732</span>,<span class="number">1628978326</span>,<span class="number">881564191</span>,<span class="number">1437614165</span>,<span class="number">4227562200</span>,<span class="number">1606883458</span>,<span class="number">3679355295</span>]</span><br></pre></td></tr></table></figure><p><img src="/../image/748.png" class="lazyload" data-srcset="/../image/748.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="748"></p><p><img src="/../image/749.png" class="lazyload" data-srcset="/../image/749.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="749"></p><p><img src="/../image/750.png" class="lazyload" data-srcset="/../image/750.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="750"></p><p><img src="/../image/751.png" class="lazyload" data-srcset="/../image/751.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="751"></p><p><img src="/../image/752.png" class="lazyload" data-srcset="/../image/752.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="752"></p><p><img src="/../image/753.png" class="lazyload" data-srcset="/../image/753.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="753"></p><p><img src="/../image/754.png" class="lazyload" data-srcset="/../image/754.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="754"></p><p><img src="/../image/755.png" class="lazyload" data-srcset="/../image/755.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="755"></p><p>总结一下上面八个函数以及前面打包函数的时候的两个参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">algorithm1   --------&gt;  add</span></span><br><span class="line"><span class="string">algorithm2   --------&gt;  sub   </span></span><br><span class="line"><span class="string">algorithm3   --------&gt;  mul</span></span><br><span class="line"><span class="string">algorithm4   --------&gt;  div</span></span><br><span class="line"><span class="string">algorithm5   --------&gt;  mod</span></span><br><span class="line"><span class="string">algorithm6   --------&gt;  rsl</span></span><br><span class="line"><span class="string">algorithm7   --------&gt;  rsr</span></span><br><span class="line"><span class="string">algorithm8   --------&gt;  xor</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm1</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm2</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a-b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm3</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a*b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm4</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a/b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm5</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a%b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm6</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a&lt;&lt;b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">algorithm7</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">return</span> a^b</span><br></pre></td></tr></table></figure><p>这里定义一个map函数</p><p><img src="/../image/766.png" class="lazyload" data-srcset="/../image/766.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="766"></p><p>后面就是定义encrypt函数，struct函数和check函数</p><p><img src="/../image/767.png" class="lazyload" data-srcset="/../image/767.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="767"></p><p>至此我们对于check_secret这个模块分析完了，这个模块全都是初始化的一些东西，然而我们在main.py调用的是check函数，接下来我们分析check函数</p><p>我们从上往下进行分析</p><p>发现这里调用了range函数</p><p><img src="/../image/769.png" class="lazyload" data-srcset="/../image/769.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="769"></p><p>然后这里调用了s_box</p><p><img src="/../image/770.png" class="lazyload" data-srcset="/../image/770.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="770"></p><p>梳理一下逻辑</p><p>实现了一个替换的功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">s_box,your_input</span>):</span><br><span class="line">    change_input=[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(your_input)):</span><br><span class="line">        chage_input[i]=your_input[s_box[i]]</span><br></pre></td></tr></table></figure><p>下面实现了一个struct函数</p><p><img src="/../image/771.png" class="lazyload" data-srcset="/../image/771.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="771"></p><p><img src="/../image/772.png" class="lazyload" data-srcset="/../image/772.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="772"></p><p><img src="/../image/773.png" class="lazyload" data-srcset="/../image/773.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="773"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#实现以下这个操作</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(change_input)\\<span class="number">4</span>)</span><br><span class="line">     enc[i]=struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>,change[<span class="number">4</span>*i:<span class="number">4</span>*i+<span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#这个操作是为了生成32位的结果</span></span><br></pre></td></tr></table></figure><p>然后下面开始加密</p><p><img src="/../image/774.png" class="lazyload" data-srcset="/../image/774.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="774"></p><p>发现它还调用了下面的xixi，再往下分析</p><p>这里有个+2操作</p><p><img src="/../image/775.png" class="lazyload" data-srcset="/../image/775.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="775"></p><p>后面又调用了一次加密函数，但是调用的是haha</p><p><img src="/../image/776.png" class="lazyload" data-srcset="/../image/776.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="776"></p><p>然后后面还有一个+2操作，但是到这里我们还无法确认它真正的加密逻辑是什么，然后我们去看encrypt函数</p><p>真正的加密在_pyx_pf_12check_secret_16encrypt里面</p><p>现在开始才是真正的逆向🈚，一共有5000多行，逆呗谁能逆过你啊</p><p>我们可以看到光定义变量都有500多行了</p><p><img src="/../image/777.png" class="lazyload" data-srcset="/../image/777.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="777"></p><p>我们发现这个加密函数有两个参数</p><p><img src="/../image/778.png" class="lazyload" data-srcset="/../image/778.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="778"></p><p>其实我们还可以大胆写一下那个加密的逻辑</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(enc),<span class="number">2</span>):</span><br><span class="line">    encrypt(enc[i:i+<span class="number">2</span>],xixi)</span><br><span class="line">    encrypt(enc[i:i+<span class="number">2</span>],haha)</span><br></pre></td></tr></table></figure><p>看起来很像tea加密</p><p>这里定义了一个uint32的变量</p><p><img src="/../image/779.png" class="lazyload" data-srcset="/../image/779.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="779"></p><p>从上往下分析，我们发现还定义了另一个uint32的变量</p><p>然后我们有注意到了一个变量</p><p><img src="/../image/780.png" class="lazyload" data-srcset="/../image/780.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="780"></p><p>它只有两处引用，可以猜测一下它经过了32次循环‘</p><p><img src="/../image/781.png" class="lazyload" data-srcset="/../image/781.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="781"></p><p><img src="/../image/782.png" class="lazyload" data-srcset="/../image/782.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="782"></p><p><img src="/../image/783.png" class="lazyload" data-srcset="/../image/783.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="783"></p><p><img src="/../image/784.png" class="lazyload" data-srcset="/../image/784.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="784"></p><p>……………………..后面的图很多，但是我们发现它经历了好多次重复的操作，然后还调用了大量的map</p><p>梳理一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>(add，<span class="built_in">map</span>(xor，<span class="built_in">map</span>(xor，<span class="built_in">map</span>(add，<span class="built_in">map</span>(rsl <span class="number">4</span>，<span class="built_in">map</span>(add，<span class="built_in">map</span>(rsr <span class="number">5</span>，<span class="built_in">map</span>（add</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>(add <span class="number">0x12345678</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>(add，<span class="built_in">map</span>(xor，<span class="built_in">map</span>(xor，<span class="built_in">map</span>(add，<span class="built_in">map</span>(rsl <span class="number">4</span>，<span class="built_in">map</span>(add，<span class="built_in">map</span>(rsr <span class="number">5</span>，<span class="built_in">map</span>(add</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">map=&#123;</span></span><br><span class="line"><span class="string">&#x27;add&#x27;:&lt;built-in function algorithm1&gt;,</span></span><br><span class="line"><span class="string">&#x27;sub&#x27;:&lt;built-in function algorithm2&gt;,  </span></span><br><span class="line"><span class="string">&#x27;mul&#x27;:&lt;built-in function algorithm3&gt;,</span></span><br><span class="line"><span class="string">&#x27;div&#x27;:&lt;built-in function algorithm4&gt;,</span></span><br><span class="line"><span class="string">&#x27;mod&#x27;:&lt;built-in function algorithm5&gt;,</span></span><br><span class="line"><span class="string">&#x27;rsl&#x27;:&lt;built-in function algorithm6&gt;,</span></span><br><span class="line"><span class="string">&#x27;rsr&#x27;:&lt;built-in function algorithm7&gt;,</span></span><br><span class="line"><span class="string">&#x27;xor&#x27;:&lt;built-in function algorithm8&gt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>到这里我们可以确定这就是个tea加密</p><p>然后Arr3stY0u战队的师傅们提供了另一个思路</p><p><a href="https://mp.weixin.qq.com/s/IwKxtqDd-5v0xhg9UzKe-g">https://mp.weixin.qq.com/s/IwKxtqDd-5v0xhg9UzKe-g</a></p><p>因为这个动态链接库是已经打包好的，所以我们可以直接调用里面的函数然后，再打印出来他们的操作(相当于就是hook操作)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> check_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_add</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> + 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_sud</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> - 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_mul</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> * 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_div</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> / 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_mod</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> % 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_rsl</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> &lt;&lt; 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_rsr</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> &gt;&gt; 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_xor</span>(<span class="params">a,b</span>):</span><br><span class="line">    res=check_secret.algorithm1(a,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;0x<span class="subst">&#123;res:08x&#125;</span> = 0x<span class="subst">&#123;a:08x&#125;</span> ^ 0x<span class="subst">&#123;b:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;add&#x27;</span>] = hook_add</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;sub&#x27;</span>] = hook_sub</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;mul&#x27;</span>] = hook_mul</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;div&#x27;</span>] = hook_div</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;mod&#x27;</span>] = hook_mod</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;rsl&#x27;</span>] = hook_rsl</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;rsr&#x27;</span>] = hook_rsr</span><br><span class="line">check_secret.<span class="built_in">map</span>[<span class="string">&#x27;xor&#x27;</span>] = hook_xor</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(check_secret.encrypt([<span class="number">0x11111111</span>,<span class="number">0x2222222</span>]),check_secret.xixi)</span><br></pre></td></tr></table></figure><p>然后我们就可以得到加密的过程</p><p><img src="/../image/785.png" class="lazyload" data-srcset="/../image/785.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="785"></p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x12345678</span>, sum = delta * num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + key[<span class="number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + key[<span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + key[<span class="number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + key[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> xixi[] = &#123; <span class="number">3540658286</span>,<span class="number">3391361277</span>,<span class="number">1321275334</span>,<span class="number">3918321625</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> haha[] = &#123; <span class="number">1272471749</span>,<span class="number">2262110437</span>,<span class="number">697301573</span>,<span class="number">1088211398</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> enc[] = &#123; <span class="number">1386864498</span>,<span class="number">2877138732</span>,<span class="number">1628978326</span>,<span class="number">881564191</span>,<span class="number">1437614165</span>,<span class="number">4227562200</span>,<span class="number">1606883458</span>,<span class="number">3679355295</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">decipher(<span class="number">32</span>,enc + i, haha);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">decipher(<span class="number">32</span>,enc + i, xixi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> sbox[] = &#123; <span class="number">12</span>, <span class="number">17</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">27</span>, <span class="number">31</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">26</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">18</span>,</span><br><span class="line"><span class="number">25</span>, <span class="number">29</span>, <span class="number">19</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">23</span>, <span class="number">2</span>, <span class="number">28</span>, <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (sbox[j] == i)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, *((<span class="type">unsigned</span> <span class="type">char</span>*)enc + j));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;以下为附件链接，供各位师傅下载练习&lt;br&gt;&lt;a href=&quot;https://wwb.lanzout.com/i7mkm21aeegd&quot;&gt;https://wwb.lanzout.com/i7mkm21aeegd&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;趁热打铁，前一阵子打国赛遇到了cpytho</summary>
      
    
    
    
    <category term="CTF" scheme="https://5m10v3.top/categories/CTF/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>关于爆破迷宫路径的一系列思考</title>
    <link href="https://5m10v3.top/2024/06/07/%E5%85%B3%E4%BA%8E%E7%88%86%E7%A0%B4%E8%BF%B7%E5%AE%AB%E8%B7%AF%E5%BE%84%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E6%80%9D%E8%80%83/"/>
    <id>https://5m10v3.top/2024/06/07/%E5%85%B3%E4%BA%8E%E7%88%86%E7%A0%B4%E8%BF%B7%E5%AE%AB%E8%B7%AF%E5%BE%84%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E6%80%9D%E8%80%83/</id>
    <published>2024-06-06T16:00:00.000Z</published>
    <updated>2024-06-09T09:10:00.642Z</updated>
    
    <content type="html"><![CDATA[<p>题目链接在此，供各位师傅下载练习</p><p><a href="https://wwb.lanzout.com/iWuvC216lmqj">https://wwb.lanzout.com/iWuvC216lmqj</a></p><p>前几天学长给了一道maze的题，动态调试过程可谓非常艰难(对我现在的水平而言)，于是学长提供了一种用subprocess的方法</p><h2 id="程序分析"><a href="#程序分析" class="headerlink" title="程序分析"></a>程序分析</h2><p><img src="/../image/726.png" class="lazyload" data-srcset="/../image/726.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="726"></p><p>首先通过字符串定位到主函数那里，我们发现cmp那里其实是一个长度校验，判断路径的长度是不是为140</p><p><img src="/../image/727.png" class="lazyload" data-srcset="/../image/727.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="727"></p><p>这里为判断路径方向</p><p><img src="/../image/728.png" class="lazyload" data-srcset="/../image/728.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="728"></p><p>中间过程太复杂，我们直接跳到后面，我们发现他判断所处位置是不是为0，还有判断最后到达位置对不对的</p><p>经过这个分析我们并不知道迷宫在哪，因此我们才要尝试爆破的方法。</p><h2 id="爆破处理"><a href="#爆破处理" class="headerlink" title="爆破处理"></a>爆破处理</h2><p>首先第一步，我们要把长度校验给patch掉</p><p><img src="/../image/729.png" class="lazyload" data-srcset="/../image/729.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="729"></p><p>重点的patch在后面，我们为了一步一步进行爆破，我们要对每一步进行爆破</p><p>但是有一个问题，后面不管走不走对都会输出</p><p>我们可以先写一个简单的试验一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">printable=[<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(printable)):</span><br><span class="line">    sh=subprocess.Popen(<span class="string">&quot;./mapmap&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stdin=subprocess.PIPE)</span><br><span class="line">    sh.stdin.write((printable[i]+<span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">    sh.stdin.flush()</span><br><span class="line">    output ,_ =sh.communicate()</span><br><span class="line">    <span class="built_in">print</span>(output)</span><br></pre></td></tr></table></figure><p><img src="/../image/730.png" class="lazyload" data-srcset="/../image/730.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="730"></p><p>我们发现根本无法判断是不是走对了，这个时候我们再patch一下</p><p><img src="/../image/728.png" class="lazyload" data-srcset="/../image/728.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="728"></p><p><img src="/../image/731.png" class="lazyload" data-srcset="/../image/731.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="731"></p><p>把下面那个指向wrong的地址改为指向’   what()’的地址</p><p>我们这个时候可以再看一下</p><p><img src="/../image/732.png" class="lazyload" data-srcset="/../image/732.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="732"></p><p>发现有不一样的回显了，我们根据这个可以写一个脚本，但是这里有一个问题，它在程序里面每走一步不会把走过的给标记，所以我们得自己标记一下，由于没有写这个标记，导致脚本跑了好久也没跑出来。</p><h2 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">path, n, x_location, y_location, count, try_direction, visited_paths, coordinates</span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt; count:</span><br><span class="line">        <span class="keyword">for</span> direction <span class="keyword">in</span> try_direction:</span><br><span class="line">            process = subprocess.Popen(<span class="string">&quot;./mapmap&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stdin=subprocess.PIPE)</span><br><span class="line">            next_path = path + direction</span><br><span class="line">            process.stdin.write((next_path + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">            process.stdin.flush()</span><br><span class="line">            output, _ = process.communicate()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;wrong\n&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> output:</span><br><span class="line">                new_x_location, new_y_location = x_location, y_location</span><br><span class="line">                <span class="keyword">if</span> direction == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                    new_x_location += <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> direction == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">                    new_x_location -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> direction == <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">                    new_y_location -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> direction == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                    new_y_location += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> (new_x_location, new_y_location) <span class="keyword">not</span> <span class="keyword">in</span> coordinates:</span><br><span class="line">                    <span class="built_in">print</span>(path)</span><br><span class="line">                    coordinates[(new_x_location, new_y_location)] = next_path</span><br><span class="line">                    dfs(next_path, <span class="built_in">len</span>(next_path), new_x_location, new_y_location, count, try_direction, visited_paths, coordinates)</span><br><span class="line">    <span class="keyword">elif</span> n == count:</span><br><span class="line">            visited_paths.append(path)</span><br><span class="line">            coordinates[(x_location, y_location)] = path</span><br><span class="line"></span><br><span class="line"><span class="comment"># DFS start</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    start_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    try_direction = [<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">    count = <span class="number">140</span> </span><br><span class="line">    visited_paths = []</span><br><span class="line">    coordinates = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    x_location = <span class="number">0</span></span><br><span class="line">    y_location = <span class="number">0</span></span><br><span class="line">    coordinates[(x_location, y_location)] = start_path</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nVisit paths:&quot;</span>)</span><br><span class="line">    dfs(start_path, <span class="built_in">len</span>(start_path), x_location, y_location, count, try_direction, visited_paths, coordinates)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nFinal paths:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> visited_paths:</span><br><span class="line">        process = subprocess.Popen(<span class="string">&quot;./mapmap&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stdin=subprocess.PIPE)</span><br><span class="line">        process.stdin.write((path + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">        process.stdin.flush()</span><br><span class="line">        output, _ = process.communicate()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;md5(your input)&#125;\n&#x27;</span> <span class="keyword">in</span> output:</span><br><span class="line">            <span class="built_in">print</span>(path)</span><br></pre></td></tr></table></figure><p><img src="/../image/733.png" class="lazyload" data-srcset="/../image/733.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="733"></p><p>差不多二十秒的时间跑出来</p><p>我自己的虚拟环境是kali 2023.3 内存 4G 处理器2x2</p><p>如果师傅们有更好的思路欢迎来交流😁😁😁😁</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://docs.python.org/zh-cn/3/library/subprocess.html#using-the-subprocess-module">https://docs.python.org/zh-cn/3/library/subprocess.html#using-the-subprocess-module</a></p><p><a href="https://www.cnblogs.com/lordtianqiyi/articles/16588649.html">https://www.cnblogs.com/lordtianqiyi/articles/16588649.html</a></p><p><a href="https://bbs.kanxue.com/thread-281796.html">https://bbs.kanxue.com/thread-281796.html</a></p><p><a href="http://z221x.cc/index.php/2024/01/06/nctf-ezvm%e6%8f%92%e6%a1%a9%e7%88%86%e7%a0%b4%e7%9a%84%e5%a4%8d%e7%8e%b0/">http://z221x.cc/index.php/2024/01/06/nctf-ezvm%e6%8f%92%e6%a1%a9%e7%88%86%e7%a0%b4%e7%9a%84%e5%a4%8d%e7%8e%b0/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;题目链接在此，供各位师傅下载练习&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wwb.lanzout.com/iWuvC216lmqj&quot;&gt;https://wwb.lanzout.com/iWuvC216lmqj&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;前几天学长给了一道maze的题，动态</summary>
      
    
    
    
    <category term="CTF" scheme="https://5m10v3.top/categories/CTF/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>日记(25)</title>
    <link href="https://5m10v3.top/2024/06/04/%E6%97%A5%E8%AE%B0(25)/"/>
    <id>https://5m10v3.top/2024/06/04/%E6%97%A5%E8%AE%B0(25)/</id>
    <published>2024-06-03T16:00:00.000Z</published>
    <updated>2024-07-07T06:26:02.972Z</updated>
    
    <content type="html"><![CDATA[<p>最近在研究一些能够插桩爆破的方法，目前还在总结，可能要过几天才能彻底总结出来。<br>正在努力赶制</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近在研究一些能够插桩爆破的方法，目前还在总结，可能要过几天才能彻底总结出来。&lt;br&gt;正在努力赶制&lt;/p&gt;
</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>日记(24)</title>
    <link href="https://5m10v3.top/2024/06/01/%E6%97%A5%E8%AE%B0(24)/"/>
    <id>https://5m10v3.top/2024/06/01/%E6%97%A5%E8%AE%B0(24)/</id>
    <published>2024-05-31T16:00:00.000Z</published>
    <updated>2024-07-07T06:25:57.613Z</updated>
    
    <content type="html"><![CDATA[<p>上一次写日记已经是半个多月前了，这半个多月太忙了，还出去了一周的时间。<br>回来这几天勉强把状态调整了回来，今天打了一个比赛，做了一个迷宫题，但不是传统的那种迷宫题，这个比赛的时间也短，最后就差一分钟！一分钟！，就能把这个flag给交上去了😔😔😔</p><p>总的来说自己对这类题的掌握程度还是不足，今天学长又给了一道迷宫的题，比较难调，是一个类似树状的</p><p>近期规划:</p><ul><li>多复现一些大比赛的题目</li><li>同时基本功也不能落下</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;上一次写日记已经是半个多月前了，这半个多月太忙了，还出去了一周的时间。&lt;br&gt;回来这几天勉强把状态调整了回来，今天打了一个比赛，做了一个迷宫题，但不是传统的那种迷宫题，这个比赛的时间也短，最后就差一分钟！一分钟！，就能把这个flag给交上去了😔😔😔&lt;/p&gt;
&lt;p&gt;总的</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>逆向练习(二)</title>
    <link href="https://5m10v3.top/2024/06/01/%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0(%E4%BA%8C)/"/>
    <id>https://5m10v3.top/2024/06/01/%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0(%E4%BA%8C)/</id>
    <published>2024-05-31T16:00:00.000Z</published>
    <updated>2024-06-09T09:10:49.082Z</updated>
    
    <content type="html"><![CDATA[<p>今日练习一题之maze</p><p>题目链接如下，供各位师傅下载</p><p><a href="https://wwb.lanzout.com/iH49D20nej0j">https://wwb.lanzout.com/iH49D20nej0j</a></p><p>直接字符串定位到main函数</p><p>反编译之后我们发现看不懂，那些走迷宫的操作我们也看不到</p><p>我们直接看它的CFG</p><p><img src="/../image/721.png" class="lazyload" data-srcset="/../image/721.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="721"></p><p>第一个call指令的这个函数为输入函数，但是每次只能输入一个字符</p><p>然后对你输入的字符处理的地方是这里</p><p><img src="/../image/722.png" class="lazyload" data-srcset="/../image/722.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="722"></p><p>第一步我们应该先找到迷宫在哪里，经过调试</p><p><img src="/../image/723.png" class="lazyload" data-srcset="/../image/723.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="723"></p><p>r13这里是我们的迷宫，由于它每次只取rsi*4地址处的，所以我们把这个给整理出来</p><p><img src="/../image/724.png" class="lazyload" data-srcset="/../image/724.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="724"></p><p>得到迷宫图之后我们就要得到它的方向指令了，由于第一个我们测出来的是<strong>2</strong>，这个<strong>2</strong>也不是没有根据的，我们回到CFG那里</p><p><img src="/../image/722.png" class="lazyload" data-srcset="/../image/722.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="722"></p><p>首先我们可以看到它将你输入的字符与0x32进行异或,然后和9进行比较，这个不重要,重要的是后面有三个cmp，这三个cmp对应不同的指令，要注意到后面还有个指令  <strong>add    rsi,rcx</strong>，而这个rsi又指向我们路径坐标对应的地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test eax,eax ;如果相等对应后面 rsi+=6  相当于就是往上走，然后这个可以得出来输入的结果:0x0^0x32=0x32--&gt;&#x27;2&#x27;</span><br><span class="line">cmp  eax, 6  ;如果相等对应后面 rsi-=1  相当于就是往左走，然后这个可以得出来输入的结果:0x6^0x32=0x34--&gt;&#x27;4&#x27;</span><br><span class="line">cmp  eax, 0Ah;如果相等对应后面 rsi-=6  相当于就是往上走，然后这个可以得出来输入的结果:0xA^0x32=0x38--&gt;&#x27;8&#x27; </span><br><span class="line">cmp  eax, 5Eh;如果相等对应后面 rsi+=1  相当于就是往左走，然后这个可以得出来输入的结果:0x5E^0x32=0x6c--&gt;&#x27;l&#x27;</span><br></pre></td></tr></table></figure><p>然后我们就可以得出路径</p><p><img src="/../image/725.png" class="lazyload" data-srcset="/../image/725.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="725"></p><p>得到我们的flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今日练习一题之maze&lt;/p&gt;
&lt;p&gt;题目链接如下，供各位师傅下载&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wwb.lanzout.com/iH49D20nej0j&quot;&gt;https://wwb.lanzout.com/iH49D20nej0j&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;直</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="ctf学习" scheme="https://5m10v3.top/tags/ctf%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>2024CISCN(初赛)解题思路及复现</title>
    <link href="https://5m10v3.top/2024/05/31/2024CISCN(%E5%88%9D%E8%B5%9B)%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%A4%8D%E7%8E%B0/"/>
    <id>https://5m10v3.top/2024/05/31/2024CISCN(%E5%88%9D%E8%B5%9B)%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%A4%8D%E7%8E%B0/</id>
    <published>2024-05-30T16:00:00.000Z</published>
    <updated>2024-06-09T14:07:06.451Z</updated>
    
    <content type="html"><![CDATA[<h2 id="asm-re"><a href="#asm-re" class="headerlink" title="asm_re"></a>asm_re</h2><p>直接手撕汇编</p><p><img src="/../image/688.png" class="lazyload" data-srcset="/../image/688.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="688"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#正向加密过程</span></span><br><span class="line">enc=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i]*=<span class="number">0x50</span></span><br><span class="line">    enc[i]+=<span class="number">0x14</span></span><br><span class="line">    enc[i]^=<span class="number">0x4D</span></span><br><span class="line">    enc[i]+=<span class="number">0x1E</span></span><br></pre></td></tr></table></figure><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">enc=[<span class="number">0x1FD7</span>,<span class="number">0x21B7</span>,<span class="number">0x1E47</span>,<span class="number">0x2027</span>,<span class="number">0x26E7</span>,<span class="number">0x10D7</span>,<span class="number">0x1127</span>,<span class="number">0x2007</span>,<span class="number">0x11C7</span>,<span class="number">0x1E47</span>,<span class="number">0x1017</span>,<span class="number">0x1017</span>,<span class="number">0x11F7</span>,<span class="number">0x2007</span>,<span class="number">0x1037</span>,<span class="number">0x1107</span>,<span class="number">0x1F17</span>,<span class="number">0x10D7</span>,<span class="number">0x1017</span>,<span class="number">0x1017</span>,<span class="number">0x1F67</span>,<span class="number">0x1017</span>,<span class="number">0x11C7</span>,<span class="number">0x11C7</span>,<span class="number">0x1017</span>,<span class="number">0x1FD7</span>,<span class="number">0x1F17</span>,<span class="number">0x1107</span>,<span class="number">0x0F47</span>,<span class="number">0x1127</span>,<span class="number">0x1037</span>,<span class="number">0x1E47</span>,<span class="number">0x1037</span>,<span class="number">0x1FD7</span>,<span class="number">0x1107</span>,<span class="number">0x1FD7</span>,<span class="number">0x1107</span>,<span class="number">0x2787</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i]-=<span class="number">0x1E</span></span><br><span class="line">    enc[i]^=<span class="number">0x4D</span></span><br><span class="line">    enc[i]-=<span class="number">0x14</span></span><br><span class="line">    enc[i]//=<span class="number">0x50</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(enc[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="androidso-re"><a href="#androidso-re" class="headerlink" title="androidso_re"></a>androidso_re</h2><p><img src="/../image/689.png" class="lazyload" data-srcset="/../image/689.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="689"></p><p>flag的加密在inspect这个类里面</p><p>经过了DES(CBC模式)加密+base64加密</p><p>那么我们需要得到DES加密的IV和key</p><p>在libSecret_entrance.so里面</p><p><img src="/../image/690.png" class="lazyload" data-srcset="/../image/690.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="690"></p><p>分别在getiv和getkey里面把a1的类型变一下改成<strong>JNIEnv</strong>*</p><p><img src="/../image/691.png" class="lazyload" data-srcset="/../image/691.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="691"></p><p><img src="/../image/692.png" class="lazyload" data-srcset="/../image/692.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="692"></p><p>然后我们直接利用jnitrace</p><p><img src="/../image/693.png" class="lazyload" data-srcset="/../image/693.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="693"></p><p><img src="/../image/694.png" class="lazyload" data-srcset="/../image/694.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="694"></p><p><img src="/../image/695.png" class="lazyload" data-srcset="/../image/695.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="695"></p><h2 id="whereThel1b"><a href="#whereThel1b" class="headerlink" title="whereThel1b"></a>whereThel1b</h2><p>出题人自己编写的动态链接库</p><p><img src="/../image/696.png" class="lazyload" data-srcset="/../image/696.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="696"></p><p>真正对明文进行处理的函数时whereThelib这个库里面的trytry函数</p><p>我们可以先搜索init，发现有一个PyInit_whereThel1b这个函数</p><p><img src="/../image/697.png" class="lazyload" data-srcset="/../image/697.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="697"></p><p>然后我们就可以找到初始化这些模块的地方__pyx_moduledef</p><p><img src="/../image/698.png" class="lazyload" data-srcset="/../image/698.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="698"></p><p>这里定义了一个随机数种子</p><p>然后后面又调用了whereistheflag1</p><p><img src="/../image/699.png" class="lazyload" data-srcset="/../image/699.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="699"></p><p>说明对字符的处理在whereistheflag1里面</p><p>在whereistheflag1里面先调用了一个base64，说明先进行了base64加密</p><p><img src="/../image/700.png" class="lazyload" data-srcset="/../image/700.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="700"></p><p>还是生成一个随机数，生成的范围时是**(0,len(arr))**</p><p><img src="/../image/701.png" class="lazyload" data-srcset="/../image/701.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="701"></p><p><img src="/../image/703.png" class="lazyload" data-srcset="/../image/703.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="703"></p><p>这里还调用了一下xor</p><p><img src="/../image/702.png" class="lazyload" data-srcset="/../image/702.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="702"></p><p>这里整理一下加密的逻辑</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">whereistheflag1</span>(<span class="params">pla</span>):</span><br><span class="line">    <span class="comment"># 创建一个空列表</span></span><br><span class="line">    result_list = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 导入模块 &#x27;base64&#x27; 或获取其全局变量</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> base64</span><br><span class="line">        b64encode_func = base64.b64encode</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;Cannot find the module &#x27;base64&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 导入模块 &#x27;random&#x27; 或获取其全局变量</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        randint_func = random.randint</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;Cannot find the module &#x27;random&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对输入的参数进行编码处理</span></span><br><span class="line">    encoded_pla = b64encode_func(pla)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取编码后字符串的长度</span></span><br><span class="line">    length = <span class="built_in">len</span>(encoded_pla)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 随机生成一些数字并与编码后的字符串进行异或操作</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        random_int = randint_func(<span class="number">0</span>, <span class="built_in">len</span>(arr))</span><br><span class="line">        result_list.append(random_int ^ encoded_pla[_])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result_list</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">enc</span>):</span><br><span class="line">     random.seed()<span class="comment">#随机数种子的参数不知道</span></span><br><span class="line">     whereiftheflag1(enc)   </span><br><span class="line"><span class="keyword">if</span> __name__  == <span class="string">&quot;__main__&quot;</span> </span><br><span class="line">    enc=<span class="built_in">list</span>(<span class="built_in">input</span>())</span><br><span class="line">    enc=byte(enc)</span><br><span class="line">    encode()</span><br></pre></td></tr></table></figure><p>由于随机数种子的参数我们不知道</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">125</span>):</span><br><span class="line"> random.seed(j)</span><br><span class="line"> encry = [<span class="number">108</span>, <span class="number">117</span>, <span class="number">72</span>, <span class="number">80</span>, <span class="number">64</span>, <span class="number">49</span>, <span class="number">99</span>, <span class="number">19</span>, <span class="number">69</span>, <span class="number">115</span>, <span class="number">94</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">115</span>, <span class="number">71</span>, <span class="number">95</span>, <span class="number">84</span>, <span class="number">89</span>, <span class="number">56</span>, <span class="number">101</span>, <span class="number">70</span>, <span class="number">2</span>, <span class="number">84</span>, <span class="number">75</span>, <span class="number">127</span>, <span class="number">68</span>, <span class="number">103</span>, <span class="number">85</span>, <span class="number">105</span>, <span class="number">113</span>, <span class="number">80</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">67</span>, <span class="number">81</span>, <span class="number">7</span>, <span class="number">113</span>, <span class="number">70</span>, <span class="number">47</span>, <span class="number">73</span>, <span class="number">92</span>, <span class="number">124</span>, <span class="number">93</span>, <span class="number">120</span>, <span class="number">104</span>, <span class="number">108</span>, <span class="number">106</span>, <span class="number">17</span>, <span class="number">80</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">75</span>, <span class="number">93</span>, <span class="number">68</span>, <span class="number">121</span>, <span class="number">26</span>]</span><br><span class="line"> keys = [random.randint(<span class="number">0</span>, <span class="built_in">len</span>(encry)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encry))]</span><br><span class="line"> flag = []</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encry)):</span><br><span class="line">    flag.append(keys[i] ^ encry[i])</span><br><span class="line"> <span class="keyword">try</span>:</span><br><span class="line">     <span class="built_in">print</span>(base64.b64decode((<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, flag))).encode()))</span><br><span class="line"> <span class="keyword">except</span> binascii.Error:</span><br><span class="line">     <span class="keyword">continue</span></span><br><span class="line"><span class="comment">#b&#x27;flag&#123;7f9a2d3c-07de-11ef-be5e-cf1e88674c0b&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="gdb-debug"><a href="#gdb-debug" class="headerlink" title="gdb_debug"></a>gdb_debug</h2><p>加密逻辑非常清楚</p><p>有三处异或</p><p>在生成的随机数那里，有一个办法</p><p>在它调用rand这个函数之后，后面下一个条件断点</p><p><img src="/../image/704.png" class="lazyload" data-srcset="/../image/704.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="704"></p><p>我们需要下三处条件断点，然后得出三处生成的随机数数组</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> flag[<span class="number">38</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> enc[<span class="number">38</span>] = &#123; <span class="number">0x63</span>,<span class="number">0x6f</span>,<span class="number">0x6e</span>,<span class="number">0x67</span>,<span class="number">0x72</span>,<span class="number">0x61</span>,<span class="number">0x74</span>,<span class="number">0x75</span>,<span class="number">0x6c</span>,<span class="number">0x61</span>,<span class="number">0x74</span>,<span class="number">0x69</span>,<span class="number">0x6f</span>,<span class="number">0x6e</span>,<span class="number">0x73</span>,<span class="number">0x74</span>,<span class="number">0x6f</span>,<span class="number">0x79</span>,<span class="number">0x6f</span>,<span class="number">0x75</span>,<span class="number">0x63</span>,<span class="number">0x6f</span>,<span class="number">0x6e</span>,<span class="number">0x67</span>,<span class="number">0x72</span>,<span class="number">0x61</span>,<span class="number">0x74</span>,<span class="number">0x75</span>,<span class="number">0x6c</span>,<span class="number">0x61</span>,<span class="number">0x74</span>,<span class="number">0x69</span>,<span class="number">0x6f</span>,<span class="number">0x6e</span>,<span class="number">0x73</span>,<span class="number">0x74</span>,<span class="number">0x6f</span>,<span class="number">0x79</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> arr1[<span class="number">38</span>] = &#123; <span class="number">0xBF</span>, <span class="number">0xD7</span>, <span class="number">0x2E</span>, <span class="number">0xDA</span>, <span class="number">0xEE</span>, <span class="number">0xA8</span>, <span class="number">0x1A</span>, <span class="number">0x10</span>, <span class="number">0x83</span>, <span class="number">0x73</span>, <span class="number">0xAC</span>, <span class="number">0xF1</span>, <span class="number">0x06</span>, <span class="number">0xBE</span>, <span class="number">0xAD</span>, <span class="number">0x88</span>, <span class="number">0x04</span>, <span class="number">0xD7</span>, <span class="number">0x12</span>, <span class="number">0xFE</span>, <span class="number">0xB5</span>, <span class="number">0xE2</span>, <span class="number">0x61</span>, <span class="number">0xB7</span>, <span class="number">0x3D</span>, <span class="number">0x07</span>, <span class="number">0x4A</span>, <span class="number">0xE8</span>, <span class="number">0x96</span>, <span class="number">0xA2</span>, <span class="number">0x9D</span>, <span class="number">0x4D</span>, <span class="number">0xBC</span>, <span class="number">0x81</span>, <span class="number">0x8C</span>, <span class="number">0xE9</span>, <span class="number">0x88</span>, <span class="number">0x78</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> xor[] = &#123; <span class="number">0xd9</span>,<span class="number">0x0f</span>,<span class="number">0x18</span>,<span class="number">0xbd</span>,<span class="number">0xc7</span>,<span class="number">0x16</span>,<span class="number">0x81</span>,<span class="number">0xbe</span>,<span class="number">0xf8</span>,<span class="number">0x4a</span>,<span class="number">0x65</span>,<span class="number">0xf2</span>,<span class="number">0x5d</span>,<span class="number">0xab</span>,<span class="number">0x2b</span>,<span class="number">0x33</span>,<span class="number">0xd4</span>,<span class="number">0xa5</span>,<span class="number">0x67</span>,<span class="number">0x98</span>,<span class="number">0x9f</span>,<span class="number">0x7e</span>,<span class="number">0x2b</span>,<span class="number">0x5d</span>,<span class="number">0xc2</span>,<span class="number">0xaf</span>,<span class="number">0x8e</span>,<span class="number">0x3a</span>,<span class="number">0x4c</span>,<span class="number">0xa5</span>,<span class="number">0x75</span>,<span class="number">0x25</span>,<span class="number">0xb4</span>,<span class="number">0x8d</span>,<span class="number">0xe3</span>,<span class="number">0x7b</span>,<span class="number">0xa3</span>,<span class="number">0x64</span> &#125;;</span><br><span class="line"><span class="type">uint32_t</span> xor1[] = &#123; <span class="number">0x5397b3de</span>,<span class="number">0x716150aa</span>,<span class="number">0x1dc9e542</span>,<span class="number">0x0c9bcafc</span>,<span class="number">0x769bf209</span>,<span class="number">0x774664e8</span>,<span class="number">0x4d05f8b2</span>,<span class="number">0x7a1b0806</span>,<span class="number">0x5489330d</span>,<span class="number">0x572e6493</span>,<span class="number">0x36e62061</span>,<span class="number">0x1c979ef4</span>,<span class="number">0x53b95624</span>,<span class="number">0x7b87ba49</span>,<span class="number">0x4a02a315</span>,<span class="number">0x4b3ee601</span>,<span class="number">0x3fa44ad7</span>,<span class="number">0x529698ab</span>,<span class="number">0x5d6d5804</span>,<span class="number">0x18161018</span>,<span class="number">0x605146cf</span>,<span class="number">0x75be02e9</span>,<span class="number">0x5b2f51d5</span>,<span class="number">0x04c0fb96</span>,<span class="number">0x22f4fb33</span>,<span class="number">0x314403ca</span>,<span class="number">0x58e431f9</span>,<span class="number">0x488cbe2a</span>,<span class="number">0x6677855e</span>,<span class="number">0x771e54ea</span>,<span class="number">0x677e312d</span>,<span class="number">0x3a0f393c</span>,<span class="number">0x687fa594</span>,<span class="number">0x0548166f</span>,<span class="number">0x46ab0438</span>,<span class="number">0x5f1b979d</span>,<span class="number">0x7c8e7b58</span>,<span class="number">0x13b0fcea</span> &#125;;</span><br><span class="line"><span class="type">int</span> t1[] = &#123; <span class="number">33</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">32</span>,<span class="number">31</span>,<span class="number">10</span>,<span class="number">29</span>,<span class="number">9</span>,<span class="number">24</span>,<span class="number">26</span>,<span class="number">11</span>,<span class="number">20</span>,<span class="number">24</span>,<span class="number">21</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> ptr[<span class="number">38</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> final_flag[<span class="number">38</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">38</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">ptr[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">37</span>; i; --i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> v18 = t1[<span class="number">37</span>-i];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v19 = ptr[i];</span><br><span class="line">ptr[i] = ptr[v18];</span><br><span class="line">ptr[v18] = v19;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">38</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">flag[i] = enc[i] ^ arr1[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">38</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">flag[i] ^= xor1[i];</span><br><span class="line">final_flag[ptr[i]] = (flag[i]&amp;<span class="number">0xff</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">38</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">final_flag[i] ^= xor[i];</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, final_flag[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../image/image-20240531204507826.png" class="lazyload" data-srcset="/../image/image-20240531204507826.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240531204507826"></p><h2 id="rust-baby"><a href="#rust-baby" class="headerlink" title="rust_baby"></a>rust_baby</h2><p>首先我们要先找到这个函数</p><p>sub_7FF7B37F298A</p><p>这个函数相当于就是我们的主函数</p><p><img src="/../image/706.png" class="lazyload" data-srcset="/../image/706.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="706"></p><p>然后我们把memcpy的内容放到cyberchef里面解密，发现它一个字典的格式，这里面的信息对我们后面有用</p><p>这个函数就是输入函数</p><p><img src="/../image/707.png" class="lazyload" data-srcset="/../image/707.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="707"></p><p>我们注意到后面只处理八个字符，所以我就先输入8个字符</p><p>我们直接下个硬件断点，然后我们可以跟踪对字符串的处理</p><p><img src="/../image/708.png" class="lazyload" data-srcset="/../image/708.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="708"></p><p>由于这里的加密函数太复杂了，我们直接黑盒分析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">12345611  -------&gt;&gt;&gt;  01346733</span><br><span class="line">aabbccdd  -------&gt;&gt;&gt;  ``bbddff</span><br><span class="line">22334455  -------&gt;&gt;&gt;  11335577</span><br><span class="line">44556677  -------&gt;&gt;&gt;  33557799</span><br></pre></td></tr></table></figure><p>我们可以得到这个规律，后面还有个异或操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dic=-<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(enc),<span class="number">2</span>):</span><br><span class="line">    enc[i]+=dic</span><br><span class="line">    enc[i+<span class="number">1</span>]+=dic</span><br><span class="line">    dic+=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i]^=<span class="number">0x33</span></span><br></pre></td></tr></table></figure><p>后面还有一个异或操作</p><p><img src="/../image/709.png" class="lazyload" data-srcset="/../image/709.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="709"></p><p>然后我们可以在这里提取出来我们需要异或的数值，但是我们怎么提取出真正的密钥呢，我们可以看到v91那里一共有104个字节，我们可以把这里全部设置成0</p><p>然后在后面可以提取出密钥，由于中间全部进行了base64加密操作，base64解密之后的就是真正的密钥</p><p><img src="/../image/710.png" class="lazyload" data-srcset="/../image/710.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="710"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">REAL_KEY =[<span class="number">0xdc</span>,<span class="number">0x5f</span>,<span class="number">0x20</span>,<span class="number">0x22</span>,<span class="number">0xc2</span>,<span class="number">0x79</span>,<span class="number">0x19</span>,<span class="number">0x56</span>,<span class="number">0x35</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0x47</span>,<span class="number">0xd3</span>,<span class="number">0x19</span>,<span class="number">0xfc</span>,<span class="number">0x55</span>,<span class="number">0x14</span>,<span class="number">0xcd</span>,<span class="number">0xd2</span>,<span class="number">0x7b</span>,<span class="number">0x58</span>,<span class="number">0x59</span>,<span class="number">0x09</span>,<span class="number">0x42</span>,<span class="number">0xde</span>,<span class="number">0x2c</span>,<span class="number">0xb4</span>,<span class="number">0x48</span>,<span class="number">0xd9</span>,<span class="number">0xf2</span>,<span class="number">0x1b</span>,<span class="number">0xa9</span>,<span class="number">0x40</span>,<span class="number">0xe1</span>,<span class="number">0xa6</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0x38</span>,<span class="number">0xc1</span>,<span class="number">0xd5</span>,<span class="number">0xe2</span>,<span class="number">0xe8</span>,<span class="number">0x77</span>,<span class="number">0x78</span>,<span class="number">0x6f</span>,<span class="number">0x22</span>,<span class="number">0x04</span>,<span class="number">0xe6</span>,<span class="number">0x16</span>,<span class="number">0x3e</span>,<span class="number">0x0c</span>,<span class="number">0x35</span>,<span class="number">0x52</span>,<span class="number">0x5c</span>,<span class="number">0xfd</span>,<span class="number">0xc1</span>,<span class="number">0xe5</span>,<span class="number">0x59</span>,<span class="number">0x1c</span>,<span class="number">0xd0</span>,<span class="number">0xae</span>,<span class="number">0x5a</span>,<span class="number">0xb2</span>,<span class="number">0xdd</span>,<span class="number">0x19</span>,<span class="number">0xf8</span>,<span class="number">0x42</span>,<span class="number">0xe6</span>,<span class="number">0x2c</span>,<span class="number">0x89</span>,<span class="number">0x59</span>,<span class="number">0xe5</span>,<span class="number">0x11</span>,<span class="number">0x9c</span>,<span class="number">0xc8</span>,<span class="number">0x7b</span>,<span class="number">0x81</span>,<span class="number">0x70</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0xbc</span>,<span class="number">0x6f</span>,<span class="number">0x02</span>,<span class="number">0x8f</span>,<span class="number">0xf7</span>,<span class="number">0xf4</span>,<span class="number">0xc8</span>,<span class="number">0x70</span>,<span class="number">0xae</span>,<span class="number">0x02</span>,<span class="number">0xf8</span>,<span class="number">0x5b</span>,<span class="number">0xe2</span>,<span class="number">0x72</span>,<span class="number">0x08</span>,<span class="number">0x09</span>,<span class="number">0x6f</span>,<span class="number">0xbf</span>,<span class="number">0x4b</span>,<span class="number">0x39</span>,<span class="number">0xb5</span>,<span class="number">0xd0</span>,<span class="number">0x1e</span>,<span class="number">0xa3</span>]</span><br><span class="line">enc=[<span class="number">0x8a</span>,<span class="number">0x07</span>,<span class="number">0x72</span>,<span class="number">0x76</span>,<span class="number">0x8d</span>,<span class="number">0x7d</span>,<span class="number">0x4d</span>,<span class="number">0x51</span>,<span class="number">0x35</span>,<span class="number">0xde</span>,<span class="number">0x88</span>,<span class="number">0x16</span>,<span class="number">0xd4</span>,<span class="number">0x04</span>,<span class="number">0xf9</span>,<span class="number">0x0e</span>,<span class="number">0x08</span>,<span class="number">0xcf</span>,<span class="number">0xcc</span>,<span class="number">0x7c</span>,<span class="number">0x0f</span>,<span class="number">0x0d</span>,<span class="number">0x09</span>,<span class="number">0x5e</span>,<span class="number">0xd5</span>,<span class="number">0x7e</span>,<span class="number">0xe4</span>,<span class="number">0x4b</span>,<span class="number">0xc4</span>,<span class="number">0xf3</span>,<span class="number">0x1c</span>,<span class="number">0xaf</span>,<span class="number">0x12</span>,<span class="number">0xe4</span>,<span class="number">0xa0</span>,<span class="number">0xae</span>,<span class="number">0xf6</span>,<span class="number">0x69</span>,<span class="number">0xc9</span>,<span class="number">0xd2</span>,<span class="number">0xe0</span>,<span class="number">0xa7</span>,<span class="number">0x01</span>,<span class="number">0x0e</span>,<span class="number">0x1a</span>,<span class="number">0x57</span>,<span class="number">0x70</span>,<span class="number">0x92</span>,<span class="number">0x61</span>,<span class="number">0x49</span>,<span class="number">0x7a</span>,<span class="number">0x43</span>,<span class="number">0x27</span>,<span class="number">0x29</span>,<span class="number">0x89</span>,<span class="number">0xb5</span>,<span class="number">0x92</span>,<span class="number">0x2e</span>,<span class="number">0x6a</span>,<span class="number">0xa6</span>,<span class="number">0xdb</span>,<span class="number">0x2f</span>,<span class="number">0xc6</span>,<span class="number">0xa9</span>,<span class="number">0x6e</span>,<span class="number">0x8f</span>,<span class="number">0x34</span>,<span class="number">0x90</span>,<span class="number">0x59</span>,<span class="number">0xfc</span>,<span class="number">0x2d</span>,<span class="number">0x91</span>,<span class="number">0x66</span>,<span class="number">0xeb</span>,<span class="number">0xbe</span>,<span class="number">0x0d</span>,<span class="number">0xf4</span>,<span class="number">0x05</span>,<span class="number">0x0b</span>,<span class="number">0x1b</span>,<span class="number">0xcb</span>,<span class="number">0x18</span>,<span class="number">0x74</span>,<span class="number">0xf9</span>,<span class="number">0x82</span>,<span class="number">0x81</span>,<span class="number">0xbc</span>,<span class="number">0x04</span>,<span class="number">0xd9</span>,<span class="number">0x75</span>,<span class="number">0x8e</span>,<span class="number">0x2d</span>,<span class="number">0x97</span>,<span class="number">0x07</span>,<span class="number">0x7c</span>,<span class="number">0x7d</span>,<span class="number">0x18</span>,<span class="number">0xc8</span>,<span class="number">0x3d</span>,<span class="number">0x4f</span>,<span class="number">0xc0</span>,<span class="number">0xa5</span>,<span class="number">0x6a</span>,<span class="number">0xd7</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(REAL_KEY)):</span><br><span class="line">    enc[i]^=REAL_KEY[i]</span><br><span class="line">    enc[i]^=<span class="number">0x33</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">   num1=-<span class="number">1</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">8</span>,<span class="number">2</span>):</span><br><span class="line">       enc[<span class="number">8</span>*i+j]-=num1</span><br><span class="line">       enc[<span class="number">8</span>*i+j+<span class="number">1</span>]-=num1</span><br><span class="line">       num1+=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span>  i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(enc[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#flag&#123;6e2480b3-4f02-4cf1-9bc0-123b75f9a922&#125;</span></span><br></pre></td></tr></table></figure><h2 id="GoReverse"><a href="#GoReverse" class="headerlink" title="GoReverse"></a>GoReverse</h2><h3 id="程序分析"><a href="#程序分析" class="headerlink" title="程序分析"></a>程序分析</h3><p>这里借鉴的思路是panda0s师傅的思路</p><p><a href="https://www.bilibili.com/video/BV1bJ4m1w767/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=f5a24deea97cc11fbdd53a993a4129bf">https://www.bilibili.com/video/BV1bJ4m1w767/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=f5a24deea97cc11fbdd53a993a4129bf</a></p><p><img src="/../image/667.png" class="lazyload" data-srcset="/../image/667.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="667"></p><p>发现没有符号表，我们可以先恢复一下符号表</p><p><a href="https://github.com/0xjiayu/go_parser">https://github.com/0xjiayu/go_parser</a><br>克隆仓库，IDA加载go_parser.py即可，不需要把脚本放到plugin里面</p><p><img src="/../image/668.png" class="lazyload" data-srcset="/../image/668.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="668"></p><p>初始化在runtime_main里面，然后我们的主函数在main__B2bUPq_Execute里面</p><p>里面一共有两个反调试的地方</p><p><img src="/../image/669.png" class="lazyload" data-srcset="/../image/669.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="669"></p><p>在调用这个runtime_systemstack之后就会退出，我们可以把这个nop掉</p><p><img src="/../image/670.png" class="lazyload" data-srcset="/../image/670.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="670"></p><p>第二个反调试就很明显了，在地址0x004D64A0 这里</p><p>把他patch掉就行了</p><p><img src="/../image/671.png" class="lazyload" data-srcset="/../image/671.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="671"></p><p>后面的zQyveE为xxtea加密，我们可以把ToUint32s复制下来</p><p><a href="https://github.com/xxtea/xxtea-go/blob/master/xxtea/xxtea.go">https://github.com/xxtea/xxtea-go/blob/master/xxtea/xxtea.go</a></p><p><img src="/../image/672.png" class="lazyload" data-srcset="/../image/672.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="672"></p><p>我们可以发现xxtea进行了魔改，魔改的地方为MX和delta</p><p>然后我们可以在以下几个地方设置断点</p><p><img src="/../image/673.png" class="lazyload" data-srcset="/../image/673.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="673"></p><p><img src="/../image/674.png" class="lazyload" data-srcset="/../image/674.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="674"></p><p>然后我们可以先在进行异或操作之前下个断点</p><p><img src="/../image/675.png" class="lazyload" data-srcset="/../image/675.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="675"></p><p>因为我是之前先异或了，所以再异或一下就回去了，这样便于我们更好分析</p><p>以下是我们异或的值</p><p><img src="/../image/676.png" class="lazyload" data-srcset="/../image/676.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="676"></p><p>我们经过xxtea加密之后我们看一下它的返回值</p><p><img src="/../image/677.png" class="lazyload" data-srcset="/../image/677.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="677"></p><p>一共十六个字节，很明显是我们的输入之后的加密结果，但是我们便于分析统一变成11，这个时候我们就可以直接按F9</p><p>跳到了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004D5D41 call    github_com_tjfoc_gmsm_sm4_NewCipher</span><br></pre></td></tr></table></figure><p><img src="/../image/678.png" class="lazyload" data-srcset="/../image/678.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="678"></p><p>然后这个时候我们可以得到SM4的密钥</p><p>继续往下面调</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004D5D96 call    crypto_rand_Read</span><br></pre></td></tr></table></figure><p>这是生成的随机数</p><p><img src="/../image/679.png" class="lazyload" data-srcset="/../image/679.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="679"></p><p>我们统一把它设成22</p><p>再继续往下面调，一直到了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004D5DEF call   rdx 其实调用的是crypto_cipher__ctr_XORKeyStream</span><br></pre></td></tr></table></figure><p>然后我们在rsi寄存器得到了我们一开始经过xxtea加密的密文</p><p>这个时候要和sm4生成的密文(CTR模式)进行异或</p><p>但是这个iv是随机生成的（后面会解释这个怎么得到）</p><p>继续往下面调我们可以到到aes的密钥</p><p><img src="/../image/680.png" class="lazyload" data-srcset="/../image/680.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="680"></p><p>再往下面走，我们可以得到aes的iv是key的前16位</p><p>我们在最后retn这里下个断点，我们把前16位的全都替换成33，最后在Linux里面会输出一段base32的字符串</p><p><img src="/../image/681.png" class="lazyload" data-srcset="/../image/681.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="681"></p><p><img src="/../image/683.png" class="lazyload" data-srcset="/../image/683.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="683"></p><p><img src="/../image/682.png" class="lazyload" data-srcset="/../image/682.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="682"></p><p>就是我们最后输入的33，那么说明我们在经过base32和aes解密之后，得到的前16个字节就是sm4随机生成的iv</p><h3 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h3><p>这里为了复现我直接借用了其它师傅在比赛中得到的flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3a4575cf-c85c-4350-90ca-baef825242&#125;</span><br></pre></td></tr></table></figure><p><img src="/../image/686.png" class="lazyload" data-srcset="/../image/686.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="686"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">enc=<span class="string">b&#x27;HAA4WOBVE4J2GIVLNOAXSN3N2L3UCBWPZJJICPWEVNYREBHRPGFGIT43WJENRUU25HKVMEMU7QRKDOZWADY7WOK2JAF7J7DOSZ652EY=&#x27;</span></span><br><span class="line"></span><br><span class="line">enc=base64.b32decode(enc)</span><br><span class="line"></span><br><span class="line">aeskey=<span class="string">b&#x27;dPGWgcLpqmxw3uOXhKpKV009Cql@@XE6&#x27;</span></span><br><span class="line">aesiv =<span class="string">b&#x27;dPGWgcLpqmxw3uOXhKpKV009Cql@@XE6&#x27;</span>[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">enc=AES.new(key=aeskey,iv=aesiv,mode=AES.MODE_CBC).decrypt(enc)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc[:<span class="number">16</span>].<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure><p>根据flag长度为40或42可知counter还需要分别+1和+2，总共3*16bytes</p><p><img src="/../image/685.png" class="lazyload" data-srcset="/../image/685.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="685"></p><p>我们将SM4加密的密文与AES解出来的明文的从第16位开始进行异或，解出来的就是xxtea的密文</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ctr=<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;7c aa 04 c3 57 63 29 c3 eb 24 34 4f cf 3e 00 88 7b 60 85 f1 45 88 35 17 52 2c 72 1e 8e cf cf c9 fa 03 9e 45 0f f9 7c 05 d7 e6 b0 3a 8c 0b 09 43 11 ba e2 41 45 1c e9 f6 ea 51 52 63 f5 41 5b 29&#x27;</span>)</span><br><span class="line">enc=<span class="built_in">list</span>(enc[<span class="number">16</span>:])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i]^=ctr[i]</span><br><span class="line">enc=<span class="built_in">bytes</span>(enc)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(enc), <span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(struct.unpack(<span class="string">&quot;&lt;I&quot;</span>, enc[i:i+<span class="number">4</span>])[<span class="number">0</span>]), end=<span class="string">&quot;,&quot;</span>) <span class="comment">#变成32位，便于后面进行xxtea解密</span></span><br></pre></td></tr></table></figure><p>之后进行xxtea加密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX ((((z&gt;&gt;5 ^ y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3 ^ z&lt;&lt;4)) ^ (sum^y)) + (key[(p&amp;3)^e]^z))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x7FAB4CAD</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">xxtea</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>* v, <span class="type">unsigned</span> <span class="type">int</span>* key, <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> y, z, sum;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> p, e, round;</span><br><span class="line"><span class="keyword">if</span> (n &gt; <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">round = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">sum = <span class="number">0</span>;</span><br><span class="line">z = v[n - <span class="number">1</span>];</span><br><span class="line"><span class="keyword">while</span> (round--)</span><br><span class="line">&#123;</span><br><span class="line">sum += DELTA;</span><br><span class="line">e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line"><span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">&#123;</span><br><span class="line">y = v[p + <span class="number">1</span>];</span><br><span class="line">v[p] += MX;</span><br><span class="line">z = v[p];</span><br><span class="line">&#125;</span><br><span class="line">y = v[<span class="number">0</span>];</span><br><span class="line">v[n - <span class="number">1</span>] += MX;</span><br><span class="line">z = v[n - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (n &lt; <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">n = -n;</span><br><span class="line">round = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">sum = DELTA * round;</span><br><span class="line">y = v[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">while</span> (round--)</span><br><span class="line">&#123;</span><br><span class="line">e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line"><span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">&#123;</span><br><span class="line">z = v[p - <span class="number">1</span>];</span><br><span class="line">v[p] -= MX;</span><br><span class="line">y = v[p];</span><br><span class="line">&#125;</span><br><span class="line">z = v[n - <span class="number">1</span>];</span><br><span class="line">v[<span class="number">0</span>] -= MX;</span><br><span class="line">y = v[<span class="number">0</span>];</span><br><span class="line">sum -= DELTA;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> xorr[] = <span class="string">&quot;D7BJLsOk9@f&amp;1dWIn53IDlJqUS6$^WhkAk2kk*2GaqmLwiLX^bGGE$&amp;dmqR^g5bL3lCA5^HGK$9qo5T@Bwom9vEXya0HAV3LrWW&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> keybyte[] = <span class="string">&quot;Bs^8*wZ4lu8oR&amp;@k&quot;</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span>* key = (<span class="type">unsigned</span> <span class="type">int</span>*)keybyte;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> text[] = &#123; <span class="number">0x14e89d7c</span>,<span class="number">0x70624924</span>,<span class="number">0xe0a2078c</span>,<span class="number">0x555d91e</span>,<span class="number">0xcdd3602</span>,<span class="number">0x6bc8c9d6</span>,<span class="number">0x975e0d09</span>,<span class="number">0x5a54d90f</span>,<span class="number">0xafc1d576</span>,<span class="number">0x73f7f1b2</span>,<span class="number">0x32b8eedf</span>,<span class="number">0x4b010384</span> &#125;;</span><br><span class="line">xxtea(text, key, <span class="number">-10</span>);</span><br><span class="line"><span class="type">char</span>* enc = (<span class="type">char</span>*)text;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)</span><br><span class="line">enc[i] ^= xorr[i % <span class="built_in">strlen</span>(xorr)];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, enc[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../image/687.png" class="lazyload" data-srcset="/../image/687.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="687"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;asm-re&quot;&gt;&lt;a href=&quot;#asm-re&quot; class=&quot;headerlink&quot; title=&quot;asm_re&quot;&gt;&lt;/a&gt;asm_re&lt;/h2&gt;&lt;p&gt;直接手撕汇编&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/../image/688.png&quot; class=&quot;lazy</summary>
      
    
    
    
    <category term="WP" scheme="https://5m10v3.top/categories/WP/"/>
    
    
    <category term="ctf学习" scheme="https://5m10v3.top/tags/ctf%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>逆向练习(一)</title>
    <link href="https://5m10v3.top/2024/05/29/%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0(%E4%B8%80)/"/>
    <id>https://5m10v3.top/2024/05/29/%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0(%E4%B8%80)/</id>
    <published>2024-05-28T16:00:00.000Z</published>
    <updated>2024-06-09T09:11:01.335Z</updated>
    
    <content type="html"><![CDATA[<p>今日练习一题之AES魔改</p><p>题目链接如下，供各位师傅下载</p><p><a href="https://wwb.lanzout.com/iq2Aw20n4ype">https://wwb.lanzout.com/iq2Aw20n4ype</a><br>密码:2v3h</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>打开题目发现没有main函数，我们通过字符串查找定位到main函数，我们发现main函数的地方标红，发现是有花指令</p><p><img src="/../image/711.png" class="lazyload" data-srcset="/../image/711.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="711"></p><p>我们进行修复的时候要先修复下面那个call指令</p><p>修复成下图这个样子</p><p><img src="/../image/712.png" class="lazyload" data-srcset="/../image/712.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="712"></p><p>然后再将上面nop掉，就可以恢复这个主函数</p><p><img src="/../image/713.png" class="lazyload" data-srcset="/../image/713.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="713"></p><p>我们可以注意到v9就是密文，然后sub_43615B就是加密函数</p><p>但是我在做这道题的时候，没有注意到它的导出表</p><p>有一个tls反调试</p><p><img src="/../image/714.png" class="lazyload" data-srcset="/../image/714.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="714"></p><p>在这个里面主要是将密钥的第三位替换成了<strong>h</strong></p><p><img src="/../image/715.png" class="lazyload" data-srcset="/../image/715.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="715"></p><p>然后加密函数那里也有花指令</p><p>修复以及重命名之后可以看出AES的特征非常明显了</p><p><img src="/../image/716.png" class="lazyload" data-srcset="/../image/716.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="716"></p><p>主要魔改的点有以下几点:</p><ul><li>在addRoundKey轮密钥加后面那里加了异或操作(固定值)</li><li>S盒的替换</li><li>subBytes和mixColumns里面也加了异或操作</li></ul><p><img src="/../image/717.png" class="lazyload" data-srcset="/../image/717.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="717"></p><p><img src="/../image/718.png" class="lazyload" data-srcset="/../image/718.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="718"></p><p><img src="/../image/719.png" class="lazyload" data-srcset="/../image/719.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="719"></p><p>进行解密的时候先异或一下就行了</p><p>首先是S盒替换的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">new_s_box = [</span><br><span class="line"><span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>, <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, </span><br><span class="line">  <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, </span><br><span class="line">  <span class="number">0x72</span>, <span class="number">0xC0</span>, <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, </span><br><span class="line">  <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>, <span class="number">0x04</span>, <span class="number">0xC7</span>, </span><br><span class="line">  <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, </span><br><span class="line">  <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>, <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, </span><br><span class="line">  <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>, </span><br><span class="line">  <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, </span><br><span class="line">  <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>, <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, </span><br><span class="line">  <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, </span><br><span class="line">  <span class="number">0x9F</span>, <span class="number">0xA8</span>, <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, </span><br><span class="line">  <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>, <span class="number">0xCD</span>, <span class="number">0x0C</span>, </span><br><span class="line">  <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, </span><br><span class="line">  <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, </span><br><span class="line">  <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, </span><br><span class="line">  <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>, <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, </span><br><span class="line">  <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, </span><br><span class="line">  <span class="number">0xAE</span>, <span class="number">0x08</span>, <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, </span><br><span class="line">  <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, <span class="number">0x70</span>, <span class="number">0x3E</span>, </span><br><span class="line">  <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, </span><br><span class="line">  <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>, <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, </span><br><span class="line">  <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>, </span><br><span class="line">  <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, </span><br><span class="line">  <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span></span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line">new_contrary_sbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    line = (new_s_box[i]&amp;<span class="number">0xf0</span>)&gt;&gt;<span class="number">4</span></span><br><span class="line">    rol = new_s_box[i]&amp;<span class="number">0xf</span></span><br><span class="line">    new_contrary_sbox[(line*<span class="number">16</span>)+rol] = i</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (new_contrary_sbox)</span><br></pre></td></tr></table></figure><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>aes.h文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Chinese Academy of Sciences</span></span><br><span class="line"><span class="comment"> * State Key Laboratory of Information Security</span></span><br><span class="line"><span class="comment"> * Institute of Information Engineering</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2016 Chinese Academy of Sciences</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * LuoPeng, luopeng@iie.ac.cn</span></span><br><span class="line"><span class="comment"> * Updated in May 2016</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> AES_128_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_128_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_BLOCK_SIZE      16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_ROUNDS          10  <span class="comment">// 12, 14</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_ROUND_KEY_SIZE  176 <span class="comment">// AES-128 has 10 rounds, and there is a AddRoundKey before first round. (10+1)x16=176.</span></span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @purpose:            Key schedule for AES-128</span></span><br><span class="line"><span class="comment">  * @par[in]key:         16 bytes of master keys</span></span><br><span class="line"><span class="comment">  * @par[out]roundkeys:  176 bytes of round keys</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_schedule_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* key, <span class="type">uint8_t</span>* roundkeys)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @purpose:            Encryption. The length of plain and cipher should be one block (16 bytes).</span></span><br><span class="line"><span class="comment"> *                      The plaintext and ciphertext may point to the same memory</span></span><br><span class="line"><span class="comment"> * @par[in]roundkeys:   round keys</span></span><br><span class="line"><span class="comment"> * @par[in]plaintext:   plain text</span></span><br><span class="line"><span class="comment"> * @par[out]ciphertext: cipher text</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_encrypt_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* roundkeys, <span class="type">const</span> <span class="type">uint8_t</span>* plaintext, <span class="type">uint8_t</span>* ciphertext)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @purpose:            Decryption. The length of plain and cipher should be one block (16 bytes).</span></span><br><span class="line"><span class="comment"> *                      The ciphertext and plaintext may point to the same memory</span></span><br><span class="line"><span class="comment"> * @par[in]roundkeys:   round keys</span></span><br><span class="line"><span class="comment"> * @par[in]ciphertext:  cipher text</span></span><br><span class="line"><span class="comment"> * @par[out]plaintext:  plain text</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_decrypt_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* roundkeys, <span class="type">const</span> <span class="type">uint8_t</span>* ciphertext, <span class="type">uint8_t</span>* plaintext)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>aes.c文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Chinese Academy of Sciences</span></span><br><span class="line"><span class="comment"> * State Key Laboratory of Information Security</span></span><br><span class="line"><span class="comment"> * Institute of Information Engineering</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2016 Chinese Academy of Sciences</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * LuoPeng, luopeng@iie.ac.cn</span></span><br><span class="line"><span class="comment"> * Updated in Oct 2016</span></span><br><span class="line"><span class="comment"> * Updated in Jan 2017, update muliple function on GF(2^8).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;aes.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * round constants</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> RC[] = &#123; <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1b</span>, <span class="number">0x36</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Sbox</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> xor1[<span class="number">16</span>] = &#123; <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>,</span><br><span class="line">  <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>, <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>,</span><br><span class="line">  <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>,</span><br><span class="line">  <span class="number">0x72</span>, <span class="number">0xC0</span>, <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>,</span><br><span class="line">  <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>, <span class="number">0x04</span>, <span class="number">0xC7</span>,</span><br><span class="line">  <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>,</span><br><span class="line">  <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>, <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>,</span><br><span class="line">  <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">  <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>,</span><br><span class="line">  <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>, <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>,</span><br><span class="line">  <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>,</span><br><span class="line">  <span class="number">0x9F</span>, <span class="number">0xA8</span>, <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>,</span><br><span class="line">  <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>, <span class="number">0xCD</span>, <span class="number">0x0C</span>,</span><br><span class="line">  <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>,</span><br><span class="line">  <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>,</span><br><span class="line">  <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>,</span><br><span class="line">  <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>, <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>,</span><br><span class="line">  <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>,</span><br><span class="line">  <span class="number">0xAE</span>, <span class="number">0x08</span>, <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>,</span><br><span class="line">  <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, <span class="number">0x70</span>, <span class="number">0x3E</span>,</span><br><span class="line">  <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>,</span><br><span class="line">  <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>, <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>,</span><br><span class="line">  <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">  <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>,</span><br><span class="line">  <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Inverse Sboxs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> INV_SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line">    <span class="number">82</span>, <span class="number">9</span>, <span class="number">106</span>, <span class="number">213</span>, <span class="number">48</span>, <span class="number">54</span>, <span class="number">165</span>, <span class="number">56</span>, <span class="number">191</span>, <span class="number">64</span>, <span class="number">163</span>, <span class="number">158</span>, <span class="number">129</span>, <span class="number">243</span>, <span class="number">215</span>, <span class="number">251</span>, <span class="number">124</span>, <span class="number">227</span>, <span class="number">57</span>, <span class="number">130</span>, <span class="number">155</span>, <span class="number">47</span>, <span class="number">255</span>, <span class="number">135</span>, <span class="number">52</span>, <span class="number">142</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">196</span>, <span class="number">222</span>, <span class="number">233</span>, <span class="number">203</span>, <span class="number">84</span>, <span class="number">123</span>, <span class="number">148</span>, <span class="number">50</span>, <span class="number">166</span>, <span class="number">194</span>, <span class="number">35</span>, <span class="number">61</span>, <span class="number">238</span>, <span class="number">76</span>, <span class="number">149</span>, <span class="number">11</span>, <span class="number">66</span>, <span class="number">250</span>, <span class="number">195</span>, <span class="number">78</span>, <span class="number">8</span>, <span class="number">46</span>, <span class="number">161</span>, <span class="number">102</span>, <span class="number">40</span>, <span class="number">217</span>, <span class="number">36</span>, <span class="number">178</span>, <span class="number">118</span>, <span class="number">91</span>, <span class="number">162</span>, <span class="number">73</span>, <span class="number">109</span>, <span class="number">139</span>, <span class="number">209</span>, <span class="number">37</span>, <span class="number">114</span>, <span class="number">248</span>, <span class="number">246</span>, <span class="number">100</span>, <span class="number">134</span>, <span class="number">104</span>, <span class="number">152</span>, <span class="number">22</span>, <span class="number">212</span>, <span class="number">164</span>, <span class="number">92</span>, <span class="number">204</span>, <span class="number">93</span>, <span class="number">101</span>, <span class="number">182</span>, <span class="number">146</span>, <span class="number">108</span>, <span class="number">112</span>, <span class="number">72</span>, <span class="number">80</span>, <span class="number">253</span>, <span class="number">237</span>, <span class="number">185</span>, <span class="number">218</span>, <span class="number">94</span>, <span class="number">21</span>, <span class="number">70</span>, <span class="number">87</span>, <span class="number">167</span>, <span class="number">141</span>, <span class="number">157</span>, <span class="number">132</span>, <span class="number">144</span>, <span class="number">216</span>, <span class="number">171</span>, <span class="number">0</span>, <span class="number">140</span>, <span class="number">188</span>, <span class="number">211</span>, <span class="number">10</span>, <span class="number">247</span>, <span class="number">228</span>, <span class="number">88</span>, <span class="number">5</span>, <span class="number">184</span>, <span class="number">179</span>, <span class="number">69</span>, <span class="number">6</span>, <span class="number">208</span>, <span class="number">44</span>, <span class="number">30</span>, <span class="number">143</span>, <span class="number">202</span>, <span class="number">63</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">193</span>, <span class="number">175</span>, <span class="number">189</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">19</span>, <span class="number">138</span>, <span class="number">107</span>, <span class="number">58</span>, <span class="number">145</span>, <span class="number">17</span>, <span class="number">65</span>, <span class="number">79</span>, <span class="number">103</span>, <span class="number">220</span>, <span class="number">234</span>, <span class="number">151</span>, <span class="number">242</span>, <span class="number">207</span>, <span class="number">206</span>, <span class="number">240</span>, <span class="number">180</span>, <span class="number">230</span>, <span class="number">115</span>, <span class="number">150</span>, <span class="number">172</span>, <span class="number">116</span>, <span class="number">34</span>, <span class="number">231</span>, <span class="number">173</span>, <span class="number">53</span>, <span class="number">133</span>, <span class="number">226</span>, <span class="number">249</span>, <span class="number">55</span>, <span class="number">232</span>, <span class="number">28</span>, <span class="number">117</span>, <span class="number">223</span>, <span class="number">110</span>, <span class="number">71</span>, <span class="number">241</span>, <span class="number">26</span>, <span class="number">113</span>, <span class="number">29</span>, <span class="number">41</span>, <span class="number">197</span>, <span class="number">137</span>, <span class="number">111</span>, <span class="number">183</span>, <span class="number">98</span>, <span class="number">14</span>, <span class="number">170</span>, <span class="number">24</span>, <span class="number">190</span>, <span class="number">27</span>, <span class="number">252</span>, <span class="number">86</span>, <span class="number">62</span>, <span class="number">75</span>, <span class="number">198</span>, <span class="number">210</span>, <span class="number">121</span>, <span class="number">32</span>, <span class="number">154</span>, <span class="number">219</span>, <span class="number">192</span>, <span class="number">254</span>, <span class="number">120</span>, <span class="number">205</span>, <span class="number">90</span>, <span class="number">244</span>, <span class="number">31</span>, <span class="number">221</span>, <span class="number">168</span>, <span class="number">51</span>, <span class="number">136</span>, <span class="number">7</span>, <span class="number">199</span>, <span class="number">49</span>, <span class="number">177</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">89</span>, <span class="number">39</span>, <span class="number">128</span>, <span class="number">236</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">81</span>, <span class="number">127</span>, <span class="number">169</span>, <span class="number">25</span>, <span class="number">181</span>, <span class="number">74</span>, <span class="number">13</span>, <span class="number">45</span>, <span class="number">229</span>, <span class="number">122</span>, <span class="number">159</span>, <span class="number">147</span>, <span class="number">201</span>, <span class="number">156</span>, <span class="number">239</span>, <span class="number">160</span>, <span class="number">224</span>, <span class="number">59</span>, <span class="number">77</span>, <span class="number">174</span>, <span class="number">42</span>, <span class="number">245</span>, <span class="number">176</span>, <span class="number">200</span>, <span class="number">235</span>, <span class="number">187</span>, <span class="number">60</span>, <span class="number">131</span>, <span class="number">83</span>, <span class="number">153</span>, <span class="number">97</span>, <span class="number">23</span>, <span class="number">43</span>, <span class="number">4</span>, <span class="number">126</span>, <span class="number">186</span>, <span class="number">119</span>, <span class="number">214</span>, <span class="number">38</span>, <span class="number">225</span>, <span class="number">105</span>,</span><br><span class="line"><span class="number">20</span>, <span class="number">99</span>, <span class="number">85</span>, <span class="number">33</span>, <span class="number">12</span>, <span class="number">125</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * https://en.wikipedia.org/wiki/Finite_field_arithmetic</span></span><br><span class="line"><span class="comment"> * Multiply two numbers in the GF(2^8) finite field defined</span></span><br><span class="line"><span class="comment"> * by the polynomial x^8 + x^4 + x^3 + x + 1 = 0</span></span><br><span class="line"><span class="comment"> * We do use mul2(int8_t a) but not mul(uint8_t a, uint8_t b)</span></span><br><span class="line"><span class="comment"> * just in order to get a higher speed.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint8_t</span> <span class="title function_">mul2</span><span class="params">(<span class="type">uint8_t</span> a)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">0x1B</span> * ((a &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>)) ^ (<span class="number">2</span> * a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @purpose:    ShiftRows</span></span><br><span class="line"><span class="comment"> * @descrption:</span></span><br><span class="line"><span class="comment"> *  Row0: s0  s4  s8  s12   &lt;&lt;&lt; 0 byte</span></span><br><span class="line"><span class="comment"> *  Row1: s1  s5  s9  s13   &lt;&lt;&lt; 1 byte</span></span><br><span class="line"><span class="comment"> *  Row2: s2  s6  s10 s14   &lt;&lt;&lt; 2 bytes</span></span><br><span class="line"><span class="comment"> *  Row3: s3  s7  s11 s15   &lt;&lt;&lt; 3 bytes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">shift_rows</span><span class="params">(<span class="type">uint8_t</span>* state)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> temp;</span><br><span class="line">    <span class="comment">// row1</span></span><br><span class="line">    temp = *(state + <span class="number">1</span>);</span><br><span class="line">    *(state + <span class="number">1</span>) = *(state + <span class="number">5</span>);</span><br><span class="line">    *(state + <span class="number">5</span>) = *(state + <span class="number">9</span>);</span><br><span class="line">    *(state + <span class="number">9</span>) = *(state + <span class="number">13</span>);</span><br><span class="line">    *(state + <span class="number">13</span>) = temp;</span><br><span class="line">    <span class="comment">// row2</span></span><br><span class="line">    temp = *(state + <span class="number">2</span>);</span><br><span class="line">    *(state + <span class="number">2</span>) = *(state + <span class="number">10</span>);</span><br><span class="line">    *(state + <span class="number">10</span>) = temp;</span><br><span class="line">    temp = *(state + <span class="number">6</span>);</span><br><span class="line">    *(state + <span class="number">6</span>) = *(state + <span class="number">14</span>);</span><br><span class="line">    *(state + <span class="number">14</span>) = temp;</span><br><span class="line">    <span class="comment">// row3</span></span><br><span class="line">    temp = *(state + <span class="number">15</span>);</span><br><span class="line">    *(state + <span class="number">15</span>) = *(state + <span class="number">11</span>);</span><br><span class="line">    *(state + <span class="number">11</span>) = *(state + <span class="number">7</span>);</span><br><span class="line">    *(state + <span class="number">7</span>) = *(state + <span class="number">3</span>);</span><br><span class="line">    *(state + <span class="number">3</span>) = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @purpose:    Inverse ShiftRows</span></span><br><span class="line"><span class="comment"> * @description</span></span><br><span class="line"><span class="comment"> *  Row0: s0  s4  s8  s12   &gt;&gt;&gt; 0 byte</span></span><br><span class="line"><span class="comment"> *  Row1: s1  s5  s9  s13   &gt;&gt;&gt; 1 byte</span></span><br><span class="line"><span class="comment"> *  Row2: s2  s6  s10 s14   &gt;&gt;&gt; 2 bytes</span></span><br><span class="line"><span class="comment"> *  Row3: s3  s7  s11 s15   &gt;&gt;&gt; 3 bytes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(<span class="type">uint8_t</span>* state)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> temp;</span><br><span class="line">    <span class="comment">// row1</span></span><br><span class="line">    temp = *(state + <span class="number">13</span>);</span><br><span class="line">    *(state + <span class="number">13</span>) = *(state + <span class="number">9</span>);</span><br><span class="line">    *(state + <span class="number">9</span>) = *(state + <span class="number">5</span>);</span><br><span class="line">    *(state + <span class="number">5</span>) = *(state + <span class="number">1</span>);</span><br><span class="line">    *(state + <span class="number">1</span>) = temp;</span><br><span class="line">    <span class="comment">// row2</span></span><br><span class="line">    temp = *(state + <span class="number">14</span>);</span><br><span class="line">    *(state + <span class="number">14</span>) = *(state + <span class="number">6</span>);</span><br><span class="line">    *(state + <span class="number">6</span>) = temp;</span><br><span class="line">    temp = *(state + <span class="number">10</span>);</span><br><span class="line">    *(state + <span class="number">10</span>) = *(state + <span class="number">2</span>);</span><br><span class="line">    *(state + <span class="number">2</span>) = temp;</span><br><span class="line">    <span class="comment">// row3</span></span><br><span class="line">    temp = *(state + <span class="number">3</span>);</span><br><span class="line">    *(state + <span class="number">3</span>) = *(state + <span class="number">7</span>);</span><br><span class="line">    *(state + <span class="number">7</span>) = *(state + <span class="number">11</span>);</span><br><span class="line">    *(state + <span class="number">11</span>) = *(state + <span class="number">15</span>);</span><br><span class="line">    *(state + <span class="number">15</span>) = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_schedule_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* key, <span class="type">uint8_t</span>* roundkeys)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> temp[<span class="number">4</span>];</span><br><span class="line">    <span class="type">uint8_t</span>* last4bytes; <span class="comment">// point to the last 4 bytes of one round</span></span><br><span class="line">    <span class="type">uint8_t</span>* lastround;</span><br><span class="line">    <span class="type">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">        *roundkeys++ = *key++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    last4bytes = roundkeys - <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_ROUNDS; ++i) &#123;</span><br><span class="line">        <span class="comment">// k0-k3 for next round</span></span><br><span class="line">        temp[<span class="number">3</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">0</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">1</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">2</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">0</span>] ^= RC[i];</span><br><span class="line">        lastround = roundkeys - <span class="number">16</span>;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">0</span>] ^ *lastround++;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">1</span>] ^ *lastround++;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">2</span>] ^ *lastround++;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">3</span>] ^ *lastround++;</span><br><span class="line">        <span class="comment">// k4-k7 for next round        </span></span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        <span class="comment">// k8-k11 for next round</span></span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        <span class="comment">// k12-k15 for next round</span></span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_encrypt_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* roundkeys, <span class="type">const</span> <span class="type">uint8_t</span>* plaintext, <span class="type">uint8_t</span>* ciphertext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;, t;</span><br><span class="line">    <span class="type">uint8_t</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// first AddRoundKey</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        *(ciphertext + i) = *(plaintext + i) ^ *roundkeys++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; AES_BLOCK_SIZE; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        *(ciphertext + j) ^= xor1[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9 rounds</span></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; AES_ROUNDS; ++j) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SubBytes</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">            *(tmp + i) = SBOX[*(ciphertext + i)];</span><br><span class="line">            *(tmp + i) ^= <span class="number">0xA1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        shift_rows(tmp);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * MixColumns</span></span><br><span class="line"><span class="comment">         * [02 03 01 01]   [s0  s4  s8  s12]</span></span><br><span class="line"><span class="comment">         * [01 02 03 01] . [s1  s5  s9  s13]</span></span><br><span class="line"><span class="comment">         * [01 01 02 03]   [s2  s6  s10 s14]</span></span><br><span class="line"><span class="comment">         * [03 01 01 02]   [s3  s7  s11 s15]</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; i += <span class="number">4</span>) &#123;</span><br><span class="line">            t = tmp[i] ^ tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">3</span>];</span><br><span class="line">            ciphertext[i] = mul2(tmp[i] ^ tmp[i + <span class="number">1</span>]) ^ tmp[i] ^ t;</span><br><span class="line">            ciphertext[i + <span class="number">1</span>] = mul2(tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">2</span>]) ^ tmp[i + <span class="number">1</span>] ^ t;</span><br><span class="line">            ciphertext[i + <span class="number">2</span>] = mul2(tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">3</span>]) ^ tmp[i + <span class="number">2</span>] ^ t;</span><br><span class="line">            ciphertext[i + <span class="number">3</span>] = mul2(tmp[i + <span class="number">3</span>] ^ tmp[i]) ^ tmp[i + <span class="number">3</span>] ^ t;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            ciphertext[j] ^= <span class="number">0x54</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// AddRoundKey</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">            *(ciphertext + i) ^= *roundkeys++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; AES_BLOCK_SIZE; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(ciphertext + j) ^= xor1[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// last round</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        *(ciphertext + i) = SBOX[*(ciphertext + i)];</span><br><span class="line">        *(ciphertext + i) ^= <span class="number">0xA1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    shift_rows(ciphertext);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        *(ciphertext + i) ^= *roundkeys++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; AES_BLOCK_SIZE; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        *(ciphertext + j) ^= xor1[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_decrypt_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* roundkeys, <span class="type">const</span> <span class="type">uint8_t</span>* ciphertext, <span class="type">uint8_t</span>* plaintext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span> t, u, v;</span><br><span class="line">    <span class="type">uint8_t</span> i, j;</span><br><span class="line"></span><br><span class="line">    roundkeys += <span class="number">160</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// first round</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) </span><br><span class="line">    &#123;</span><br><span class="line">        *(plaintext + i) = *(ciphertext + i) ^ *(roundkeys + i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; AES_BLOCK_SIZE; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        *(plaintext + j) ^= xor1[j];</span><br><span class="line">    &#125;</span><br><span class="line">    roundkeys -= <span class="number">16</span>;</span><br><span class="line">    inv_shift_rows(plaintext);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        *(plaintext + i)^= <span class="number">0xA1</span>;</span><br><span class="line">        *(plaintext + i) = INV_SBOX[*(plaintext + i)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; AES_ROUNDS; ++j) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Inverse AddRoundKey</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">            *(tmp + i) = *(plaintext + i) ^ *(roundkeys + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; AES_BLOCK_SIZE; ++j) &#123;</span><br><span class="line"></span><br><span class="line">            *(tmp + j) ^= xor1[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Inverse MixColumns</span></span><br><span class="line"><span class="comment">         * [0e 0b 0d 09]   [s0  s4  s8  s12]</span></span><br><span class="line"><span class="comment">         * [09 0e 0b 0d] . [s1  s5  s9  s13]</span></span><br><span class="line"><span class="comment">         * [0d 09 0e 0b]   [s2  s6  s10 s14]</span></span><br><span class="line"><span class="comment">         * [0b 0d 09 0e]   [s3  s7  s11 s15]</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[j] ^= <span class="number">0x54</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; i += <span class="number">4</span>) &#123;</span><br><span class="line">            t = tmp[i] ^ tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">3</span>];</span><br><span class="line">            plaintext[i] = t ^ tmp[i] ^ mul2(tmp[i] ^ tmp[i + <span class="number">1</span>]);</span><br><span class="line">            plaintext[i + <span class="number">1</span>] = t ^ tmp[i + <span class="number">1</span>] ^ mul2(tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">2</span>]);</span><br><span class="line">            plaintext[i + <span class="number">2</span>] = t ^ tmp[i + <span class="number">2</span>] ^ mul2(tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">3</span>]);</span><br><span class="line">            plaintext[i + <span class="number">3</span>] = t ^ tmp[i + <span class="number">3</span>] ^ mul2(tmp[i + <span class="number">3</span>] ^ tmp[i]);</span><br><span class="line">            u = mul2(mul2(tmp[i] ^ tmp[i + <span class="number">2</span>]));</span><br><span class="line">            v = mul2(mul2(tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">3</span>]));</span><br><span class="line">            t = mul2(u ^ v);</span><br><span class="line">            plaintext[i] ^= t ^ u;</span><br><span class="line">            plaintext[i + <span class="number">1</span>] ^= t ^ v;</span><br><span class="line">            plaintext[i + <span class="number">2</span>] ^= t ^ u;</span><br><span class="line">            plaintext[i + <span class="number">3</span>] ^= t ^ v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Inverse ShiftRows</span></span><br><span class="line">        inv_shift_rows(plaintext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Inverse SubBytes</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">            *(plaintext + i) ^= <span class="number">0xA1</span>;</span><br><span class="line">            *(plaintext + i) = INV_SBOX[*(plaintext + i)];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        roundkeys -= <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// last AddRoundKey</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        </span><br><span class="line">        *(plaintext + i) ^= *(roundkeys + i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; AES_BLOCK_SIZE; ++j) &#123;</span><br><span class="line"></span><br><span class="line">        *(plaintext + j) ^= xor1[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main.c文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> *</span><br><span class="line"> * Chinese Academy of Sciences</span><br><span class="line"> * State Key Laboratory of Information Security</span><br><span class="line"> * Institute of Information Engineering</span><br><span class="line"> *</span><br><span class="line"> * Copyright (C) 2016 Chinese Academy of Sciences</span><br><span class="line"> *</span><br><span class="line"> * LuoPeng, luopeng@iie.ac.cn</span><br><span class="line"> * Updated in May 2016</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#include &quot;aes.h&quot;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[]) &#123;</span><br><span class="line"></span><br><span class="line">uint8_t i, r;</span><br><span class="line"></span><br><span class="line">/* 128 bit key */</span><br><span class="line">uint8_t key[] = &#123;</span><br><span class="line">//0x0f, 0x15, 0x71, 0xc9, 0x47, 0xd9, 0xe8, 0x59, </span><br><span class="line">//0x0c, 0xb7, 0xad, 0xd6, 0xaf, 0x7f, 0x67, 0x98,</span><br><span class="line">0x67, 0x61, 0x68, 0x34, 0x33, 0x6A, 0x4A, 0x4B, 0x67, 0x66, 0x6A, 0x47, 0x4D, 0x65, 0x41, 0x52</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uint8_t plaintext[] = &#123;</span><br><span class="line">//0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef,</span><br><span class="line">//0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10,</span><br><span class="line">0x66,0x6c,0x61,0x67,0x7b,0x52,0x65,0x5f,0x31,0x74,0x73,0x5f,0x66,0x30,0x6e,0x7d</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uint8_t ciphertext[AES_BLOCK_SIZE];</span><br><span class="line"></span><br><span class="line">const uint8_t const_cipher[AES_BLOCK_SIZE] = &#123;</span><br><span class="line">//0xff, 0x0b, 0x84, 0x4a, 0x08, 0x53, 0xbf, 0x7c,</span><br><span class="line">//0x69, 0x34, 0xab, 0x43, 0x64, 0x14, 0x8f, 0xb9,</span><br><span class="line">0xB4, 0x38, 0x36, 0x30, 0x1E, 0x68, 0x48, 0x57, 0x51, 0x01, 0xB7, 0x03, 0x9B, 0x98, 0xE3, 0x7E &#125;;</span><br><span class="line">//74 BA B6 98 4C BE FF 09 46 CC D3 29 7A 21 C3 F7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">printf(&quot;\n--------------------------------------------------------\n&quot;);</span><br><span class="line">printf(&quot;Plain text:\n&quot;);</span><br><span class="line">for (i = 0; i &lt; AES_BLOCK_SIZE; i++) &#123;</span><br><span class="line">printf(&quot;%c&quot;, plaintext[i]);</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;\n\n&quot;);</span><br><span class="line">for (i = 0; i &lt; AES_BLOCK_SIZE; i++) &#123;</span><br><span class="line">printf(&quot;%c&quot;, key[i]);</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;\n\n&quot;);</span><br><span class="line"></span><br><span class="line">static uint8_t roundkeys[AES_ROUND_KEY_SIZE] = &#123; 0x67, 0x61, 0x68, 0x34, 0x33, 0x6A, 0x4A, 0x4B, 0x67, 0x66, 0x6A, 0x47, 0x4D, 0x65, 0x41, 0x52, 0x2B, 0xE2, 0x68, 0xD7, 0x18, 0x88, 0x22, 0x9C, 0x7F, 0xEE, 0x48, 0xDB, 0x32, 0x8B, 0x09, 0x89, 0x14, 0xE3, 0xCF, 0xF4, 0x0C, 0x6B, 0xED, 0x68, 0x73, 0x85, 0xA5, 0xB3, 0x41, 0x0E, 0xAC, 0x3A, 0xBB, 0x72, 0x4F, 0x77, 0xB7, 0x19, 0xA2, 0x1F, 0xC4, 0x9C, 0x07, 0xAC, 0x85, 0x92, 0xAB, 0x96, 0xFC, 0x10, 0xDF, 0xE0, 0x4B, 0x09, 0x7D, 0xFF, 0x8F, 0x95, 0x7A, 0x53, 0x0A, 0x07, 0xD1, 0xC5, 0x29, 0x2E, 0x79, 0x87, 0x62, 0x27, 0x04, 0x78, 0xED, 0xB2, 0x7E, 0x2B, 0xE7, 0xB5, 0xAF, 0xEE, 0xDC, 0x57, 0x51, 0x13, 0xBE, 0x70, 0x55, 0x6B, 0x53, 0xC2, 0x2B, 0x40, 0xB4, 0x77, 0x84, 0xAE, 0x69, 0x08, 0xB5, 0x9E, 0xD7, 0x78, 0xE0, 0xF5, 0x84, 0xBA, 0xCB, 0xB5, 0x30, 0xCD, 0x4F, 0x1B, 0x54, 0x8C, 0x1A, 0x9A, 0x83, 0xF4, 0xFA, 0x6F, 0x07, 0x4E, 0x31, 0xDA, 0x37, 0x83, 0x7E, 0xC1, 0xA3, 0x7F, 0x62, 0x00, 0x20, 0x8B, 0x98, 0x6F, 0x27, 0xC5, 0xA9, 0xB5, 0x10, 0x46, 0xD7, 0x74, 0xCF, 0x71, 0xF0, 0xCA, 0xEF, 0xFA, 0x68, 0xA5, 0xC8, 0x3F, 0xC1, 0x10, 0xD8, 0x79, 0x16, 0x64 &#125;;</span><br><span class="line">// decryption</span><br><span class="line">aes_decrypt_128(roundkeys, const_cipher, ciphertext);</span><br><span class="line">printf(&quot;Plain text:\n&quot;);</span><br><span class="line">for (i = 0; i &lt; AES_BLOCK_SIZE; i++) &#123;</span><br><span class="line">printf(&quot;%2x &quot;, ciphertext[i]);</span><br><span class="line">&#125;</span><br><span class="line">for (i = 0; i &lt; AES_BLOCK_SIZE; i++) &#123;</span><br><span class="line">if (ciphertext[i] != plaintext[i]) &#123; break; &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (AES_BLOCK_SIZE != i) &#123; printf(&quot;\nDECRYPT WRONG\n\n&quot;); &#125;</span><br><span class="line">else &#123; printf(&quot;\nDECRYPT CORRECT\n\n&quot;); &#125;</span><br><span class="line"></span><br><span class="line">return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../image/720.png" class="lazyload" data-srcset="/../image/720.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="720"></p><p>总结一下自己这次的过失</p><ul><li>没有注意到TLS，导致自己一直在做调试</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今日练习一题之AES魔改&lt;/p&gt;
&lt;p&gt;题目链接如下，供各位师傅下载&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wwb.lanzout.com/iq2Aw20n4ype&quot;&gt;https://wwb.lanzout.com/iq2Aw20n4ype&lt;/a&gt;&lt;br&gt;密码:2</summary>
      
    
    
    
    <category term="逆向" scheme="https://5m10v3.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="ctf学习" scheme="https://5m10v3.top/tags/ctf%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>日记(23)</title>
    <link href="https://5m10v3.top/2024/05/12/%E6%97%A5%E8%AE%B0(23)/"/>
    <id>https://5m10v3.top/2024/05/12/%E6%97%A5%E8%AE%B0(23)/</id>
    <published>2024-05-11T16:00:00.000Z</published>
    <updated>2024-07-07T06:25:51.153Z</updated>
    
    <content type="html"><![CDATA[<p>编写那个pe病毒没有成功，主要是在添加完一个新节地址没有对齐<br>感觉这几天都比较浑浑噩噩，不能再这样下去了，要重新振作起来</p><p>感觉对好几个方向都搞的话，更加的迷茫了，目前还是要学一些实际的东西</p><ul><li>LLVM的初步学习</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;编写那个pe病毒没有成功，主要是在添加完一个新节地址没有对齐&lt;br&gt;感觉这几天都比较浑浑噩噩，不能再这样下去了，要重新振作起来&lt;/p&gt;
&lt;p&gt;感觉对好几个方向都搞的话，更加的迷茫了，目前还是要学一些实际的东西&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LLVM的初步学习&lt;/li&gt;
&lt;/ul</summary>
      
    
    
    
    <category term="日记" scheme="https://5m10v3.top/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="学习" scheme="https://5m10v3.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
</feed>
